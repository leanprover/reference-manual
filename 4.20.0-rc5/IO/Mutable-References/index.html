<!DOCTYPE html>
<html>
  <head>
<meta name="robots" content="noindex">
                        <link rel="canonical" href="https://lean-lang.org/doc/reference/4.20.0-rc5/IO/Mutable-References/" />
                        
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <base href="./../../"><meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>Mutable References</title><link rel="stylesheet" href="book.css">
    <script>
      const __versoSiteRoot = document.baseURI;</script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="static/katex/katex.min.js"></script>
    <script src="static/math.js"></script>
    <script src="static/search/fuzzysort.js"></script>
    <script src="static/print.js"></script>
    <script src="-verso-js/popper.js"></script>
    <script src="-verso-js/tippy.js"></script>
    <link rel="stylesheet" href="static/katex/katex.min.css">
    <link rel="stylesheet" href="static/colors.css">
    <link rel="stylesheet" href="static/theme.css">
    <link rel="stylesheet" href="static/print.css">
    <link rel="stylesheet" href="static/search/search-box.css">
    <link rel="stylesheet" href="static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="static/fonts/source-sans/source-sans-3.css">
    <link rel="stylesheet" href="static/fonts/noto-sans-mono/noto-sans-mono.css">
    <link rel="stylesheet" href="-verso-css/tippy-border.css">
    <style>
a.elan-command {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.elan-command:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>
a.lake-command {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.lake-command:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>
span.TODO {
  border: 3px solid red;
  display: inline;
  position: relative;
  float: right;
  clear: right;
  margin-top: 1rem;
  width: 15vw;
  margin-right: -17vw;
  color: red;
  font-size: large;
  font-weight: bold;
}
</style><style>
.hl.lean.tactic-view {
  white-space: collapse;
}
.hl.lean.tactic-view .tactic-state {
  display: block;
  left: 0;
  padding: 0;
  border: none;
}
.hl.lean.tactic-view .tactic-state .goal {
  margin-top: 1em;
  margin-bottom: 1em;
  display: block;
}
.hl.lean.tactic-view .tactic-state .goal:first-child {
  margin-top: 0.25em;
}
.hl.lean.tactic-view .tactic-state .goal:last-child {
  margin-bottom: 0.25em;
}


</style><style>
.namedocs .title {
  font-family: var(--verso-structure-font-family);
  font-size: 1.1rem;
  margin-top: 0;
  margin-left: 1rem;
  margin-right: 1.5rem;
  margin-bottom: 0.75rem;
  display: inline-block;
}
</style><style>
.marginalia .note {
  position: relative;
  padding: 0.5rem;
}

/* Wide viewport */
@media screen and (min-width: 1400px) {
  .marginalia .note {
    float: right;
    clear: right;
    margin-right: -16rem;
    width: 13rem;
    margin-top: 1rem;
  }
}

/* Very wide viewport */
@media screen and (min-width: 1600px) {
  .marginalia .note {
    margin-right: -19vw;
    width: 15vw;
  }
}

.marginalia:hover, .marginalia:hover .note, .marginalia:has(.note:hover) {
  background-color: var(--lean-accent-light-blue);
}

/* Medium viewport */
@media screen and (700px < width <= 1400px) {
  .marginalia .note {
    float: right;
    clear: right;
    width: 40%;
    margin: 1rem 0;
    margin-left: 10%;
  }
}

/* Narrow viewport (e.g. phone) */
@media screen and (width <= 700px) {
  .marginalia .note {
    float: left;
    clear: left;
    width: 90%;
    margin: 1rem 5%;
  }
}

body {
  counter-reset: margin-note-counter;
}
.marginalia .note {
  counter-increment: margin-note-counter;
}
.marginalia .note::before {
  content: counter(margin-note-counter) ".";
  position: absolute;
  vertical-align: baseline;
  font-size: 0.9em;
  font-weight: bold;
  left: -3rem;
  width: 3rem;
  text-align: right;
}
.marginalia::after {
  content: counter(margin-note-counter);
  vertical-align: super;
  font-size: 0.7em;
  font-weight: bold;
  margin-right: 0.5em;
}
</style><style>
.namedocs {
  position: relative;
  border: solid 1px #98B2C0;
  border-radius: .5rem;
  padding-top: var(--verso--box-padding);
  margin-top: var(--verso--box-vertical-margin);
  margin-bottom: var(--verso--box-vertical-margin);
}

.namedocs .text {
  /* Causes margins on child elements to collapse inside the element, such
     that the margins don't extend into parent with the background color.
     The effect is that weird borders in the definition box don't happen anymore. */
  display: flow-root;
  /* Add a padding. this is the same as the margin applied to the first and last child.
     The effect is that the padding looks the same size on all sides. */
  padding: 0 var(--verso--box-padding);
  border-top: 1px solid #98B2C0;
}

.namedocs .text > pre {
  overflow-x: auto;
}

.namedocs .signature {
  font-family: var(--verso-code-font-family);
  margin-top: 0 !important;
  margin-left: var(--verso--box-padding) !important;
  margin-bottom: .75rem !important;
}

.namedocs .label {
  display: block;
  font-size: small;
  font-family: var(--verso-structure-font-family);
  position: absolute;
  top: -0.65rem;
  left: 1rem;
  background: #fff;
  padding: 0 .5rem .125rem;
  border: 1px solid #98B2C0;
  border-radius: 1rem;
  color: #555;
}

.namedocs h1 {
  font-size: inherit;
  font-weight: bold
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.namedocs > .text .constructor {
  padding-top: 0;
  padding-right: 0;
  padding-bottom: 0;
  margin-top: 0.5rem;
  margin-bottom: 1.5rem;
}

.namedocs > .text .constructor::before {
  content: '| ';
  display: block;
  font-family: var(--verso-code-font-family);
  font-weight: bold;
  float: left;
  width: 0.5rem;
  white-space: pre;
}

.namedocs > .text .constructor .name-and-type {
  padding-left: 0.5rem;
  float: left;
  margin-top: 0;
  max-width: calc(100% - 1rem);
}
.namedocs > .text .constructor .docs {
  clear: both;
  padding-left: 1rem;
}

/* These margins work together with the padding on .text */
.namedocs .text > :first-child {
  margin-top: var(--verso--box-padding);
}
.namedocs .text > :last-child {
  margin-bottom: var(--verso--box-padding);
}

.namedocs .methods td, .namedocs .fields td {
  vertical-align: top;
}
.namedocs .inheritance {
  vertical-align: top;
  font-size: smaller;
  font-family: var(--verso-structure-font-family);
}
.namedocs .inheritance ol {
  display: inline-block;
  margin: 0;
  padding: 0;
}
.namedocs .inheritance ol li {
  list-style-type: none;
  display: inline-block;
}
.namedocs .inheritance ol li::after {
  content: " > "
}
.namedocs .inheritance ol li:last-child::after {
  content: "";
}

.namedocs .extends {
  display: inline;
  margin: 0;
  padding: 0;
}

.namedocs .extends li {
  list-style-type: none;
  display: inline-block;
}

.namedocs .extends li label {
  padding-right: 1rem;
}

.namedocs .subdocs .name-and-type {
  font-size: 1rem;
  margin-left: 0;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs .subdocs .docs {
  margin-left: 1.5rem;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs:has(input[data-parent-idx]) [data-inherited-from] {
  transition-property: opacity, display;
  transition-duration: 0.4s;
  transition-behavior: allow-discrete;
  @starting-style { opacity: 0 !important; }
}

#this-page-items .tactic-name { font-weight: bold; }
.namedocs:has(input[data-parent-idx="0"]) [data-inherited-from="0"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="0"]:checked) [data-inherited-from="0"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="0"]:checked):has(.inheritance[data-inherited-from="0"]:hover) [data-inherited-from]:not([data-inherited-from="0"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="1"]) [data-inherited-from="1"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="1"]:checked) [data-inherited-from="1"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="1"]:checked):has(.inheritance[data-inherited-from="1"]:hover) [data-inherited-from]:not([data-inherited-from="1"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="2"]) [data-inherited-from="2"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="2"]:checked) [data-inherited-from="2"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="2"]:checked):has(.inheritance[data-inherited-from="2"]:hover) [data-inherited-from]:not([data-inherited-from="2"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="3"]) [data-inherited-from="3"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="3"]:checked) [data-inherited-from="3"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="3"]:checked):has(.inheritance[data-inherited-from="3"]:hover) [data-inherited-from]:not([data-inherited-from="3"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="4"]) [data-inherited-from="4"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="4"]:checked) [data-inherited-from="4"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="4"]:checked):has(.inheritance[data-inherited-from="4"]:hover) [data-inherited-from]:not([data-inherited-from="4"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="5"]) [data-inherited-from="5"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="5"]:checked) [data-inherited-from="5"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="5"]:checked):has(.inheritance[data-inherited-from="5"]:hover) [data-inherited-from]:not([data-inherited-from="5"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="6"]) [data-inherited-from="6"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="6"]:checked) [data-inherited-from="6"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="6"]:checked):has(.inheritance[data-inherited-from="6"]:hover) [data-inherited-from]:not([data-inherited-from="6"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="7"]) [data-inherited-from="7"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="7"]:checked) [data-inherited-from="7"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="7"]:checked):has(.inheritance[data-inherited-from="7"]:hover) [data-inherited-from]:not([data-inherited-from="7"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="8"]) [data-inherited-from="8"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="8"]:checked) [data-inherited-from="8"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="8"]:checked):has(.inheritance[data-inherited-from="8"]:hover) [data-inherited-from]:not([data-inherited-from="8"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="9"]) [data-inherited-from="9"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="9"]:checked) [data-inherited-from="9"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="9"]:checked):has(.inheritance[data-inherited-from="9"]:hover) [data-inherited-from]:not([data-inherited-from="9"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="10"]) [data-inherited-from="10"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="10"]:checked) [data-inherited-from="10"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="10"]:checked):has(.inheritance[data-inherited-from="10"]:hover) [data-inherited-from]:not([data-inherited-from="10"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="11"]) [data-inherited-from="11"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="11"]:checked) [data-inherited-from="11"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="11"]:checked):has(.inheritance[data-inherited-from="11"]:hover) [data-inherited-from]:not([data-inherited-from="11"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="12"]) [data-inherited-from="12"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="12"]:checked) [data-inherited-from="12"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="12"]:checked):has(.inheritance[data-inherited-from="12"]:hover) [data-inherited-from]:not([data-inherited-from="12"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="13"]) [data-inherited-from="13"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="13"]:checked) [data-inherited-from="13"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="13"]:checked):has(.inheritance[data-inherited-from="13"]:hover) [data-inherited-from]:not([data-inherited-from="13"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="14"]) [data-inherited-from="14"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="14"]:checked) [data-inherited-from="14"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="14"]:checked):has(.inheritance[data-inherited-from="14"]:hover) [data-inherited-from]:not([data-inherited-from="14"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="15"]) [data-inherited-from="15"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="15"]:checked) [data-inherited-from="15"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="15"]:checked):has(.inheritance[data-inherited-from="15"]:hover) [data-inherited-from]:not([data-inherited-from="15"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="16"]) [data-inherited-from="16"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="16"]:checked) [data-inherited-from="16"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="16"]:checked):has(.inheritance[data-inherited-from="16"]:hover) [data-inherited-from]:not([data-inherited-from="16"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="17"]) [data-inherited-from="17"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="17"]:checked) [data-inherited-from="17"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="17"]:checked):has(.inheritance[data-inherited-from="17"]:hover) [data-inherited-from]:not([data-inherited-from="17"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="18"]) [data-inherited-from="18"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="18"]:checked) [data-inherited-from="18"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="18"]:checked):has(.inheritance[data-inherited-from="18"]:hover) [data-inherited-from]:not([data-inherited-from="18"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="19"]) [data-inherited-from="19"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="19"]:checked) [data-inherited-from="19"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="19"]:checked):has(.inheritance[data-inherited-from="19"]:hover) [data-inherited-from]:not([data-inherited-from="19"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="20"]) [data-inherited-from="20"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="20"]:checked) [data-inherited-from="20"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="20"]:checked):has(.inheritance[data-inherited-from="20"]:hover) [data-inherited-from]:not([data-inherited-from="20"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="21"]) [data-inherited-from="21"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="21"]:checked) [data-inherited-from="21"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="21"]:checked):has(.inheritance[data-inherited-from="21"]:hover) [data-inherited-from]:not([data-inherited-from="21"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="22"]) [data-inherited-from="22"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="22"]:checked) [data-inherited-from="22"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="22"]:checked):has(.inheritance[data-inherited-from="22"]:hover) [data-inherited-from]:not([data-inherited-from="22"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="23"]) [data-inherited-from="23"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="23"]:checked) [data-inherited-from="23"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="23"]:checked):has(.inheritance[data-inherited-from="23"]:hover) [data-inherited-from]:not([data-inherited-from="23"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="24"]) [data-inherited-from="24"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="24"]:checked) [data-inherited-from="24"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="24"]:checked):has(.inheritance[data-inherited-from="24"]:hover) [data-inherited-from]:not([data-inherited-from="24"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="25"]) [data-inherited-from="25"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="25"]:checked) [data-inherited-from="25"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="25"]:checked):has(.inheritance[data-inherited-from="25"]:hover) [data-inherited-from]:not([data-inherited-from="25"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="26"]) [data-inherited-from="26"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="26"]:checked) [data-inherited-from="26"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="26"]:checked):has(.inheritance[data-inherited-from="26"]:hover) [data-inherited-from]:not([data-inherited-from="26"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="27"]) [data-inherited-from="27"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="27"]:checked) [data-inherited-from="27"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="27"]:checked):has(.inheritance[data-inherited-from="27"]:hover) [data-inherited-from]:not([data-inherited-from="27"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="28"]) [data-inherited-from="28"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="28"]:checked) [data-inherited-from="28"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="28"]:checked):has(.inheritance[data-inherited-from="28"]:hover) [data-inherited-from]:not([data-inherited-from="28"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="29"]) [data-inherited-from="29"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="29"]:checked) [data-inherited-from="29"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="29"]:checked):has(.inheritance[data-inherited-from="29"]:hover) [data-inherited-from]:not([data-inherited-from="29"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="30"]) [data-inherited-from="30"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="30"]:checked) [data-inherited-from="30"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="30"]:checked):has(.inheritance[data-inherited-from="30"]:hover) [data-inherited-from]:not([data-inherited-from="30"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="31"]) [data-inherited-from="31"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="31"]:checked) [data-inherited-from="31"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="31"]:checked):has(.inheritance[data-inherited-from="31"]:hover) [data-inherited-from]:not([data-inherited-from="31"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="32"]) [data-inherited-from="32"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="32"]:checked) [data-inherited-from="32"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="32"]:checked):has(.inheritance[data-inherited-from="32"]:hover) [data-inherited-from]:not([data-inherited-from="32"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="33"]) [data-inherited-from="33"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="33"]:checked) [data-inherited-from="33"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="33"]:checked):has(.inheritance[data-inherited-from="33"]:hover) [data-inherited-from]:not([data-inherited-from="33"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="34"]) [data-inherited-from="34"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="34"]:checked) [data-inherited-from="34"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="34"]:checked):has(.inheritance[data-inherited-from="34"]:hover) [data-inherited-from]:not([data-inherited-from="34"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="35"]) [data-inherited-from="35"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="35"]:checked) [data-inherited-from="35"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="35"]:checked):has(.inheritance[data-inherited-from="35"]:hover) [data-inherited-from]:not([data-inherited-from="35"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="36"]) [data-inherited-from="36"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="36"]:checked) [data-inherited-from="36"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="36"]:checked):has(.inheritance[data-inherited-from="36"]:hover) [data-inherited-from]:not([data-inherited-from="36"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="37"]) [data-inherited-from="37"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="37"]:checked) [data-inherited-from="37"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="37"]:checked):has(.inheritance[data-inherited-from="37"]:hover) [data-inherited-from]:not([data-inherited-from="37"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="38"]) [data-inherited-from="38"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="38"]:checked) [data-inherited-from="38"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="38"]:checked):has(.inheritance[data-inherited-from="38"]:hover) [data-inherited-from]:not([data-inherited-from="38"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="39"]) [data-inherited-from="39"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="39"]:checked) [data-inherited-from="39"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="39"]:checked):has(.inheritance[data-inherited-from="39"]:hover) [data-inherited-from]:not([data-inherited-from="39"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="40"]) [data-inherited-from="40"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="40"]:checked) [data-inherited-from="40"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="40"]:checked):has(.inheritance[data-inherited-from="40"]:hover) [data-inherited-from]:not([data-inherited-from="40"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="41"]) [data-inherited-from="41"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="41"]:checked) [data-inherited-from="41"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="41"]:checked):has(.inheritance[data-inherited-from="41"]:hover) [data-inherited-from]:not([data-inherited-from="41"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="42"]) [data-inherited-from="42"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="42"]:checked) [data-inherited-from="42"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="42"]:checked):has(.inheritance[data-inherited-from="42"]:hover) [data-inherited-from]:not([data-inherited-from="42"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="43"]) [data-inherited-from="43"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="43"]:checked) [data-inherited-from="43"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="43"]:checked):has(.inheritance[data-inherited-from="43"]:hover) [data-inherited-from]:not([data-inherited-from="43"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="44"]) [data-inherited-from="44"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="44"]:checked) [data-inherited-from="44"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="44"]:checked):has(.inheritance[data-inherited-from="44"]:hover) [data-inherited-from]:not([data-inherited-from="44"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="45"]) [data-inherited-from="45"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="45"]:checked) [data-inherited-from="45"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="45"]:checked):has(.inheritance[data-inherited-from="45"]:hover) [data-inherited-from]:not([data-inherited-from="45"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="46"]) [data-inherited-from="46"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="46"]:checked) [data-inherited-from="46"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="46"]:checked):has(.inheritance[data-inherited-from="46"]:hover) [data-inherited-from]:not([data-inherited-from="46"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="47"]) [data-inherited-from="47"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="47"]:checked) [data-inherited-from="47"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="47"]:checked):has(.inheritance[data-inherited-from="47"]:hover) [data-inherited-from]:not([data-inherited-from="47"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="48"]) [data-inherited-from="48"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="48"]:checked) [data-inherited-from="48"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="48"]:checked):has(.inheritance[data-inherited-from="48"]:hover) [data-inherited-from]:not([data-inherited-from="48"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="49"]) [data-inherited-from="49"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="49"]:checked) [data-inherited-from="49"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="49"]:checked):has(.inheritance[data-inherited-from="49"]:hover) [data-inherited-from]:not([data-inherited-from="49"]) {
  opacity: 0.5;
}
</style><style>
.field-category > :first-child {
}

.field-category > :not(:first-child) {
  margin-left: 1rem;
}
</style><style>
a.technical-term {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.technical-term:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>
dl.toml-table-field-spec {
}
</style><style>
.example-file {
  white-space: normal;
  font-family: var(--verso-structure-font-family);
  margin: 1rem;
  width: fit-content;
  border: 1px solid #ddd;
  padding: 0.5rem;

  /* These are necessary for the container to behave nicely on mobile */
  overflow-x: auto;
  max-width: 100%;
  box-sizing: border-box;
}
.example-file::before {
  counter-reset: linenumber;
}
.example-file > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.example-file > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
.example-file > .line::after {
  -webkit-user-select: none;
  display: inline-block;
  content: "âŽ";
  opacity: 0;
}
.example-file > .line:hover::after {
  opacity: 1;
}
.example-file > .line:hover, .example-file > .line:hover::before {
  background-color: #eee;
}
.example-file > .empty {
  display: block;
  white-space: pre;
  font-family: var(--verso-code-font-family);
  font-style: italic;
}
.example-file > .empty::before {
  -webkit-user-select: none;
  display: inline-block;
  content: "";
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
</style><style>.keyword-of .kw {
  font-weight: 500;
}
.keyword-of .hover-info {
  display: none;
}
.keyword-of .kw:hover {
  background-color: #eee;
  border-radius: 2px;
}
</style><style>.grammar .keyword {
  font-weight: 500 !important;
}

.grammar {
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
}

.grammar .comment {
  font-style: italic;
  font-family: var(--verso-text-font-family);
  /* TODO add background and text colors to Verso theme, then compute a background here */
  background-color: #fafafa;
  border: 1px solid #f0f0f0;
}

.grammar .local-name {
  font-family: var(--verso-code-font-family);
  font-style: italic;
}

.grammar .nonterminal {
  font-style: italic;
}
.grammar .nonterminal > .hover-info, .grammar .from-nonterminal > .hover-info, .grammar .local-name > .hover-info {
  display: none;
}
.grammar .active {
  background-color: #eee;
  border-radius: 2px;
}
.grammar a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
</style><style>
.c .type { font-weight: 600; }
.c .kw { font-weight: 600; }
.c .comment { font-style: italic; }
</style><style>.namedocs .label a { color: inherit; }</style><style>#toc .split-toc > ol .syntax .keyword { font-family: var(--verso-code-font-family); font-weight: 600; }</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
}

.hl.lean .keyword {
  font-weight : bold;
}

.hl.lean .var {
  font-style: italic;
  position: relative;
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
  font-size: inherit;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

/*
@media (hover: hover) {
  .hl.lean .has-info:hover > .hover-container > .hover-info:not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .has-info:hover > .hover-container > .hover-info,
  .hl.lean .token:hover > .hover-container > .hover-info:not(.has-info *):not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .token:hover > .hover-container > .hover-info:not(.has-info *) {
    display: inline-block;
    position: absolute;
    top: 1rem;
    font-weight: normal;
    font-style: normal;
    width: min-content;
  }
}
*/

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: from-font;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error {
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error pre {
    color: red;
}

.hl.lean .has-info.warning {
  text-decoration-color: var(--verso-warning-color);
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color:var(--verso-warning-color);
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: var(--verso-warning-color);
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid var(--verso-warning-color);
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.info {
  text-decoration-color: blue;
}

@media (hover: hover) {
  .hl.lean .has-info.info:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.info {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.info {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: sans-serif;
  white-space: normal;
  max-width: 40rem;
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean div.docstring > :first-child {
  margin-top: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: monospace;
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  left: 2rem;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
  z-index: 200;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: block;
}

/*
@media (hover: hover) {
  .hl.lean .tactic:hover > .tactic-toggle:not(:checked) ~ .tactic-state {
    display: block;
    position: absolute;
    left: 0;
    transform: translate(0.25rem, 0);
    z-index: 250;
  }
}
*/

.hl.lean .tactic > label {
  position: relative;
  transition: all 0.5s;
}

@media (hover: hover) {
  .hl.lean .tactic > label:hover {
    border-bottom: 1px dotted #bbbbbb;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  border-radius: 1rem;
  height: 0.25rem;
  vertical-align: middle;
  width: 0.6rem;
  margin-left: 0.1rem;
  margin-right: 0.1rem;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5rem;
}

.hl.lean .tactic-state summary {
  margin-left: -0.5rem;
}

.hl.lean .tactic-state details {
  padding-left: 0.5rem;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7rem;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6rem;
  height: 0.6rem;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .tactic-state .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  margin-left: 0.5rem;
  margin-top: 0.1rem;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .tactic-state .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .tactic-state .goal-name {
  font-style: italic;
  font-family: monospace;
}

.hl.lean .tactic-state .hypotheses {
  display: table;
}

.hl.lean .tactic-state .hypothesis {
  display: table-row;
}

.hl.lean .tactic-state .hypothesis > * {
  display: table-cell;
}


.hl.lean .tactic-state .hypotheses .colon {
  text-align: center;
  min-width: 1rem;
}

.hl.lean .tactic-state .hypotheses .name {
  text-align: right;
}

.hl.lean .tactic-state .hypotheses .name,
.hl.lean .tactic-state .hypotheses .type,
.hl.lean .tactic-state .conclusion .type {
  font-family: monospace;
}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid var(--verso-warning-color);
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}



.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

</style><style>
table.tabular {
  margin: auto;
  border-spacing: 1rem;
}
table.tabular.left-align {
  margin-right: auto;
  margin-left: 0;
}
table.tabular.center-align {
  margin: auto;
}
table.tabular.right-align {
  margin-left auto;
  margin-right: 0;
}
table.tabular td, table.tabular th {
  text-align: left;
  vertical-align: top;
}
table.tabular td > p:first-child, table.tabular th > p:first-child {
  margin-top: 0;
}
table.tabular td > p:last-child, table.tabular th > p:first-child {
  margin-bottom: 0;
}
</style><style>
.lake-opt a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.lake-opt a:hover {
  text-decoration: currentcolor underline solid;
}
</style><style>
div.TODO {
  border: 5px solid red;
  position: relative;
}
div.TODO::before {
  content: "TODO";
  position: absolute;
  top: 0;
  right: 0;
  color: red;
  font-size: large;
  font-weight: bold;
  transform: rotate(-90deg) translate(-2em);
}
</style><style>
.toml {
  font-family: var(--verso-code-font-family);
}

pre.toml {
  margin: 0.5rem .75rem;
  padding: 0.1rem 0;
}

.toml .bool, .toml .table-header {
    font-weight: 600;
}

.toml .table-header .key {
    color: #3030c0;
}

.toml .bool {
    color: #107090;
}

.toml .string {
    color: #0a5020;
}

.toml a, .toml a:link {
    color: inherit;
    text-decoration: none;
    border-bottom: 1px dotted #a2a2a2;
}

.toml a:hover {
    border-bottom-style: solid;
}
</style><style>
    main .theIndex {
      padding-left: 0;
      font-family: var(--verso-text-font-family);
    }

    main .theIndex nav {
      position: sticky;
      top: var(--verso-header-height);
      background: white;
      font-family: var(--verso-structure-font-family);
    }

    main .theIndex [id] {
      /* This needs the combined height of the index header and the page header. We
         know the height of the page header, but the index header height varies, so
         we use the maximum height it gets which also works well for readers with
         wide screens */
      scroll-margin-top: calc(var(--verso-header-height) + 7.5rem);
    }

    @media screen and (max-width: 700px) {
      /* On mobile, the sticky index takes up half the screen. */
      main .theIndex nav {
        position: static;
      }

      main .theIndex [id] {
        /* On mobile, the index header is not sticky, so we just need to
        be below the page header. */
        scroll-margin-top: var(--verso-header-height);
      }
    }

    main .theIndex nav ol {
      padding: 0;
    }

    main .theIndex nav ol li {
      display: inline-block;
    }

    main .theIndex nav ol li a {
      /* Padding instead of margin to have a bigger click target */
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
    /* Increase the size of the touch target on phones */
    @media screen and (max-width: 700px) {
      main .theIndex nav ol li a {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }
    }

    main .theIndex nav ol li:first-child a {
      padding-left: 0;
    }

    main .theIndex nav ol li + li:before {
      content: "|";
    }

    main .theIndex h1,
    main .theIndex h2,
    main .theIndex h3,
    main .theIndex h4,
    main .theIndex h5,
    main .theIndex h6 {
      margin-top: 0;
    }

    main .theIndex ol {
      list-style-type: none;
    }

    main .theIndex .division > ol {
      padding-left: 0;
      display: flex;
      flex-direction: column;
      gap: .5rem;
      overflow-wrap: break-word;
    }

   main .theIndex .division > ol > li {
      margin-bottom: 0.5rem;
    }

    main .theIndex .division ol ol {
      padding-left: 1rem;
    }

    main .theIndex .division {
      break-inside: avoid;
      counter-reset: none;
      max-width: none;
      width: auto;
    }
    </style><style>
.toml-field a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.toml-field a:hover {
  text-decoration: currentcolor underline solid;
}
</style><style>
.env-var a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.env-var a:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>.plain-keyword {
  font-weight: 500;
}
</style><style>.example {
  border: 1px solid #98B2C0;
  border-radius: 0.5rem;
  margin-bottom: var(--verso--box-vertical-margin);
  margin-top: var(--verso--box-vertical-margin);
}
/* 1400 px is the cutoff for when the margin notes move out of the margin and into floated elements. */
@media screen and (700px < width <= 1400px) {
  .example {
    clear: both; /* Don't overlap margin notes with examples */
  }
}
.example .description::before {
  content: "Example: ";
}
.example .description {
  font-style: italic;
  font-family: var(--verso-structure-font-family);
  padding: var(--verso--box-padding);
}
.example[open] .description {
  margin-bottom: 0;
}
.example-content {
  padding: 0 var(--verso--box-padding) var(--verso--box-padding);
}
.example-content > :first-child {
  margin-top: 0;
}
.example-content p:last-child {
  margin-bottom:0;
}
.example .hl.lean.block {
  overflow-x: auto;
}
</style><style>
.syntax-error {
  white-space: normal;
}
.syntax-error::before {
  counter-reset: linenumber;
}
.syntax-error > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.syntax-error > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}

:is(.syntax-error > .line):has(.parse-message)::before {
  color: red;
  font-weight: bold;
}

.syntax-error .parse-message > code.hover-info {
  display:none;
}

.syntax-error .parse-message {
  white-space: pre;
  text-decoration-skip-ink: none;
  color: red;
  font-weight: 600;
}
</style><script>
      
window.addEventListener("load", () => {
  const innerProps = {
    onShow(inst) { console.log(inst); },
    onHide(inst) { console.log(inst); },
    content(tgt) {
      const content = document.createElement("span");
      const state = tgt.querySelector(".hover-info").cloneNode(true);
      state.style.display = "block";
      content.appendChild(state);
      /* Render docstrings - TODO server-side */
      if ('undefined' !== typeof marked) {
          for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
              const str = d.innerText;
              const html = marked.parse(str);
              const rendered = document.createElement("div");
              rendered.classList.add("docstring");
              rendered.innerHTML = html;
              d.parentNode.replaceChild(rendered, d);
          }
      }
      content.style.display = "block";
      content.className = "hl lean popup";
      return content;
    }
  };
  const outerProps = {
    allowHtml: true,
    theme: "lean",
    placement: 'bottom-start',
    maxWidth: "none",
    delay: 100,
    moveTransition: 'transform 0.2s ease-out',
    onTrigger(inst, event) {
      const ref = event.currentTarget;
      const block = ref.closest('.hl.lean');
      block.querySelectorAll('.active').forEach((i) => i.classList.remove('active'));
      ref.classList.add("active");
    },
    onUntrigger(inst, event) {
      const ref = event.currentTarget;
      const block = ref.closest('.hl.lean');
      block.querySelectorAll('.active').forEach((i) => i.classList.remove('active'));
    }
  };
  tippy.createSingleton(tippy('pre.grammar.hl.lean .nonterminal.documented, pre.grammar.hl.lean .from-nonterminal.documented, pre.grammar.hl.lean .local-name.documented', innerProps), outerProps);
});
</script>
    <script>
      
window.addEventListener("load", () => {
  tippy('.keyword-of.hl.lean', {
    allowHtml: true,
    /* DEBUG -- remove the space: * /
    onHide(any) { return false; },
    trigger: "click",
    // */
    maxWidth: "none",

    theme: "lean",
    placement: 'bottom-start',
    content (tgt) {
      const content = document.createElement("span");
      const state = tgt.querySelector(".hover-info").cloneNode(true);
      state.style.display = "block";
      content.appendChild(state);
      /* Render docstrings - TODO server-side */
      if ('undefined' !== typeof marked) {
          for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
              const str = d.innerText;
              const html = marked.parse(str);
              const rendered = document.createElement("div");
              rendered.classList.add("docstring");
              rendered.innerHTML = html;
              d.parentNode.replaceChild(rendered, d);
          }
      }
      content.style.display = "block";
      content.className = "hl lean popup";
      return content;
    }
  });
});
</script>
    <script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let siteRoot = typeof __versoSiteRoot !== 'undefined' ? __versoSiteRoot : "/";
    let docsJson = siteRoot + "-verso-docs.json";
    fetch(docsJson).then((resp) => resp.json()).then((versoDocData) => {

      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        theme: "lean",
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        ignoreAttributes: true,
        onShow(inst) {
          if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          content.className = "hl lean";
          content.style.display = "block";
          content.style.maxHeight = "300px";
          content.style.overflowY = "auto";
          content.style.overflowX = "hidden";
          const hoverId = tgt.dataset.versoHover;
          const hoverInfo = tgt.querySelector(".hover-info");
          if (hoverId) { // Docstrings from the table
            // TODO stop doing an implicit conversion from string to number here
            let data = versoDocData[hoverId];
            if (data) {
              const info = document.createElement("span");
              info.className = "hover-info";
              info.style.display = "block";
              info.innerHTML = data;
              content.appendChild(info);
              /* Render docstrings - TODO server-side */
              if ('undefined' !== typeof marked) {
                  for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                      const str = d.innerText;
                      const html = marked.parse(str);
                      const rendered = document.createElement("div");
                      rendered.classList.add("docstring");
                      rendered.innerHTML = html;
                      d.parentNode.replaceChild(rendered, d);
                  }
              }
            } else {
              content.innerHTML = "Failed to load doc ID: " + hoverId;
            }
          } else if (hoverInfo) { // The inline info, still used for compiler messages
            content.appendChild(hoverInfo.cloneNode(true));
          }
          return content;
        }
      };

      const addTippy = (selector, props) => {
        tippy(selector, Object.assign({}, defaultTippyProps, props));
      };
      addTippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token', {theme: 'lean'});
      addTippy('.hl.lean .has-info.warning', {theme: 'warning message'});
      addTippy('.hl.lean .has-info.info', {theme: 'info message'});
      addTippy('.hl.lean .has-info.error', {theme: 'error message'});

      tippy('.hl.lean .tactic', {
        allowHtml: true,
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        maxWidth: "none",
        onShow(inst) {
          const toggle = inst.reference.querySelector("input.tactic-toggle");
          if (toggle && toggle.checked) {
            return false;
          }
          if (blockedByTippy(inst.reference)) { return false; }
        },
        theme: "tactic",
        placement: 'bottom-start',
        content (tgt) {
          const content = document.createElement("span");
          const state = tgt.querySelector(".tactic-state").cloneNode(true);
          state.style.display = "block";
          content.appendChild(state);
          content.style.display = "block";
          content.className = "hl lean popup";
          return content;
        }
      });
  });
}
</script>
    <script type="module" src="static/search/search-init.js"></script>
    <script defer="defer" data-domain="lean-lang.org/doc/reference/latest" src="https://plausible.io/js/script.outbound-links.js"></script>
    </head>
  <body>
    <header>
      <div class="header-logo-wrapper">
        <a href="" id="logo"><img src="static/lean_logo.svg"></a></div>
      <div class="header-title-wrapper">
        <a href="" class="header-title"><h1>
            The Lean Language Reference</h1>
          </a></div>
      </header>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc"><div class="first">
          <a href="" class="toc-title"><h1>
              The Lean Language Reference</h1>
            </a><div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class="">Table of Contents</span></div>
              <table><tr class="numbered"><td class="num">1.</td><td><a href="Introduction/#introduction">Introduction</a></td></tr><tr class="numbered"><td class="num">2.</td><td><a href="Elaboration-and-Compilation/#The-Lean-Language-Reference--Elaboration-and-Compilation">Elaboration and Compilation</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="Interacting-with-Lean/#interaction">Interacting with Lean</a></td></tr><tr class="numbered"><td class="num">4.</td><td><a href="The-Type-System/#type-system">The Type System</a></td></tr><tr class="numbered"><td class="num">5.</td><td><a href="Source-Files-and-Modules/#files">Source Files and Modules</a></td></tr><tr class="numbered"><td class="num">6.</td><td><a href="Namespaces-and-Sections/#namespaces-sections">Namespaces and Sections</a></td></tr><tr class="numbered"><td class="num">7.</td><td><a href="Definitions/#definitions">Definitions</a></td></tr><tr class="numbered"><td class="num">8.</td><td><a href="Axioms/#axioms">Axioms</a></td></tr><tr class="numbered"><td class="num">9.</td><td><a href="Attributes/#attributes">Attributes</a></td></tr><tr class="numbered"><td class="num">10.</td><td><a href="Terms/#terms">Terms</a></td></tr><tr class="numbered"><td class="num">11.</td><td><a href="Type-Classes/#type-classes">Type Classes</a></td></tr><tr class="numbered"><td class="num">12.</td><td><a href="Coercions/#coercions">Coercions</a></td></tr><tr class="numbered"><td class="num">13.</td><td><a href="Tactic-Proofs/#tactics">Tactic Proofs</a></td></tr><tr class="numbered"><td class="num">14.</td><td><a href="Functors___-Monads-and--do--Notation/#monads-and-do">Functors, Monads and <code>do</code>-Notation</a></td></tr><tr class="current numbered"><td class="num">15.</td><td><a href="IO/#io">IO</a></td></tr><tr class="numbered"><td class="num">16.</td><td><a href="The-Simplifier/#the-simplifier">The Simplifier</a></td></tr><tr class="numbered"><td class="num">17.</td><td><a href="Basic-Propositions/#basic-props">Basic Propositions</a></td></tr><tr class="numbered"><td class="num">18.</td><td><a href="Basic-Types/#basic-types">Basic Types</a></td></tr><tr class="numbered"><td class="num">19.</td><td><a href="Notations-and-Macros/#language-extension">Notations and Macros</a></td></tr><tr class="numbered"><td class="num">20.</td><td><a href="Run-Time-Code/#runtime">Run-Time Code</a></td></tr><tr class="numbered"><td class="num">21.</td><td><a href="Build-Tools-and-Distribution/#build-tools-and-distribution">Build Tools and Distribution</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/#release-notes">Release Notes</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="the-index/#The-Lean-Language-Reference--Index">Index</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-io" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-io" checked="checked"></label><span class="number">15.</span>Â <span class=""><a href="IO/#io">IO</a></span></div>
              <table><tr class="numbered"><td class="num">15.1.</td><td><a href="IO/Logical-Model/#The-Lean-Language-Reference--IO--Logical-Model">Logical Model</a></td></tr><tr class="numbered"><td class="num">15.2.</td><td><a href="IO/Control-Structures/#io-monad-control">Control Structures</a></td></tr><tr class="numbered"><td class="num">15.3.</td><td><a href="IO/Console-Output/#The-Lean-Language-Reference--IO--Console-Output">Console Output</a></td></tr><tr class="current numbered"><td class="num">15.4.</td><td><a href="IO/Mutable-References/#The-Lean-Language-Reference--IO--Mutable-References">Mutable References</a></td></tr><tr class="numbered"><td class="num">15.5.</td><td><a href="IO/Files___-File-Handles___-and-Streams/#The-Lean-Language-Reference--IO--Files___-File-Handles___-and-Streams">Files, File Handles, and Streams</a></td></tr><tr class="numbered"><td class="num">15.6.</td><td><a href="IO/System-and-Platform-Information/#platform-info">System and Platform Information</a></td></tr><tr class="numbered"><td class="num">15.7.</td><td><a href="IO/Environment-Variables/#io-monad-getenv">Environment Variables</a></td></tr><tr class="numbered"><td class="num">15.8.</td><td><a href="IO/Timing/#io-timing">Timing</a></td></tr><tr class="numbered"><td class="num">15.9.</td><td><a href="IO/Processes/#io-processes">Processes</a></td></tr><tr class="numbered"><td class="num">15.10.</td><td><a href="IO/Random-Numbers/#The-Lean-Language-Reference--IO--Random-Numbers">Random Numbers</a></td></tr><tr class="numbered"><td class="num">15.11.</td><td><a href="IO/Tasks-and-Threads/#concurrency">Tasks and Threads</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-The-Lean-Language-Reference--IO--Mutable-References" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-The-Lean-Language-Reference--IO--Mutable-References" checked="checked"></label><span class="number">15.4.</span>Â <span class="current"><a href="IO/Mutable-References/#The-Lean-Language-Reference--IO--Mutable-References">Mutable References</a></span></div>
              <ol>
                <li>
                  <a href="IO/Mutable-References/#IO___Ref"><code>IO.Ref</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#IO___mkRef"><code>IO.mkRef</code></a></li>
                <li>
                  <span class="header head-1"><span class="level-num">1.</span> <a href="IO/Mutable-References/#mutable-st-references">State Transformers</a></span></li>
                <li>
                  <a href="IO/Mutable-References/#ST"><code>ST</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#runST"><code>runST</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#EST"><code>EST</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#runEST"><code>runEST</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___mk"><code>ST.Ref</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#ST___mkRef"><code>ST.mkRef</code></a></li>
                <li>
                  <span class="header head-2"><span class="level-num">1.1.</span> <a href="IO/Mutable-References/#The-Lean-Language-Reference--IO--Mutable-References--State-Transformers--Reading-and-Writing">Reading and Writing</a></span></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___get"><code>get</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___set"><code>set</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___modify"><code>modify</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___modifyGet"><code>modifyGet</code></a></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___swap"><code>swap</code></a></li>
                <li>
                  <span class="header head-2"><span class="level-num">1.2.</span> <a href="IO/Mutable-References/#The-Lean-Language-Reference--IO--Mutable-References--State-Transformers--Comparisons">Comparisons</a></span></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___ptrEq"><code>ptrEq</code></a></li>
                <li>
                  <span class="header head-2"><span class="level-num">1.3.</span> <a href="IO/Mutable-References/#The-Lean-Language-Reference--IO--Mutable-References--State-Transformers--ST--Backed-State-Monads"><code>ST</code>-Backed State Monads</a></span></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___toMonadStateOf"><code>toMonadStateOf</code></a></li>
                <li>
                  <span class="header head-1"><span class="level-num">2.</span> <a href="IO/Mutable-References/#ref-locks">Concurrency</a></span></li>
                <li>
                  <a href="IO/Mutable-References/#ST___Ref___take"><code>take</code></a></li>
                </ol>
              </div>
            </div>
          </div>
        <div class="last">
          <ul id="meta-links">
            <li>
              <a href="https://github.com/leanprover/reference-manual">Source Code</a></li>
            <li>
              <a href="https://github.com/leanprover/reference-manual/issues">Report Issues</a></li>
            </ul>
          </div>
        </nav>
      <main><div class="content-wrapper">
          <nav class="prev-next-buttons">
            <a class="local-button active" href="IO/Console-Output/#The-Lean-Language-Reference--IO--Console-Output" rel="prev" title="15.3. Console Output"><span class="arrow">â†</span><span class="where">15.3. Console Output</span></a><a class="local-button active" href="IO/Files___-File-Handles___-and-Streams/#The-Lean-Language-Reference--IO--Files___-File-Handles___-and-Streams" rel="next" title="15.5. Files, File Handles, and Streams"><span class="where">15.5. Files, File Handles, and Streams</span><span class="arrow">â†’</span></a></nav>
          <section>
            <h1>
              15.4.Â Mutable References</h1>
            <p>
              While ordinary <a class="technical-term" href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#--tech-term-State-monads">state monads</a> encode stateful computations with tuples that track the contents of the state along with the computation's value, Lean's runtime system also provides mutable references that are always backed by mutable memory cells.
Mutable references have a type <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#IO___Ref"><span class="const token" data-binding="const-IO.Ref" data-verso-hover="2996">IO.Ref</span></a></code> that indicates that a cell is mutable, and reads and writes must be explicit.
<code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#IO___Ref"><span class="const token" data-binding="const-IO.Ref" data-verso-hover="2996">IO.Ref</span></a></code> is implemented using <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a></code>, so the entire <a href="IO/Mutable-References/#mutable-st-references"><code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a></code> API</a> may also be used with <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#IO___Ref"><span class="const token" data-binding="const-IO.Ref" data-verso-hover="2996">IO.Ref</span></a></code>.</p>
            <div class="namedocs" id="IO___Ref">
              <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=IO.Ref" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">IO.Ref (<span class="var token" data-binding="var-_uniq.11" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div><div class="narrow-only">IO.Ref (<span class="var token" data-binding="var-_uniq.11" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div></pre><div class="text">
                <p>
                  Mutable reference cells that contain values of type <code class="hl lean inline" data-lean-context="docstring-examples"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="162">Î±</span></code>. These cells can read from and mutated in
the <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a></code> monad.</p>
                </div>
              </div>
            <div class="namedocs" id="IO___mkRef">
              <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=IO.mkRef" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">IO.mkRef {<span class="var token" data-binding="var-_uniq.15" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.16" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.15" data-verso-hover="162">Î±</span>) : <a href="IO/Logical-Model/#BaseIO"><span class="const token" data-binding="const-BaseIO" data-verso-hover="1338">BaseIO</span></a> (<a href="IO/Mutable-References/#IO___Ref"><span class="const token" data-binding="const-IO.Ref" data-verso-hover="2996">IO.Ref</span></a> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="162">Î±</span>)</div><div class="narrow-only">IO.mkRef {<span class="var token" data-binding="var-_uniq.15" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.16" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.15" data-verso-hover="162">Î±</span>) :
  <a href="IO/Logical-Model/#BaseIO"><span class="const token" data-binding="const-BaseIO" data-verso-hover="1338">BaseIO</span></a> (<a href="IO/Mutable-References/#IO___Ref"><span class="const token" data-binding="const-IO.Ref" data-verso-hover="2996">IO.Ref</span></a> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="162">Î±</span>)</div></pre><div class="text">
                <p>
                  Creates a new mutable reference cell that contains <code class="hl lean inline" data-lean-context="docstring-examples"><span class="var token" data-binding="var-_uniq.13" data-verso-hover="46">a</span></code>.</p>
                </div>
              </div>
            <section>
              <h2 id="mutable-st-references">
                15.4.1.Â State Transformers<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&name=mutable-st-references" title="Permalink">ðŸ”—</a></span></h2>
              <p>
                Mutable references are often useful in contexts where arbitrary side effects are undesired.
They can give a significant speedup when Lean is unable to optimize pure operations into mutation, and some algorithms are more easily expressed using mutable references than with state monads.
Additionally, it has a property that other side effects do not have: if all of the mutable references used by a piece of code are created during its execution, and no mutable references from the code escape to other code, then the result of evaluation is deterministic.</p>
              <p>
                The <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> monad is a restricted version of <code class="hl lean inline" data-lean-context="examples"><a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a></code> in which mutable state is the only side effect, and mutable references cannot escape.<span class="marginalia"><span class="note"><code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> was first described by <span class="citation">John Launchbury and Simon L Peyton Jones,Â 1994. â€œLazy functional state threadsâ€. InÂ <em>Proceedings of the ACM SIGPLAN 1994 Conference on Programming Language Design and Implementation.</em></span>.</span></span>
<code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> takes a type parameter that is never used to classify any terms.
The <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#runST"><span class="const token" data-binding="const-runST" data-verso-hover="2899">runST</span></a></code> function, which allow escape from <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code>, requires that the <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> action that is passed to it can instantiate this type parameter with <em>any</em> type.
This unknown type does not exist except as a parameter to a function, which means that values whose types are â€œmarkedâ€ by it cannot escape its scope.</p>
              <div class="namedocs" id="ST">
                <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST (<span class="var token" data-binding="var-_uniq.45" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div><div class="narrow-only">ST (<span class="var token" data-binding="var-_uniq.45" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div></pre><div class="text">
                  <p>
                    A restricted version of <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a></code> in which mutable state is the only side effect.</p>
                  <p>
                    It is possible to run <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> computations in a non-monadic context using <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#runST"><span class="const token" data-binding="const-runST" data-verso-hover="2899">runST</span></a></code>.</p>
                  </div>
                </div>
              <div class="namedocs" id="runST">
                <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=runST" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">runST {<span class="var token" data-binding="var-_uniq.56" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.58" data-verso-hover="2997">x</span> : (<span class="var token" data-binding="var-_uniq.57" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) â†’ <a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.57" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.56" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.56" data-verso-hover="162">Î±</span></div><div class="narrow-only">runST {<span class="var token" data-binding="var-_uniq.56" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.58" data-verso-hover="2997">x</span> : (<span class="var token" data-binding="var-_uniq.57" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) â†’ <a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.57" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.56" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.56" data-verso-hover="162">Î±</span></div></pre><div class="text">
                  <p>
                    Runs an <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> computation, in which mutable state via <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a></code> is the only side effect.</p>
                  </div>
                </div>
              <p>
                As with <code class="hl lean inline" data-lean-context="examples"><a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a></code> and <code class="hl lean inline" data-lean-context="examples"><a href="IO/Logical-Model/#EIO"><span class="const token" data-binding="const-EIO" data-verso-hover="1340">EIO</span></a></code>, there is also a variation of <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> that takes a custom error type as a parameter.
Here, <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> is analogous to <code class="hl lean inline" data-lean-context="examples"><a href="IO/Logical-Model/#BaseIO"><span class="const token" data-binding="const-BaseIO" data-verso-hover="1338">BaseIO</span></a></code> rather than <code class="hl lean inline" data-lean-context="examples"><a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a></code>, because <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a></code> cannot result in errors being thrown.</p>
              <div class="namedocs" id="EST">
                <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=EST" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">EST (<span class="var token" data-binding="var-_uniq.88" data-verso-hover="162">Îµ </span><span class="var token" data-binding="var-_uniq.89" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div><div class="narrow-only">EST (<span class="var token" data-binding="var-_uniq.88" data-verso-hover="162">Îµ </span><span class="var token" data-binding="var-_uniq.89" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div></pre><div class="text">
                  <p>
                    A restricted version of <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a></code> in which mutable state and exceptions are the only side effects.</p>
                  <p>
                    It is possible to run <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#EST"><span class="const token" data-binding="const-EST" data-verso-hover="2898">EST</span></a></code> computations in a non-monadic context using <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#runEST"><span class="const token" data-binding="const-runEST" data-verso-hover="2998">runEST</span></a></code>.</p>
                  </div>
                </div>
              <div class="namedocs" id="runEST">
                <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=runEST" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">runEST {<span class="var token" data-binding="var-_uniq.100" data-verso-hover="162">Îµ </span><span class="var token" data-binding="var-_uniq.101" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.103" data-verso-hover="2999">x</span> : (<span class="var token" data-binding="var-_uniq.102" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) â†’ <a href="IO/Mutable-References/#EST"><span class="const token" data-binding="const-EST" data-verso-hover="2898">EST</span></a> <span class="var token" data-binding="var-_uniq.100" data-verso-hover="162">Îµ</span> <span class="var token" data-binding="var-_uniq.102" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.101" data-verso-hover="162">Î±</span>) : <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except" data-verso-hover="1336">Except</span></a> <span class="var token" data-binding="var-_uniq.100" data-verso-hover="162">Îµ</span> <span class="var token" data-binding="var-_uniq.101" data-verso-hover="162">Î±</span></div><div class="narrow-only">runEST {<span class="var token" data-binding="var-_uniq.100" data-verso-hover="162">Îµ </span><span class="var token" data-binding="var-_uniq.101" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.103" data-verso-hover="2999">x</span> : (<span class="var token" data-binding="var-_uniq.102" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) â†’ <a href="IO/Mutable-References/#EST"><span class="const token" data-binding="const-EST" data-verso-hover="2898">EST</span></a> <span class="var token" data-binding="var-_uniq.100" data-verso-hover="162">Îµ</span> <span class="var token" data-binding="var-_uniq.102" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.101" data-verso-hover="162">Î±</span>) :
  <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except" data-verso-hover="1336">Except</span></a> <span class="var token" data-binding="var-_uniq.100" data-verso-hover="162">Îµ</span> <span class="var token" data-binding="var-_uniq.101" data-verso-hover="162">Î±</span></div></pre><div class="text">
                  <p>
                    Runs an <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#EST"><span class="const token" data-binding="const-EST" data-verso-hover="2898">EST</span></a></code> computation, in which mutable state and exceptions are the only side effects.</p>
                  </div>
                </div>
              <div class="namedocs" id="ST___Ref___mk">
                <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.mk" title="Permalink">ðŸ”—</a></span><span class="label">structure</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref (<span class="var token" data-binding="var-_uniq.121" data-verso-hover="162">Ïƒ </span><span class="var token" data-binding="var-_uniq.122" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div><div class="narrow-only">ST.Ref (<span class="var token" data-binding="var-_uniq.121" data-verso-hover="162">Ïƒ </span><span class="var token" data-binding="var-_uniq.122" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>) : <span class="sort token" data-binding="" data-verso-hover="50">Type</span></div></pre><div class="text">
                  <p>
                    Mutable reference cells that contain values of type <code class="hl lean inline" data-lean-context="docstring-examples"><span class="var token" data-binding="var-_uniq.106" data-verso-hover="162">Î±</span></code>. These cells can read from and mutated in
the <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.105" data-verso-hover="162">Ïƒ</span></code> monad.</p>
                  <h1>
                    Constructor</h1>
                  <section class="subdocs">
                    <pre class="name-and-type hl lean"><a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref.mk" data-verso-hover="3000">ST.Ref.mk</span></a></pre><div class="docs"></div>
                    </section>
                  </div>
                </div>
              <div class="namedocs" id="ST___mkRef">
                <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.mkRef" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.mkRef {<span class="var token" data-binding="var-_uniq.128" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.130" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.128" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.130" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.133" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.134" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.133" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.130" data-verso-hover="78">m</span> (<a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.128" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.133" data-verso-hover="162">Î±</span>)</div><div class="narrow-only">ST.mkRef {<span class="var token" data-binding="var-_uniq.128" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.130" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.128" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.130" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.133" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.134" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.133" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.130" data-verso-hover="78">m</span> (<a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.128" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.133" data-verso-hover="162">Î±</span>)</div></pre><div class="text">
                  <p>
                    Creates a new mutable reference that contains the provided value <code class="hl lean inline" data-lean-context="docstring-examples"><span class="var token" data-binding="var-_uniq.127" data-verso-hover="46">a</span></code>.</p>
                  </div>
                </div>
              <section>
                <h3 id="The-Lean-Language-Reference--IO--Mutable-References--State-Transformers--Reading-and-Writing">
                  15.4.1.1.Â Reading and Writing</h3>
                <div class="namedocs" id="ST___Ref___get">
                  <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.get" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.get {<span class="var token" data-binding="var-_uniq.142" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.144" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.144" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.147" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.150" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.147" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.144" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.147" data-verso-hover="162">Î±</span></div><div class="narrow-only">ST.Ref.get {<span class="var token" data-binding="var-_uniq.142" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.144" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.144" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.147" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.150" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.147" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.144" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.147" data-verso-hover="162">Î±</span></div></pre><div class="text">
                    <p>
                      Reads the value of a mutable reference.</p>
                    </div>
                  </div>
                <div class="namedocs" id="ST___Ref___set">
                  <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.set" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.set {<span class="var token" data-binding="var-_uniq.157" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.159" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.157" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.159" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.162" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.165" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.157" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.162" data-verso-hover="162">Î±</span>) (<span class="var token" data-binding="var-_uniq.166" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.162" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.159" data-verso-hover="78">m</span> <a href="Basic-Types/The-Unit-Type/#Unit"><span class="const token" data-binding="const-Unit" data-verso-hover="3">Unit</span></a></div><div class="narrow-only">ST.Ref.set {<span class="var token" data-binding="var-_uniq.157" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.159" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.157" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.159" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.162" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.165" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.157" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.162" data-verso-hover="162">Î±</span>) (<span class="var token" data-binding="var-_uniq.166" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.162" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.159" data-verso-hover="78">m</span> <a href="Basic-Types/The-Unit-Type/#Unit"><span class="const token" data-binding="const-Unit" data-verso-hover="3">Unit</span></a></div></pre><div class="text">
                    <p>
                      Replaces the value of a mutable reference.</p>
                    </div>
                  </div>
                <details class="example"><summary class="description">Data races with <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___get"><span class="const token" data-binding="const-ST.Ref.get" data-verso-hover="3002">get</span></a></code> and <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___set"><span class="const token" data-binding="const-ST.Ref.set" data-verso-hover="3003">set</span></a></code></summary><div class="example-content">
                    <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-0">def</span> <span class="const token" data-binding="const-main" data-verso-hover="2772">main</span> <span class="unknown token" data-binding="">:</span> <a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a> <a href="Basic-Types/The-Unit-Type/#Unit"><span class="const token" data-binding="const-Unit" data-verso-hover="3">Unit</span></a> <span class="unknown token" data-binding="">:=</span> <a href="Functors___-Monads-and--do--Notation/Syntax/#Lean___Parser___Term___do"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-22">do</span></a>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-27">let</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Mutable-References/#IO___mkRef"><span class="const token" data-binding="const-IO.mkRef" data-verso-hover="3005">IO.mkRef</span></a> <span class="unknown token" data-binding="">(</span><span class="typed token" data-binding="" data-verso-hover="337">100</span> <span class="unknown token" data-binding="">:</span> <a href="Basic-Types/Integers/#Int___ofNat"><span class="const token" data-binding="const-Int" data-verso-hover="146">Int</span></a><span class="unknown token" data-binding="">)</span>

  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-67">let</span> <span class="keyword token" data-binding="kw-occ-null-71">mut</span> <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">#[</span><span class="unknown token" data-binding="">]</span>
  <a href="IO/Console-Output/#IO___println"><span class="const token" data-binding="const-IO.println" data-verso-hover="4">IO.println</span></a> <span class="literal string token" data-binding="" data-verso-hover="3007">"Sending out orders..."</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-128" data-verso-hover="1013">for</span> <span class="unknown token" data-binding="">_</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-132">in</span> <span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="7">0</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="7">100</span><span class="unknown token" data-binding="">]</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-128" data-verso-hover="1013">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-152">let</span> <span class="var token" data-binding="var-_uniq.1322" data-verso-hover="3008">o</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Tasks-and-Threads/#IO___asTask"><span class="const token" data-binding="const-IO.asTask" data-verso-hover="3009">IO.asTask</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">prio</span> <span class="unknown token" data-binding="">:=</span> <a href="IO/Tasks-and-Threads/#Task___Priority___dedicated"><span class="const token" data-binding="const-Task.Priority.dedicated" data-verso-hover="3010">.dedicated</span></a><span class="unknown token" data-binding="">)</span> <a href="Functors___-Monads-and--do--Notation/Syntax/#Lean___Parser___Term___do"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-193">do</span></a>
      <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-202">let</span> <span class="var token" data-binding="var-_uniq.545" data-verso-hover="7">cost</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Random-Numbers/#IO___rand"><span class="const token" data-binding="const-IO.rand" data-verso-hover="3011">IO.rand</span></a> <span class="typed token" data-binding="" data-verso-hover="7">1</span> <span class="typed token" data-binding="" data-verso-hover="7">100</span>
      <a href="IO/Timing/#IO___sleep"><span class="const token" data-binding="const-IO.sleep" data-verso-hover="3012">IO.sleep</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <a href="IO/Random-Numbers/#IO___rand"><span class="const token" data-binding="const-IO.rand" data-verso-hover="3011">IO.rand</span></a> <span class="typed token" data-binding="" data-verso-hover="7">10</span> <span class="typed token" data-binding="" data-verso-hover="7">100</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><a href="Basic-Types/Natural-Numbers/#Nat___toUInt32"><span class="const token" data-binding="const-Nat.toUInt32" data-verso-hover="3013">toUInt32</span></a>
      <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-280">if</span> <span class="var token" data-binding="var-_uniq.545" data-verso-hover="7">cost</span> <span class="unknown token" data-binding="">&lt;</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___get"><span class="const token" data-binding="const-ST.Ref.get" data-verso-hover="3002">get</span></a><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-280">then</span>
        <a href="IO/Timing/#IO___sleep"><span class="const token" data-binding="const-IO.sleep" data-verso-hover="3012">IO.sleep</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <a href="IO/Random-Numbers/#IO___rand"><span class="const token" data-binding="const-IO.rand" data-verso-hover="3011">IO.rand</span></a> <span class="typed token" data-binding="" data-verso-hover="7">10</span> <span class="typed token" data-binding="" data-verso-hover="7">100</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><a href="Basic-Types/Natural-Numbers/#Nat___toUInt32"><span class="const token" data-binding="const-Nat.toUInt32" data-verso-hover="3013">toUInt32</span></a>
        <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___set"><span class="const token" data-binding="const-ST.Ref.set" data-verso-hover="3003">set</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___get"><span class="const token" data-binding="const-ST.Ref.get" data-verso-hover="3002">get</span></a><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">-</span> <span class="var token" data-binding="var-_uniq.545" data-verso-hover="7">cost</span><span class="unknown token" data-binding="">)</span>
    <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span><span class="unknown token" data-binding="">.</span><a href="Basic-Types/Arrays/#Array___push"><span class="const token" data-binding="const-Array.push" data-verso-hover="224">push</span></a> <span class="var token" data-binding="var-_uniq.1322" data-verso-hover="3008">o</span>

  -- Wait until all orders are completed
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-479" data-verso-hover="1013">for</span> <span class="var token" data-binding="var-_uniq.1573" data-verso-hover="3008">o</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-483">in</span> <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-479" data-verso-hover="1013">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-502">match</span> <span class="var token" data-binding="var-_uniq.1573" data-verso-hover="3008">o</span><span class="unknown token" data-binding="">.</span><a href="IO/Tasks-and-Threads/#Task___get"><span class="const token" data-binding="const-Task.get" data-verso-hover="3014">get</span></a> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-502">with</span>
    <span class="unknown token" data-binding="">|</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except.ok" data-verso-hover="1516">.ok</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=&gt;</span> <a href="Functors___-Monads-and--do--Notation/#Pure___mk"><span class="const token" data-binding="const-Pure.pure" data-verso-hover="1015">pure</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span>
    <span class="unknown token" data-binding="">|</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except.error" data-verso-hover="1514">.error</span></a> <span class="var token" data-binding="var-_uniq.1701" data-verso-hover="2981">e</span> <span class="unknown token" data-binding="">=&gt;</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#MonadExcept___mk"><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1457">throw</span></a> <span class="var token" data-binding="var-_uniq.1701" data-verso-hover="2981">e</span>

  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-572">if</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___get"><span class="const token" data-binding="const-ST.Ref.get" data-verso-hover="3002">get</span></a><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">&lt;</span> <span class="typed token" data-binding="" data-verso-hover="337">0</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-572">then</span>
    <a href="IO/Console-Output/#IO___eprintln"><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="2994">IO.eprintln</span></a> <span class="literal string token" data-binding="" data-verso-hover="3015">"Final balance is negative!"</span>
  <span class="keyword token" data-binding="kw-occ-null-649">else</span>
    <a href="IO/Console-Output/#IO___println"><span class="const token" data-binding="const-IO.println" data-verso-hover="4">IO.println</span></a> <span class="literal string token" data-binding="" data-verso-hover="3016">"Final balance is zero or positive."</span>
<span class="unknown token" data-binding=""></span></code><div class="example-file">
                      <code>stdout</code><code class="line">Sending out orders...</code></div>
                    <div class="example-file">
                      <code>stderr</code><code class="line">Final balance is negative!</code></div>
                    </div>
                  </details><div class="namedocs" id="ST___Ref___modify">
                  <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.modify" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.modify {<span class="var token" data-binding="var-_uniq.192" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.194" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.192" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.194" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.200" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.192" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span>) (<span class="var token" data-binding="var-_uniq.202" data-verso-hover="1212">f</span> : <span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span> â†’ <span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.194" data-verso-hover="78">m</span> <a href="Basic-Types/The-Unit-Type/#Unit"><span class="const token" data-binding="const-Unit" data-verso-hover="3">Unit</span></a></div><div class="narrow-only">ST.Ref.modify {<span class="var token" data-binding="var-_uniq.192" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.194" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.192" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.194" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.200" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.192" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span>) (<span class="var token" data-binding="var-_uniq.202" data-verso-hover="1212">f</span> : <span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span> â†’ <span class="var token" data-binding="var-_uniq.197" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.194" data-verso-hover="78">m</span> <a href="Basic-Types/The-Unit-Type/#Unit"><span class="const token" data-binding="const-Unit" data-verso-hover="3">Unit</span></a></div></pre><div class="text">
                    <p>
                      Atomically modifies a mutable reference cell by replacing its contents with the result of a function
call.</p>
                    </div>
                  </div>
                <details class="example"><summary class="description">Avoiding data races with <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___modify"><span class="const token" data-binding="const-ST.Ref.modify" data-verso-hover="3017">modify</span></a></code></summary><div class="example-content">
                    <p>
                      This program launches 100 threads.
Each thread simulates a purchase attempt: it generates a random price, and if the account balance is sufficient, it decrements it by the price.
The balance check and the computation of the new value occur in an atomic call to <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___modify"><span class="const token" data-binding="const-ST.Ref.modify" data-verso-hover="3017">ST.Ref.modify</span></a></code>.</p>
                    <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-0">def</span> <span class="const token" data-binding="const-main" data-verso-hover="2772">main</span> <span class="unknown token" data-binding="">:</span> <a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a> <a href="Basic-Types/The-Unit-Type/#Unit"><span class="const token" data-binding="const-Unit" data-verso-hover="3">Unit</span></a> <span class="unknown token" data-binding="">:=</span> <a href="Functors___-Monads-and--do--Notation/Syntax/#Lean___Parser___Term___do"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-22">do</span></a>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-27">let</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Mutable-References/#IO___mkRef"><span class="const token" data-binding="const-IO.mkRef" data-verso-hover="3005">IO.mkRef</span></a> <span class="unknown token" data-binding="">(</span><span class="typed token" data-binding="" data-verso-hover="337">100</span> <span class="unknown token" data-binding="">:</span> <a href="Basic-Types/Integers/#Int___ofNat"><span class="const token" data-binding="const-Int" data-verso-hover="146">Int</span></a><span class="unknown token" data-binding="">)</span>

  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-67">let</span> <span class="keyword token" data-binding="kw-occ-null-71">mut</span> <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">#[</span><span class="unknown token" data-binding="">]</span>
  <a href="IO/Console-Output/#IO___println"><span class="const token" data-binding="const-IO.println" data-verso-hover="4">IO.println</span></a> <span class="literal string token" data-binding="" data-verso-hover="3007">"Sending out orders..."</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-128" data-verso-hover="1013">for</span> <span class="unknown token" data-binding="">_</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-132">in</span> <span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="7">0</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="7">100</span><span class="unknown token" data-binding="">]</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-128" data-verso-hover="1013">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-152">let</span> <span class="var token" data-binding="var-_uniq.1046" data-verso-hover="3008">o</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Tasks-and-Threads/#IO___asTask"><span class="const token" data-binding="const-IO.asTask" data-verso-hover="3009">IO.asTask</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">prio</span> <span class="unknown token" data-binding="">:=</span> <a href="IO/Tasks-and-Threads/#Task___Priority___dedicated"><span class="const token" data-binding="const-Task.Priority.dedicated" data-verso-hover="3010">.dedicated</span></a><span class="unknown token" data-binding="">)</span> <a href="Functors___-Monads-and--do--Notation/Syntax/#Lean___Parser___Term___do"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-193">do</span></a>
      <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-202">let</span> <span class="var token" data-binding="var-_uniq.545" data-verso-hover="7">cost</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Random-Numbers/#IO___rand"><span class="const token" data-binding="const-IO.rand" data-verso-hover="3011">IO.rand</span></a> <span class="typed token" data-binding="" data-verso-hover="7">1</span> <span class="typed token" data-binding="" data-verso-hover="7">100</span>
      <a href="IO/Timing/#IO___sleep"><span class="const token" data-binding="const-IO.sleep" data-verso-hover="3012">IO.sleep</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <a href="IO/Random-Numbers/#IO___rand"><span class="const token" data-binding="const-IO.rand" data-verso-hover="3011">IO.rand</span></a> <span class="typed token" data-binding="" data-verso-hover="7">10</span> <span class="typed token" data-binding="" data-verso-hover="7">100</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><a href="Basic-Types/Natural-Numbers/#Nat___toUInt32"><span class="const token" data-binding="const-Nat.toUInt32" data-verso-hover="3013">toUInt32</span></a>
      <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___modify"><span class="const token" data-binding="const-ST.Ref.modify" data-verso-hover="3017">modify</span></a> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-295">fun</span> <span class="var token" data-binding="var-_uniq.673" data-verso-hover="337">b</span> <span class="unknown token" data-binding="">=&gt;</span>
        <a href="Terms/Conditionals/#termIfThenElse"><span class="keyword token" data-binding="kw-occ-termIfThenElse-312" data-verso-hover="137">if</span></a> <span class="var token" data-binding="var-_uniq.545" data-verso-hover="7">cost</span> <span class="unknown token" data-binding="">&lt;</span> <span class="var token" data-binding="var-_uniq.673" data-verso-hover="337">b</span> <a href="Terms/Conditionals/#termIfThenElse"><span class="keyword token" data-binding="kw-occ-termIfThenElse-312" data-verso-hover="137">then</span></a>
          <span class="var token" data-binding="var-_uniq.673" data-verso-hover="337">b</span> <span class="unknown token" data-binding="">-</span> <span class="var token" data-binding="var-_uniq.545" data-verso-hover="7">cost</span>
        <a href="Terms/Conditionals/#termIfThenElse"><span class="keyword token" data-binding="kw-occ-termIfThenElse-312" data-verso-hover="137">else</span></a> <span class="var token" data-binding="var-_uniq.673" data-verso-hover="337">b</span>
    <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span><span class="unknown token" data-binding="">.</span><a href="Basic-Types/Arrays/#Array___push"><span class="const token" data-binding="const-Array.push" data-verso-hover="224">push</span></a> <span class="var token" data-binding="var-_uniq.1046" data-verso-hover="3008">o</span>

  -- Wait until all orders are completed
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-435" data-verso-hover="1013">for</span> <span class="var token" data-binding="var-_uniq.1305" data-verso-hover="3008">o</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-439">in</span> <span class="var token" data-binding="var-_uniq.368" data-verso-hover="3006">orders</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-435" data-verso-hover="1013">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-458">match</span> <span class="var token" data-binding="var-_uniq.1305" data-verso-hover="3008">o</span><span class="unknown token" data-binding="">.</span><a href="IO/Tasks-and-Threads/#Task___get"><span class="const token" data-binding="const-Task.get" data-verso-hover="3014">get</span></a> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-458">with</span>
    <span class="unknown token" data-binding="">|</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except.ok" data-verso-hover="1516">.ok</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=&gt;</span> <a href="Functors___-Monads-and--do--Notation/#Pure___mk"><span class="const token" data-binding="const-Pure.pure" data-verso-hover="1015">pure</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span>
    <span class="unknown token" data-binding="">|</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except.error" data-verso-hover="1514">.error</span></a> <span class="var token" data-binding="var-_uniq.1433" data-verso-hover="2981">e</span> <span class="unknown token" data-binding="">=&gt;</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#MonadExcept___mk"><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1457">throw</span></a> <span class="var token" data-binding="var-_uniq.1433" data-verso-hover="2981">e</span>

  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-528">if</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___get"><span class="const token" data-binding="const-ST.Ref.get" data-verso-hover="3002">get</span></a><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">&lt;</span> <span class="typed token" data-binding="" data-verso-hover="337">0</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-528">then</span>
    <a href="IO/Console-Output/#IO___eprintln"><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="2994">IO.eprintln</span></a> <span class="literal string token" data-binding="" data-verso-hover="3018">"Final balance negative!"</span>
  <span class="keyword token" data-binding="kw-occ-null-602">else</span>
    <a href="IO/Console-Output/#IO___println"><span class="const token" data-binding="const-IO.println" data-verso-hover="4">IO.println</span></a> <span class="literal string token" data-binding="" data-verso-hover="3016">"Final balance is zero or positive."</span>
<span class="unknown token" data-binding=""></span></code><div class="example-file">
                      <code>stdout</code><code class="line">Sending out orders...</code><code class="line">Final balance is zero or positive.</code></div>
                    <div class="example-file">
                      <code>stderr</code><code class="empty">&lt;empty&gt;</code></div>
                    </div>
                  </details><div class="namedocs" id="ST___Ref___modifyGet">
                  <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.modifyGet" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.modifyGet {<span class="var token" data-binding="var-_uniq.232" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.234" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.232" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.234" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î± </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="162">Î²</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.241" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.232" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î±</span>) (<span class="var token" data-binding="var-_uniq.243" data-verso-hover="3019">f</span> : <span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î±</span> â†’ <span class="var token" data-binding="var-_uniq.238" data-verso-hover="162">Î²</span><a href="Basic-Types/Tuples/#Prod___mk"><span class="const token" data-binding="const-Prod" data-verso-hover="189"> Ã— </span></a><span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.234" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.238" data-verso-hover="162">Î²</span></div><div class="narrow-only">ST.Ref.modifyGet {<span class="var token" data-binding="var-_uniq.232" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  {<span class="var token" data-binding="var-_uniq.234" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.232" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.234" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î± </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="162">Î²</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.241" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.232" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î±</span>)
  (<span class="var token" data-binding="var-_uniq.243" data-verso-hover="3019">f</span> : <span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î±</span> â†’ <span class="var token" data-binding="var-_uniq.238" data-verso-hover="162">Î²</span><a href="Basic-Types/Tuples/#Prod___mk"><span class="const token" data-binding="const-Prod" data-verso-hover="189"> Ã— </span></a><span class="var token" data-binding="var-_uniq.237" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.234" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.238" data-verso-hover="162">Î²</span></div></pre><div class="text">
                    <p>
                      Atomically modifies a mutable reference cell by replacing its contents with the result of a function
call that simultaneously computes a value to return.</p>
                    </div>
                  </div>
                <div class="namedocs" id="ST___Ref___swap">
                  <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.swap" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.swap {<span class="var token" data-binding="var-_uniq.250" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.252" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.250" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.252" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.258" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.250" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span>) (<span class="var token" data-binding="var-_uniq.259" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.252" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span></div><div class="narrow-only">ST.Ref.swap {<span class="var token" data-binding="var-_uniq.250" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.252" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.250" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.252" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.258" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.250" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span>) (<span class="var token" data-binding="var-_uniq.259" data-verso-hover="46">a</span> : <span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.252" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.255" data-verso-hover="162">Î±</span></div></pre><div class="text">
                    <p>
                      Atomically swaps the value of a mutable reference cell with another value. The reference cell's
original value is returned.</p>
                    </div>
                  </div>
                </section>
              <section>
                <h3 id="The-Lean-Language-Reference--IO--Mutable-References--State-Transformers--Comparisons">
                  15.4.1.2.Â Comparisons</h3>
                <div class="namedocs" id="ST___Ref___ptrEq">
                  <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.ptrEq" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.ptrEq {<span class="var token" data-binding="var-_uniq.284" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.286" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.284" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.286" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.289" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.290" data-verso-hover="3001">r1 </span><span class="var token" data-binding="var-_uniq.293" data-verso-hover="3001">r2</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.284" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.289" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.286" data-verso-hover="78">m</span> <a href="Basic-Types/Booleans/#Bool___false"><span class="const token" data-binding="const-Bool" data-verso-hover="155">Bool</span></a></div><div class="narrow-only">ST.Ref.ptrEq {<span class="var token" data-binding="var-_uniq.284" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.286" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.284" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.286" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.289" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.290" data-verso-hover="3001">r1 </span><span class="var token" data-binding="var-_uniq.293" data-verso-hover="3001">r2</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.284" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.289" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.286" data-verso-hover="78">m</span> <a href="Basic-Types/Booleans/#Bool___false"><span class="const token" data-binding="const-Bool" data-verso-hover="155">Bool</span></a></div></pre><div class="text">
                    <p>
                      Checks whether two reference cells are in fact aliases for the same cell.</p>
                    <p>
                      Even if they contain the same value, two references allocated by different executions of <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#IO___mkRef"><span class="const token" data-binding="const-IO.mkRef" data-verso-hover="3005">IO.mkRef</span></a></code>
or <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#ST___mkRef"><span class="const token" data-binding="const-ST.mkRef" data-verso-hover="3020">ST.mkRef</span></a></code> are distinct. Modifying one has no effect on the other. Likewise, a single reference
cell may be aliased, and modifications to one alias also modify the other.</p>
                    </div>
                  </div>
                </section>
              <section>
                <h3 id="The-Lean-Language-Reference--IO--Mutable-References--State-Transformers--ST--Backed-State-Monads">
                  15.4.1.3.Â <code>ST</code>-Backed State Monads</h3>
                <div class="namedocs" id="ST___Ref___toMonadStateOf">
                  <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.toMonadStateOf" title="Permalink">ðŸ”—</a></span><span class="label">def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.toMonadStateOf {<span class="var token" data-binding="var-_uniq.307" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.309" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.307" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.309" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.312" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.315" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.307" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.312" data-verso-hover="162">Î±</span>) : <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#MonadStateOf___mk"><span class="const token" data-binding="const-MonadStateOf" data-verso-hover="2844">MonadStateOf</span></a> <span class="var token" data-binding="var-_uniq.312" data-verso-hover="162">Î±</span> <span class="var token" data-binding="var-_uniq.309" data-verso-hover="78">m</span></div><div class="narrow-only">ST.Ref.toMonadStateOf {<span class="var token" data-binding="var-_uniq.307" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  {<span class="var token" data-binding="var-_uniq.309" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.307" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.309" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.312" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.315" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.307" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.312" data-verso-hover="162">Î±</span>) :
  <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#MonadStateOf___mk"><span class="const token" data-binding="const-MonadStateOf" data-verso-hover="2844">MonadStateOf</span></a> <span class="var token" data-binding="var-_uniq.312" data-verso-hover="162">Î±</span> <span class="var token" data-binding="var-_uniq.309" data-verso-hover="78">m</span></div></pre><div class="text">
                    <p>
                      Creates a <code class="hl lean inline" data-lean-context="docstring-examples"><a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#MonadStateOf___mk"><span class="const token" data-binding="const-MonadStateOf" data-verso-hover="2844">MonadStateOf</span></a></code> instance from a reference cell.</p>
                    <p>
                      This allows programs written against the <a href="https://lean-lang.org/doc/reference/4.20.0-rc5/find/?domain=Verso.Genre.Manual.section&name=state-monads">state monad</a> API to
be executed using a mutable reference cell to track the state.</p>
                    </div>
                  </div>
                </section>
              </section>
            <section>
              <h2 id="ref-locks">
                15.4.2.Â Concurrency<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&name=ref-locks" title="Permalink">ðŸ”—</a></span></h2>
              <p>
                Mutable references can be used as a locking mechanism.
<em>Taking</em> the contents of the reference causes attempts to take it or to read from it to block until it is <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___set"><span class="const token" data-binding="const-ST.Ref.set" data-verso-hover="3003">set</span></a></code> again.
This is a low-level feature that can be used to implement other synchronization mechanisms; it's usually better to rely on higher-level abstractions when possible.</p>
              <div class="namedocs" id="ST___Ref___take">
                <span class="permalink-widget block"><a href="find/?domain=Verso.Genre.Manual.doc&name=ST.Ref.take" title="Permalink">ðŸ”—</a></span><span class="label">unsafe def</span><pre class="signature hl lean block"><div class="wide-only">ST.Ref.take {<span class="var token" data-binding="var-_uniq.346" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.348" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.346" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.348" data-verso-hover="78">m</span>]
  {<span class="var token" data-binding="var-_uniq.351" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} (<span class="var token" data-binding="var-_uniq.354" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.346" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.351" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.348" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.351" data-verso-hover="162">Î±</span></div><div class="narrow-only">ST.Ref.take {<span class="var token" data-binding="var-_uniq.346" data-verso-hover="162">Ïƒ</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>} {<span class="var token" data-binding="var-_uniq.348" data-verso-hover="78">m</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span> â†’ <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  [<a href="Functors___-Monads-and--do--Notation/Lifting-Monads/#MonadLiftT___mk"><span class="const token" data-binding="const-MonadLiftT" data-verso-hover="79">MonadLiftT</span></a> (<a href="IO/Mutable-References/#ST"><span class="const token" data-binding="const-ST" data-verso-hover="2897">ST</span></a> <span class="var token" data-binding="var-_uniq.346" data-verso-hover="162">Ïƒ</span>) <span class="var token" data-binding="var-_uniq.348" data-verso-hover="78">m</span>] {<span class="var token" data-binding="var-_uniq.351" data-verso-hover="162">Î±</span> : <span class="sort token" data-binding="" data-verso-hover="50">Type</span>}
  (<span class="var token" data-binding="var-_uniq.354" data-verso-hover="3001">r</span> : <a href="IO/Mutable-References/#ST___Ref___mk"><span class="const token" data-binding="const-ST.Ref" data-verso-hover="2877">ST.Ref</span></a> <span class="var token" data-binding="var-_uniq.346" data-verso-hover="162">Ïƒ</span> <span class="var token" data-binding="var-_uniq.351" data-verso-hover="162">Î±</span>) : <span class="var token" data-binding="var-_uniq.348" data-verso-hover="78">m</span> <span class="var token" data-binding="var-_uniq.351" data-verso-hover="162">Î±</span></div></pre><div class="text">
                  <p>
                    Reads the value of a mutable reference cell, removing it.</p>
                  <p>
                    This causes subsequent attempts to read from or take the reference cell to block until a new value
is written using <code class="hl lean inline" data-lean-context="docstring-examples"><a href="IO/Mutable-References/#ST___Ref___set"><span class="const token" data-binding="const-ST.Ref.set" data-verso-hover="3003">ST.Ref.set</span></a></code>.</p>
                  </div>
                </div>
              <details class="example"><summary class="description">Reference Cells as Locks</summary><div class="example-content">
                  <p>
                    This program launches 100 threads.
Each thread simulates a purchase attempt: it generates a random price, and if the account balance is sufficient, it decrements it by the price.
If the balance is not sufficient, then it is not decremented.
Because each thread <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___take"><span class="const token" data-binding="const-ST.Ref.take" data-verso-hover="3021">take</span></a></code>s the balance cell prior to checking it and only returns it when it is finished, the cell acts as a lock.
Unlike using <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___modify"><span class="const token" data-binding="const-ST.Ref.modify" data-verso-hover="3017">ST.Ref.modify</span></a></code>, which atomically modifies the contents of the cell using a pure function, other <code class="hl lean inline" data-lean-context="examples"><a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a></code> actions may occur in the critical section
This program's <code>main</code> function is marked <span class="hl lean keyword-of"><code class="hover-info"><code>Lean.Parser.Command.declaration : command</code></code><code class="kw">unsafe</code></span> because <code class="hl lean inline" data-lean-context="examples"><a href="IO/Mutable-References/#ST___Ref___take"><span class="const token" data-binding="const-ST.Ref.take" data-verso-hover="3021">take</span></a></code> itself is unsafe.</p>
                  <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.unsafe-0">unsafe</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7">def</span> <span class="const token" data-binding="const-main" data-verso-hover="2772">main</span> <span class="unknown token" data-binding="">:</span> <a href="IO/Logical-Model/#IO"><span class="const token" data-binding="const-IO" data-verso-hover="1">IO</span></a> <a href="Basic-Types/The-Unit-Type/#Unit"><span class="const token" data-binding="const-Unit" data-verso-hover="3">Unit</span></a> <span class="unknown token" data-binding="">:=</span> <a href="Functors___-Monads-and--do--Notation/Syntax/#Lean___Parser___Term___do"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-29">do</span></a>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-34">let</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Mutable-References/#IO___mkRef"><span class="const token" data-binding="const-IO.mkRef" data-verso-hover="3005">IO.mkRef</span></a> <span class="unknown token" data-binding="">(</span><span class="typed token" data-binding="" data-verso-hover="337">100</span> <span class="unknown token" data-binding="">:</span> <a href="Basic-Types/Integers/#Int___ofNat"><span class="const token" data-binding="const-Int" data-verso-hover="146">Int</span></a><span class="unknown token" data-binding="">)</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-73">let</span> <span class="var token" data-binding="var-_uniq.189" data-verso-hover="3022">validationUsed</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Mutable-References/#IO___mkRef"><span class="const token" data-binding="const-IO.mkRef" data-verso-hover="3005">IO.mkRef</span></a> <a href="Basic-Types/Booleans/#Bool___false"><span class="const token" data-binding="const-Bool.false" data-verso-hover="40">false</span></a>

  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-114">let</span> <span class="keyword token" data-binding="kw-occ-null-118">mut</span> <span class="var token" data-binding="var-_uniq.415" data-verso-hover="3006">orders</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">#[</span><span class="unknown token" data-binding="">]</span>

  <a href="IO/Console-Output/#IO___println"><span class="const token" data-binding="const-IO.println" data-verso-hover="4">IO.println</span></a> <span class="literal string token" data-binding="" data-verso-hover="3007">"Sending out orders..."</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-176" data-verso-hover="1013">for</span> <span class="unknown token" data-binding="">_</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-180">in</span> <span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="7">0</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="7">100</span><span class="unknown token" data-binding="">]</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-176" data-verso-hover="1013">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-200">let</span> <span class="var token" data-binding="var-_uniq.1232" data-verso-hover="3008">o</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Tasks-and-Threads/#IO___asTask"><span class="const token" data-binding="const-IO.asTask" data-verso-hover="3009">IO.asTask</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">prio</span> <span class="unknown token" data-binding="">:=</span> <a href="IO/Tasks-and-Threads/#Task___Priority___dedicated"><span class="const token" data-binding="const-Task.Priority.dedicated" data-verso-hover="3010">.dedicated</span></a><span class="unknown token" data-binding="">)</span> <a href="Functors___-Monads-and--do--Notation/Syntax/#Lean___Parser___Term___do"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-241">do</span></a>
      <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-250">let</span> <span class="var token" data-binding="var-_uniq.592" data-verso-hover="7">cost</span> <span class="unknown token" data-binding="">â†</span> <a href="IO/Random-Numbers/#IO___rand"><span class="const token" data-binding="const-IO.rand" data-verso-hover="3011">IO.rand</span></a> <span class="typed token" data-binding="" data-verso-hover="7">1</span> <span class="typed token" data-binding="" data-verso-hover="7">100</span>
      <a href="IO/Timing/#IO___sleep"><span class="const token" data-binding="const-IO.sleep" data-verso-hover="3012">IO.sleep</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <a href="IO/Random-Numbers/#IO___rand"><span class="const token" data-binding="const-IO.rand" data-verso-hover="3011">IO.rand</span></a> <span class="typed token" data-binding="" data-verso-hover="7">10</span> <span class="typed token" data-binding="" data-verso-hover="7">100</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><a href="Basic-Types/Natural-Numbers/#Nat___toUInt32"><span class="const token" data-binding="const-Nat.toUInt32" data-verso-hover="3013">toUInt32</span></a>
      <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-328">let</span> <span class="var token" data-binding="var-_uniq.829" data-verso-hover="337">b</span> <span class="unknown token" data-binding="">â†</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___take"><span class="const token" data-binding="const-ST.Ref.take" data-verso-hover="3021">take</span></a>
      <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-357">if</span> <span class="var token" data-binding="var-_uniq.592" data-verso-hover="7">cost</span> <span class="unknown token" data-binding="">â‰¤</span> <span class="var token" data-binding="var-_uniq.829" data-verso-hover="337">b</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-357">then</span>
        <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___set"><span class="const token" data-binding="const-ST.Ref.set" data-verso-hover="3003">set</span></a> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.829" data-verso-hover="337">b</span> <span class="unknown token" data-binding="">-</span> <span class="var token" data-binding="var-_uniq.592" data-verso-hover="7">cost</span><span class="unknown token" data-binding="">)</span>
      <span class="keyword token" data-binding="kw-occ-null-413">else</span>
        <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___set"><span class="const token" data-binding="const-ST.Ref.set" data-verso-hover="3003">set</span></a> <span class="var token" data-binding="var-_uniq.829" data-verso-hover="337">b</span>
        <span class="var token" data-binding="var-_uniq.189" data-verso-hover="3022">validationUsed</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___set"><span class="const token" data-binding="const-ST.Ref.set" data-verso-hover="3003">set</span></a> <a href="Basic-Types/Booleans/#Bool___false"><span class="const token" data-binding="const-Bool.true" data-verso-hover="41">true</span></a>
    <span class="var token" data-binding="var-_uniq.415" data-verso-hover="3006">orders</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.415" data-verso-hover="3006">orders</span><span class="unknown token" data-binding="">.</span><a href="Basic-Types/Arrays/#Array___push"><span class="const token" data-binding="const-Array.push" data-verso-hover="224">push</span></a> <span class="var token" data-binding="var-_uniq.1232" data-verso-hover="3008">o</span>

  -- Wait until all orders are completed
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-544" data-verso-hover="1013">for</span> <span class="var token" data-binding="var-_uniq.1491" data-verso-hover="3008">o</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-548">in</span> <span class="var token" data-binding="var-_uniq.415" data-verso-hover="3006">orders</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-544" data-verso-hover="1013">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-567">match</span> <span class="var token" data-binding="var-_uniq.1491" data-verso-hover="3008">o</span><span class="unknown token" data-binding="">.</span><a href="IO/Tasks-and-Threads/#Task___get"><span class="const token" data-binding="const-Task.get" data-verso-hover="3014">get</span></a> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-567">with</span>
    <span class="unknown token" data-binding="">|</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except.ok" data-verso-hover="1516">.ok</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=&gt;</span> <a href="Functors___-Monads-and--do--Notation/#Pure___mk"><span class="const token" data-binding="const-Pure.pure" data-verso-hover="1015">pure</span></a> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span>
    <span class="unknown token" data-binding="">|</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#Except___error"><span class="const token" data-binding="const-Except.error" data-verso-hover="1514">.error</span></a> <span class="var token" data-binding="var-_uniq.1619" data-verso-hover="2981">e</span> <span class="unknown token" data-binding="">=&gt;</span> <a href="Functors___-Monads-and--do--Notation/Varieties-of-Monads/#MonadExcept___mk"><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1457">throw</span></a> <span class="var token" data-binding="var-_uniq.1619" data-verso-hover="2981">e</span>

  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-637">if</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <span class="var token" data-binding="var-_uniq.189" data-verso-hover="3022">validationUsed</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___get"><span class="const token" data-binding="const-ST.Ref.get" data-verso-hover="3002">get</span></a><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-637">then</span>
    <a href="IO/Console-Output/#IO___println"><span class="const token" data-binding="const-IO.println" data-verso-hover="4">IO.println</span></a> <span class="literal string token" data-binding="" data-verso-hover="3023">"Validation prevented a negative balance."</span>

  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-731">if</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">â†</span> <span class="var token" data-binding="var-_uniq.142" data-verso-hover="3004">balance</span><span class="unknown token" data-binding="">.</span><a href="IO/Mutable-References/#ST___Ref___get"><span class="const token" data-binding="const-ST.Ref.get" data-verso-hover="3002">get</span></a><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">&lt;</span> <span class="typed token" data-binding="" data-verso-hover="337">0</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-731">then</span>
    <a href="IO/Console-Output/#IO___eprintln"><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="2994">IO.eprintln</span></a> <span class="literal string token" data-binding="" data-verso-hover="3018">"Final balance negative!"</span>
  <span class="keyword token" data-binding="kw-occ-null-805">else</span>
    <a href="IO/Console-Output/#IO___println"><span class="const token" data-binding="const-IO.println" data-verso-hover="4">IO.println</span></a> <span class="literal string token" data-binding="" data-verso-hover="3016">"Final balance is zero or positive."</span>
<span class="unknown token" data-binding=""></span></code><p>
                    The program's output is:</p>
                  <div class="example-file">
                    <code>stdout</code><code class="line">Sending out orders...</code><code class="line">Validation prevented a negative balance.</code><code class="line">Final balance is zero or positive.</code></div>
                  </div>
                </details></section>
            </section>
          <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=11415071-5949-444a-8c93-ef0905bcd026"><nav class="prev-next-buttons">
            <a class="local-button active" href="IO/Console-Output/#The-Lean-Language-Reference--IO--Console-Output" rel="prev" title="15.3. Console Output"><span class="arrow">â†</span><span class="where">15.3. Console Output</span></a><a class="local-button active" href="IO/Files___-File-Handles___-and-Streams/#The-Lean-Language-Reference--IO--Files___-File-Handles___-and-Streams" rel="next" title="15.5. Files, File Handles, and Streams"><span class="where">15.5. Files, File Handles, and Streams</span><span class="arrow">â†’</span></a></nav>
          </div>
        </main></div>
    </body>
  </html>

