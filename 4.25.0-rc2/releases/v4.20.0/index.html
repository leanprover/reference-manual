<!DOCTYPE html>
<html>
  <head>
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <base href="./../../"><meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>Lean 4.20.0 (2025-06-02)</title><link rel="stylesheet" href="book.css">
    <link rel="stylesheet" href="verso-vars.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="-verso-search/elasticlunr.min.js"></script>
    <script src="-verso-search/fuzzysort.js"></script>
    <script src="-verso-search/searchIndex.js"></script>
    <script type="module" src="-verso-search/search-init.js"></script>
    <link rel="stylesheet" href="-verso-search/search-box.css">
    <link rel="stylesheet" href="-verso-search/search-highlight.css">
    <link rel="stylesheet" href="-verso-search/domain-display.css">
    <script src="-verso-data/katex/katex.js"></script>
    <script src="-verso-data/katex/math.js"></script>
    <script src="-verso-data/popper.min.js"></script>
    <script src="-verso-data/tippy-bundle.umd.min.js"></script>
    <link rel="stylesheet" href="-verso-data/katex/katex.css">
    <link rel="stylesheet" href="-verso-data/tippy-border.css">
    <style>
a.elan-command {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.elan-command:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>
a.lake-command {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.lake-command:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>
span.TODO {
  border: 3px solid red;
  display: inline;
  position: relative;
  float: right;
  clear: right;
  margin-top: 1rem;
  width: 15vw;
  margin-right: -17vw;
  color: red;
  font-size: large;
  font-weight: bold;
}
</style><style>
.hl.lean.tactic-view {
  white-space: collapse;
}
.hl.lean.tactic-view .tactic-state {
  display: block;
  left: 0;
  padding: 0;
  border: none;
}
.hl.lean.tactic-view .tactic-state .goal {
  margin-top: 1em;
  margin-bottom: 1em;
  display: block;
}
.hl.lean.tactic-view .tactic-state .goal:first-child {
  margin-top: 0.25em;
}
.hl.lean.tactic-view .tactic-state .goal:last-child {
  margin-bottom: 0.25em;
}


</style><style>
.namedocs .title {
  font-family: var(--verso-structure-font-family);
  font-size: 1.1rem;
  margin-top: 0;
  margin-left: 1rem;
  margin-right: 1.5rem;
  margin-bottom: 0.75rem;
  display: inline-block;
}
</style><style>
.marginalia .note {
  position: relative;
  padding: 0.5rem;
}

/* Wide viewport */
@media screen and (min-width: 1400px) {
  .marginalia .note {
    float: right;
    clear: right;
    margin-right: -16rem;
    width: 13rem;
    margin-top: 1rem;
  }
}

/* Very wide viewport */
@media screen and (min-width: 1600px) {
  .marginalia .note {
    margin-right: -19vw;
    width: 15vw;
  }
}

.marginalia:hover, .marginalia:hover .note, .marginalia:has(.note:hover) {
  background-color: var(--lean-accent-light-blue);
}

/* Medium viewport */
@media screen and (700px < width <= 1400px) {
  .marginalia .note {
    float: right;
    clear: right;
    width: 40%;
    margin: 1rem 0;
    margin-left: 10%;
  }
}

/* Narrow viewport (e.g. phone) */
@media screen and (width <= 700px) {
  .marginalia .note {
    float: left;
    clear: left;
    width: 90%;
    margin: 1rem 5%;
  }
}

body {
  counter-reset: margin-note-counter;
}
.marginalia .note {
  counter-increment: margin-note-counter;
}
.marginalia .note::before {
  content: counter(margin-note-counter) ".";
  position: absolute;
  vertical-align: baseline;
  font-size: 0.9em;
  font-weight: bold;
  left: -3rem;
  width: 3rem;
  text-align: right;
}
.marginalia::after {
  content: counter(margin-note-counter);
  vertical-align: super;
  font-size: 0.7em;
  font-weight: bold;
  margin-right: 0.5em;
}
</style><style>
.namedocs {
  position: relative;
  border: solid 1px #98B2C0;
  border-radius: .5rem;
  padding-top: var(--verso--box-padding);
  margin-top: var(--verso--box-vertical-margin);
  margin-bottom: var(--verso--box-vertical-margin);
}

.namedocs .text {
  /* Causes margins on child elements to collapse inside the element, such
     that the margins don't extend into parent with the background color.
     The effect is that weird borders in the definition box don't happen anymore. */
  display: flow-root;
  /* Add a padding. this is the same as the margin applied to the first and last child.
     The effect is that the padding looks the same size on all sides. */
  padding: 0 var(--verso--box-padding);
  border-top: 1px solid #98B2C0;
}

.namedocs .text > pre {
  overflow-x: auto;
}

.namedocs .signature {
  font-family: var(--verso-code-font-family);
  margin-top: 0 !important;
  margin-left: var(--verso--box-padding) !important;
  margin-bottom: .75rem !important;
}

.namedocs .label {
  display: block;
  font-size: small;
  font-family: var(--verso-structure-font-family);
  position: absolute;
  top: -0.65rem;
  left: 1rem;
  background: #fff;
  padding: 0 .5rem .125rem;
  border: 1px solid #98B2C0;
  border-radius: 1rem;
  color: #555;
}

.namedocs h1 {
  font-size: inherit;
  font-weight: bold
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.namedocs > .text .constructor {
  padding-top: 0;
  padding-right: 0;
  padding-bottom: 0;
  margin-top: 0.5rem;
  margin-bottom: 1.5rem;
}

.namedocs > .text .constructor::before {
  content: '| ';
  display: block;
  font-family: var(--verso-code-font-family);
  font-weight: bold;
  float: left;
  width: 0.5rem;
  white-space: pre;
}

.namedocs > .text .constructor .name-and-type {
  padding-left: 0.5rem;
  float: left;
  margin-top: 0;
  max-width: calc(100% - 1rem);
}
.namedocs > .text .constructor .docs {
  clear: both;
  padding-left: 1rem;
}

/* These margins work together with the padding on .text */
.namedocs .text > :first-child {
  margin-top: var(--verso--box-padding);
}
.namedocs .text > :last-child {
  margin-bottom: var(--verso--box-padding);
}

.namedocs .methods td, .namedocs .fields td {
  vertical-align: top;
}
.namedocs .inheritance {
  vertical-align: top;
  font-size: smaller;
  font-family: var(--verso-structure-font-family);
}
.namedocs .inheritance ol {
  display: inline-block;
  margin: 0;
  padding: 0;
}
.namedocs .inheritance ol li {
  list-style-type: none;
  display: inline-block;
}
.namedocs .inheritance ol li::after {
  content: " > "
}
.namedocs .inheritance ol li:last-child::after {
  content: "";
}

.namedocs .extends {
  display: inline;
  margin: 0;
  padding: 0;
}

.namedocs .extends li {
  list-style-type: none;
  display: inline-block;
}

.namedocs .extends li label {
  padding-right: 1rem;
}

.namedocs .subdocs .name-and-type {
  font-size: 1rem;
  margin-left: 0;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs .subdocs .docs {
  margin-left: 1.5rem;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs:has(input[data-parent-idx]) [data-inherited-from] {
  transition-property: opacity, display;
  transition-duration: 0.4s;
  transition-behavior: allow-discrete;
  @starting-style { opacity: 0 !important; }
}

#this-page-items .tactic-name { font-weight: bold; }
.namedocs:has(input[data-parent-idx="0"]) [data-inherited-from="0"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="0"]:checked) [data-inherited-from="0"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="0"]:checked):has(.inheritance[data-inherited-from="0"]:hover) [data-inherited-from]:not([data-inherited-from="0"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="1"]) [data-inherited-from="1"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="1"]:checked) [data-inherited-from="1"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="1"]:checked):has(.inheritance[data-inherited-from="1"]:hover) [data-inherited-from]:not([data-inherited-from="1"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="2"]) [data-inherited-from="2"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="2"]:checked) [data-inherited-from="2"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="2"]:checked):has(.inheritance[data-inherited-from="2"]:hover) [data-inherited-from]:not([data-inherited-from="2"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="3"]) [data-inherited-from="3"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="3"]:checked) [data-inherited-from="3"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="3"]:checked):has(.inheritance[data-inherited-from="3"]:hover) [data-inherited-from]:not([data-inherited-from="3"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="4"]) [data-inherited-from="4"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="4"]:checked) [data-inherited-from="4"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="4"]:checked):has(.inheritance[data-inherited-from="4"]:hover) [data-inherited-from]:not([data-inherited-from="4"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="5"]) [data-inherited-from="5"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="5"]:checked) [data-inherited-from="5"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="5"]:checked):has(.inheritance[data-inherited-from="5"]:hover) [data-inherited-from]:not([data-inherited-from="5"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="6"]) [data-inherited-from="6"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="6"]:checked) [data-inherited-from="6"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="6"]:checked):has(.inheritance[data-inherited-from="6"]:hover) [data-inherited-from]:not([data-inherited-from="6"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="7"]) [data-inherited-from="7"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="7"]:checked) [data-inherited-from="7"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="7"]:checked):has(.inheritance[data-inherited-from="7"]:hover) [data-inherited-from]:not([data-inherited-from="7"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="8"]) [data-inherited-from="8"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="8"]:checked) [data-inherited-from="8"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="8"]:checked):has(.inheritance[data-inherited-from="8"]:hover) [data-inherited-from]:not([data-inherited-from="8"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="9"]) [data-inherited-from="9"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="9"]:checked) [data-inherited-from="9"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="9"]:checked):has(.inheritance[data-inherited-from="9"]:hover) [data-inherited-from]:not([data-inherited-from="9"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="10"]) [data-inherited-from="10"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="10"]:checked) [data-inherited-from="10"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="10"]:checked):has(.inheritance[data-inherited-from="10"]:hover) [data-inherited-from]:not([data-inherited-from="10"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="11"]) [data-inherited-from="11"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="11"]:checked) [data-inherited-from="11"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="11"]:checked):has(.inheritance[data-inherited-from="11"]:hover) [data-inherited-from]:not([data-inherited-from="11"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="12"]) [data-inherited-from="12"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="12"]:checked) [data-inherited-from="12"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="12"]:checked):has(.inheritance[data-inherited-from="12"]:hover) [data-inherited-from]:not([data-inherited-from="12"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="13"]) [data-inherited-from="13"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="13"]:checked) [data-inherited-from="13"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="13"]:checked):has(.inheritance[data-inherited-from="13"]:hover) [data-inherited-from]:not([data-inherited-from="13"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="14"]) [data-inherited-from="14"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="14"]:checked) [data-inherited-from="14"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="14"]:checked):has(.inheritance[data-inherited-from="14"]:hover) [data-inherited-from]:not([data-inherited-from="14"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="15"]) [data-inherited-from="15"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="15"]:checked) [data-inherited-from="15"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="15"]:checked):has(.inheritance[data-inherited-from="15"]:hover) [data-inherited-from]:not([data-inherited-from="15"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="16"]) [data-inherited-from="16"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="16"]:checked) [data-inherited-from="16"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="16"]:checked):has(.inheritance[data-inherited-from="16"]:hover) [data-inherited-from]:not([data-inherited-from="16"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="17"]) [data-inherited-from="17"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="17"]:checked) [data-inherited-from="17"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="17"]:checked):has(.inheritance[data-inherited-from="17"]:hover) [data-inherited-from]:not([data-inherited-from="17"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="18"]) [data-inherited-from="18"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="18"]:checked) [data-inherited-from="18"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="18"]:checked):has(.inheritance[data-inherited-from="18"]:hover) [data-inherited-from]:not([data-inherited-from="18"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="19"]) [data-inherited-from="19"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="19"]:checked) [data-inherited-from="19"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="19"]:checked):has(.inheritance[data-inherited-from="19"]:hover) [data-inherited-from]:not([data-inherited-from="19"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="20"]) [data-inherited-from="20"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="20"]:checked) [data-inherited-from="20"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="20"]:checked):has(.inheritance[data-inherited-from="20"]:hover) [data-inherited-from]:not([data-inherited-from="20"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="21"]) [data-inherited-from="21"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="21"]:checked) [data-inherited-from="21"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="21"]:checked):has(.inheritance[data-inherited-from="21"]:hover) [data-inherited-from]:not([data-inherited-from="21"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="22"]) [data-inherited-from="22"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="22"]:checked) [data-inherited-from="22"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="22"]:checked):has(.inheritance[data-inherited-from="22"]:hover) [data-inherited-from]:not([data-inherited-from="22"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="23"]) [data-inherited-from="23"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="23"]:checked) [data-inherited-from="23"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="23"]:checked):has(.inheritance[data-inherited-from="23"]:hover) [data-inherited-from]:not([data-inherited-from="23"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="24"]) [data-inherited-from="24"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="24"]:checked) [data-inherited-from="24"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="24"]:checked):has(.inheritance[data-inherited-from="24"]:hover) [data-inherited-from]:not([data-inherited-from="24"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="25"]) [data-inherited-from="25"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="25"]:checked) [data-inherited-from="25"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="25"]:checked):has(.inheritance[data-inherited-from="25"]:hover) [data-inherited-from]:not([data-inherited-from="25"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="26"]) [data-inherited-from="26"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="26"]:checked) [data-inherited-from="26"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="26"]:checked):has(.inheritance[data-inherited-from="26"]:hover) [data-inherited-from]:not([data-inherited-from="26"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="27"]) [data-inherited-from="27"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="27"]:checked) [data-inherited-from="27"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="27"]:checked):has(.inheritance[data-inherited-from="27"]:hover) [data-inherited-from]:not([data-inherited-from="27"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="28"]) [data-inherited-from="28"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="28"]:checked) [data-inherited-from="28"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="28"]:checked):has(.inheritance[data-inherited-from="28"]:hover) [data-inherited-from]:not([data-inherited-from="28"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="29"]) [data-inherited-from="29"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="29"]:checked) [data-inherited-from="29"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="29"]:checked):has(.inheritance[data-inherited-from="29"]:hover) [data-inherited-from]:not([data-inherited-from="29"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="30"]) [data-inherited-from="30"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="30"]:checked) [data-inherited-from="30"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="30"]:checked):has(.inheritance[data-inherited-from="30"]:hover) [data-inherited-from]:not([data-inherited-from="30"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="31"]) [data-inherited-from="31"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="31"]:checked) [data-inherited-from="31"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="31"]:checked):has(.inheritance[data-inherited-from="31"]:hover) [data-inherited-from]:not([data-inherited-from="31"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="32"]) [data-inherited-from="32"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="32"]:checked) [data-inherited-from="32"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="32"]:checked):has(.inheritance[data-inherited-from="32"]:hover) [data-inherited-from]:not([data-inherited-from="32"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="33"]) [data-inherited-from="33"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="33"]:checked) [data-inherited-from="33"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="33"]:checked):has(.inheritance[data-inherited-from="33"]:hover) [data-inherited-from]:not([data-inherited-from="33"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="34"]) [data-inherited-from="34"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="34"]:checked) [data-inherited-from="34"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="34"]:checked):has(.inheritance[data-inherited-from="34"]:hover) [data-inherited-from]:not([data-inherited-from="34"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="35"]) [data-inherited-from="35"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="35"]:checked) [data-inherited-from="35"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="35"]:checked):has(.inheritance[data-inherited-from="35"]:hover) [data-inherited-from]:not([data-inherited-from="35"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="36"]) [data-inherited-from="36"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="36"]:checked) [data-inherited-from="36"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="36"]:checked):has(.inheritance[data-inherited-from="36"]:hover) [data-inherited-from]:not([data-inherited-from="36"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="37"]) [data-inherited-from="37"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="37"]:checked) [data-inherited-from="37"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="37"]:checked):has(.inheritance[data-inherited-from="37"]:hover) [data-inherited-from]:not([data-inherited-from="37"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="38"]) [data-inherited-from="38"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="38"]:checked) [data-inherited-from="38"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="38"]:checked):has(.inheritance[data-inherited-from="38"]:hover) [data-inherited-from]:not([data-inherited-from="38"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="39"]) [data-inherited-from="39"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="39"]:checked) [data-inherited-from="39"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="39"]:checked):has(.inheritance[data-inherited-from="39"]:hover) [data-inherited-from]:not([data-inherited-from="39"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="40"]) [data-inherited-from="40"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="40"]:checked) [data-inherited-from="40"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="40"]:checked):has(.inheritance[data-inherited-from="40"]:hover) [data-inherited-from]:not([data-inherited-from="40"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="41"]) [data-inherited-from="41"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="41"]:checked) [data-inherited-from="41"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="41"]:checked):has(.inheritance[data-inherited-from="41"]:hover) [data-inherited-from]:not([data-inherited-from="41"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="42"]) [data-inherited-from="42"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="42"]:checked) [data-inherited-from="42"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="42"]:checked):has(.inheritance[data-inherited-from="42"]:hover) [data-inherited-from]:not([data-inherited-from="42"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="43"]) [data-inherited-from="43"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="43"]:checked) [data-inherited-from="43"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="43"]:checked):has(.inheritance[data-inherited-from="43"]:hover) [data-inherited-from]:not([data-inherited-from="43"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="44"]) [data-inherited-from="44"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="44"]:checked) [data-inherited-from="44"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="44"]:checked):has(.inheritance[data-inherited-from="44"]:hover) [data-inherited-from]:not([data-inherited-from="44"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="45"]) [data-inherited-from="45"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="45"]:checked) [data-inherited-from="45"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="45"]:checked):has(.inheritance[data-inherited-from="45"]:hover) [data-inherited-from]:not([data-inherited-from="45"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="46"]) [data-inherited-from="46"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="46"]:checked) [data-inherited-from="46"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="46"]:checked):has(.inheritance[data-inherited-from="46"]:hover) [data-inherited-from]:not([data-inherited-from="46"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="47"]) [data-inherited-from="47"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="47"]:checked) [data-inherited-from="47"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="47"]:checked):has(.inheritance[data-inherited-from="47"]:hover) [data-inherited-from]:not([data-inherited-from="47"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="48"]) [data-inherited-from="48"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="48"]:checked) [data-inherited-from="48"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="48"]:checked):has(.inheritance[data-inherited-from="48"]:hover) [data-inherited-from]:not([data-inherited-from="48"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="49"]) [data-inherited-from="49"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="49"]:checked) [data-inherited-from="49"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="49"]:checked):has(.inheritance[data-inherited-from="49"]:hover) [data-inherited-from]:not([data-inherited-from="49"]) {
  opacity: 0.5;
}
</style><style>
.field-category > :first-child {
}

.field-category > :not(:first-child) {
  margin-left: 1rem;
}
</style><style>
dl.toml-table-field-spec {
}
</style><style>
.example-file {
  white-space: normal;
  font-family: var(--verso-structure-font-family);
  margin: 1rem;
  width: fit-content;
  border: 1px solid #ddd;
  padding: 0.5rem;

  /* These are necessary for the container to behave nicely on mobile */
  overflow-x: auto;
  max-width: 100%;
  box-sizing: border-box;
}
.example-file::before {
  counter-reset: linenumber;
}
.example-file > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.example-file > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
.example-file > .line::after {
  -webkit-user-select: none;
  display: inline-block;
  content: "âŽ";
  opacity: 0;
}
.example-file > .line:hover::after {
  opacity: 1;
}
.example-file > .line:hover, .example-file > .line:hover::before {
  background-color: #eee;
}
.example-file > .empty {
  display: block;
  white-space: pre;
  font-family: var(--verso-code-font-family);
  font-style: italic;
}
.example-file > .empty::before {
  -webkit-user-select: none;
  display: inline-block;
  content: "";
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
</style><style>.example {
  border: 1px solid #98B2C0;
  border-radius: 0.5rem;
  margin-bottom: var(--verso--box-vertical-margin);
  margin-top: var(--verso--box-vertical-margin);
}
/* 1400 px is the cutoff for when the margin notes move out of the margin and into floated elements. */
@media screen and (700px < width <= 1400px) {
  .example {
    clear: both; /* Don't overlap margin notes with examples */
  }
}
.example .description::before {
  content: "Example: ";
}
.example .description {
  font-style: italic;
  font-family: var(--verso-structure-font-family);
  padding: var(--verso--box-padding);
}
.example[open] .description {
  margin-bottom: 0;
}
.example-content {
  padding: 0 var(--verso--box-padding) var(--verso--box-padding);
  position: relative;
}
.example-content > :first-child {
  margin-top: 0;
}
.example-content p:last-child {
  margin-bottom:0;
}
.example .hl.lean.block {
  overflow-x: auto;
}
.live-link {
  font-family: var(--verso-structure-font-family);
  position: absolute;
  bottom: 0px;
  right: 0px;
  padding: 0.5rem;
  border-top: 1px solid #98B2C0;
  border-left: 1px solid #98B2C0;
  border-top-left-radius: 0.5rem;
}
.live-link a {
  text-decoration: none;
  color: var(--lean-blue);
}
</style><style>.keyword-of .kw {
  font-weight: 500;
}
.keyword-of .hover-info {
  display: none;
}
.keyword-of .kw:hover {
  background-color: #eee;
  border-radius: 2px;
}
</style><style>.grammar .keyword {
  font-weight: 500 !important;
}

.grammar {
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
}

.grammar .comment {
  font-style: italic;
  font-family: var(--verso-text-font-family);
  /* TODO add background and text colors to Verso theme, then compute a background here */
  background-color: #fafafa;
  border: 1px solid #f0f0f0;
}

.grammar .local-name {
  font-family: var(--verso-code-font-family);
  font-style: italic;
}

.grammar .nonterminal {
  font-style: italic;
}
.grammar .nonterminal > .hover-info, .grammar .from-nonterminal > .hover-info, .grammar .local-name > .hover-info {
  display: none;
}
.grammar .active {
  background-color: #eee;
  border-radius: 2px;
}
.grammar a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
</style><style>
.c .type { font-weight: 600; }
.c .kw { font-weight: 600; }
.c .comment { font-style: italic; }
</style><style>.namedocs .label a { color: inherit; }</style><style>#toc .split-toc > ol .syntax .keyword { font-family: var(--verso-code-font-family); font-weight: 600; }</style><style>
  .error-explanation-metadata {
    margin-bottom: 2rem; /* Double the paragraph margin */
  }

  .error-explanation-metadatum:not(:last-child):after {
    content: '|';
    margin: 0 10px;
  }
  .error-explanation-removed-warning {
    border: 1px solid var(--verso-warning-color);
    border-radius: 0.5rem;
    padding-left: var(--verso--box-padding);
    padding-right: var(--verso--box-padding);
  }
  </style><style>
table.tabular {
  margin: auto;
  border-spacing: 1rem;
}
table.tabular.left-align {
  margin-right: auto;
  margin-left: 0;
}
table.tabular.center-align {
  margin: auto;
}
table.tabular.right-align {
  margin-left auto;
  margin-right: 0;
}
table.tabular td, table.tabular th {
  text-align: left;
  vertical-align: top;
}
table.tabular td > p:first-child, table.tabular th > p:first-child {
  margin-top: 0;
}
table.tabular td > p:last-child, table.tabular th > p:first-child {
  margin-bottom: 0;
}
</style><style>
.lake-opt a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.lake-opt a:hover {
  text-decoration: currentcolor underline solid;
}
</style><style>
div.TODO {
  border: 5px solid red;
  position: relative;
}
div.TODO::before {
  content: "TODO";
  position: absolute;
  top: 0;
  right: 0;
  color: red;
  font-size: large;
  font-weight: bold;
  transform: rotate(-90deg) translate(-2em);
}
</style><style>
.toml {
  font-family: var(--verso-code-font-family);
}

pre.toml {
  margin: 0.5rem .75rem;
  padding: 0.1rem 0;
}

.toml .bool, .toml .table-header {
    font-weight: 600;
}

.toml .table-header .key {
    color: #3030c0;
}

.toml .bool {
    color: #107090;
}

.toml .string {
    color: #0a5020;
}

.toml a, .toml a:link {
    color: inherit;
    text-decoration: none;
    border-bottom: 1px dotted #a2a2a2;
}

.toml a:hover {
    border-bottom-style: solid;
}
</style><style>
    main .theIndex {
      padding-left: 0;
      font-family: var(--verso-text-font-family);
    }

    main .theIndex nav {
      position: sticky;
      top: var(--verso-header-height);
      background: white;
      font-family: var(--verso-structure-font-family);
    }

    main .theIndex [id] {
      /* This needs the combined height of the index header and the page header. We
         know the height of the page header, but the index header height varies, so
         we use the maximum height it gets which also works well for readers with
         wide screens */
      scroll-margin-top: calc(var(--verso-header-height) + 7.5rem);
    }

    @media screen and (max-width: 700px) {
      /* On mobile, the sticky index takes up half the screen. */
      main .theIndex nav {
        position: static;
      }

      main .theIndex [id] {
        /* On mobile, the index header is not sticky, so we just need to
        be below the page header. */
        scroll-margin-top: var(--verso-header-height);
      }
    }

    main .theIndex nav ol {
      padding: 0;
    }

    main .theIndex nav ol li {
      display: inline-block;
    }

    main .theIndex nav ol li a {
      /* Padding instead of margin to have a bigger click target */
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
    /* Increase the size of the touch target on phones */
    @media screen and (max-width: 700px) {
      main .theIndex nav ol li a {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }
    }

    main .theIndex nav ol li:first-child a {
      padding-left: 0;
    }

    main .theIndex nav ol li + li:before {
      content: "|";
    }

    main .theIndex h1,
    main .theIndex h2,
    main .theIndex h3,
    main .theIndex h4,
    main .theIndex h5,
    main .theIndex h6 {
      margin-top: 0;
    }

    main .theIndex ol {
      list-style-type: none;
    }

    main .theIndex .division > ol {
      padding-left: 0;
      display: flex;
      flex-direction: column;
      gap: .5rem;
      overflow-wrap: break-word;
    }

   main .theIndex .division > ol > li {
      margin-bottom: 0.5rem;
    }

    main .theIndex .division ol ol {
      padding-left: 1rem;
    }

    main .theIndex .division {
      break-inside: avoid;
      counter-reset: none;
      max-width: none;
      width: auto;
    }
    </style><style>
.toml-field a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.toml-field a:hover {
  text-decoration: currentcolor underline solid;
}
</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
  font-size: inherit;
}

.hl.lean .keyword {
  color: var(--verso-code-keyword-color,);
  font-weight: var(--verso-code-keyword-weight, bold);
  font-style: var(--verso-code-keyword-style, normal);
  font-family: var(--verso-code-keyword-font-family,);
}

.hl.lean .const {
  color: var(--verso-code-const-color,);
  font-weight: var(--verso-code-const-weight, normal);
  font-style: var(--verso-code-const-style, normal);
  font-family: var(--verso-code-const-font-family,);
}

.hl.lean .var {
  color: var(--verso-code-var-color,);
  font-weight: var(--verso-code-var-weight, normal);
  font-style: var(--verso-code-var-style, italic);
  font-family: var(--verso-code-var-font-family,);

  position: relative;
}

.hl.lean .literal, .hl.lean .unknown {
  color: var(--verso-code-color,);
  font-weight: normal;
  font-style: normal;
  font-family: var(--verso-code-font-family,);
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
  background: none;
  color: black;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

.hl.lean {
}

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean * {
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info .token:not(.tactic-state):not(.tactic-state *), .hl.lean .has-info .inter-text:not(.tactic-state):not(.tactic-state *) {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: from-font;
  text-decoration-skip-ink: none;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error :not(.tactic-state):not(.tactic-state *){
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error .verso-message, .error .verso-message .token, .error .verso-message label {
  color: var(--verso-error-color);
}

.error .verso-message .case-label:has(input[type="checkbox"])::before {
  background-color: var(--verso-error-color) !important;
}

.hl.lean .has-info.warning :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-warning-indicator-color);
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color:var(--verso-warning-color);
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: var(--verso-warning-color);
}

.lean-output {
  border-left: 0.2em solid transparent;
  padding: 0 0 0 0.5em;
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}

.lean-output.error {
  border-color: var(--verso-error-indicator-color);
}

.lean-output.information {
  border-color: var(--verso-info-indicator-color);
}

.lean-output.warning {
  border-color: var(--verso-warning-indicator-color);
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid var(--verso-warning-color);
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.information :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-info-indicator-color, blue);
}

@media (hover: hover) {
  .hl.lean .has-info.information:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.information {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.information {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: var(--verso-text-font-family, sans-serif);
  white-space: normal;
  max-width: calc(min(40rem, 90vw));
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean div.docstring > :first-child {
  margin-top: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: var(--verso-code-font-family);
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
  display: inline;
  vertical-align: top;
  /* Without these, mobile Safari will start making font sizes inconsistent when its text size adjustment feature is triggered.*/
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

.hl.lean .tactic:has(.tactic-toggle:checked) {
  display: inline-grid;
  grid-template-columns: 1fr;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: inline-block;
  vertical-align: top;
  grid-row: 2;
  justify-self: start;
}

.hl.lean .tactic > label {
  position: relative;
  grid-row: 1;
  display: inline;
}

@media (hover: hover) {
  .hl.lean .tactic:has(.tactic-toggle:not(:checked)) > label:hover {
    background-color: #eeeeee;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  /* These need to be em, not rem, to scale with the font */
  border-radius: 1em;
  height: 0.25em;
  vertical-align: middle;
  width: 0.6em;
  margin-left: 0.1em;
  margin-right: 0.1em;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5em;
}

/*
Some CSS frameworks customize details/summary in ways not compatible with Verso's output.
*/

.hl.lean details {
  display: block !important;
  margin: 0;
}

.hl.lean details summary {
  display: list-item !important;
  margin: 0;
}

.hl.lean details summary:focus {
  outline: none;
  outline-offset: none;
  color: inherit;
}

.hl.lean ul > li {
  margin-bottom: 0;
}

.hl.lean details summary::marker {
  display: inline !important;
}

.hl.lean details > summary:first-of-type {
  list-style-type: disclosure-closed;
  list-style-position: inside;
}

.hl.lean details[open] > summary:first-of-type {
  list-style-type: disclosure-open;
}

.hl.lean details summary::before, .hl.lean details summary::after {
  content: "" !important;
  background: none;
  display: none;
}

.hl.lean .tactic-state summary {
  /* These need to be em, not rem, to scale with the font */
  margin-left: -0.5em;
}

.hl.lean .tactic-state details {
  /* These need to be em, not rem, to scale with the font */
  padding-left: 0.5em;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7em;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6em;
  height: 0.6em;
  vertical-align: middle;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  /* These need to be em, not rem, to scale with the font */
  margin-left: 0.5em;
  margin-top: 0.1em;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .goal-name {
  font-style: italic;
  font-family: var(--verso-code-font-family);
  color: inherit;
}

.hl.lean .hypotheses {
  display: table;
}

.hl.lean .hypothesis {
  display: table-row;
}

.hl.lean .hypothesis > * {
  display: table-cell;
}


.hl.lean .hypotheses .colon {
  text-align: center;
  /* This needs to be em, not rem, to scale with the font */
  min-width: 1em;
}

.hl.lean .hypotheses .name {
  text-align: right;
}

.hl.lean .hypotheses .name,
.hl.lean .hypotheses .type,
.hl.lean .conclusion .type {
  font-family: var(--verso-code-font-family);
}

.tippy-box {
  /* Without these, mobile Safari will start making font sizes inconsistent when its text size adjustment feature is triggered.*/
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;

}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid var(--verso-warning-color);
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}

.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

.extra-doc-links {
  list-style-type: none;
  margin-left: 0;
  padding: 0;
}

.extra-doc-links > li {
  display: inline-block;
}

.extra-doc-links > li:not(:last-child)::after {
  content: '|';
  display: inline-block;
  margin: 0 0.25em;
}

.verso-message .trace {
  display: block;
}

.verso-message .trace > summary::marker {
  color: var(--verso-text-color);
}

.verso-message .trace-children {
  margin: 0;
  padding: 0;
}

.verso-message .trace-children > li {
  list-style-type: none;
  margin-left: 1.5em;
}

.verso-message .trace-children > li:not(:has(.trace)) {
  margin-left: 0;
}

.verso-message .trace-class {
  color: color-mix(in srgb, currentColor 70%, transparent);
  font-weight: bold;
  margin: 0;
  padding: 0;
}

.verso-message .text {
  white-space: pre-wrap;
}

</style><style>.error-explanation-short-name { hyphenate-character: ''; }</style><style>
.env-var a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.env-var a:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>.plain-keyword {
  font-weight: 500;
}
</style><style>
a.technical-term {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.technical-term:hover {
  text-decoration: currentcolor underline solid;
}
/* Highlight the clicked term */
.def-technical-term:target {
  background-color: var(--verso-selected-color);
  outline: auto;
}
</style><style>
.error-example-container:not(:last-child) {
  border-bottom: 1px solid gray;
  padding-bottom: var(--verso--box-padding);
}
.error-example-tab-list [role="tab"] {
  position: relative;
  z-index: 1;
  background: white;
  border: 0;
  padding: 0.2em;
  cursor: pointer;
}
.error-example-tab-list [role="tab"]:not(:last-child) {
  margin-right: 1rem;
}
.error-example-tab-list [role="tab"][aria-selected="true"] {
  border-bottom: 1px solid gray;
}
/* this rule and the following ensure that all tabs are the same height */
.error-example-tab-view {
  display: flex;
}
.error-example-tabpanel {
  margin-right: -100%;
  width: 100%;
  display: block;
}
.error-example-tabpanel.error-example-tabpanel-hidden {
  visibility: hidden;
}
.error-example-tabpanel .hl.lean .token {
  /* unset transition to avoid lag when switching panels */
  transition: visibility 0s;
}
  </style><style>
.syntax-error {
  white-space: normal;
}
.syntax-error::before {
  counter-reset: linenumber;
}
.syntax-error > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.syntax-error > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}

:is(.syntax-error > .line):has(.parse-message)::before {
  color: red;
  font-weight: bold;
}

.syntax-error .parse-message > code.hover-info {
  display:none;
}

.syntax-error .parse-message {
  white-space: pre;
  text-decoration-skip-ink: none;
  color: red;
  font-weight: 600;
}
</style><script>
      
window.addEventListener("load", () => {
  const innerProps = {
    onShow(inst) { console.log(inst); },
    onHide(inst) { console.log(inst); },
    content(tgt) {
      const content = document.createElement("span");
      const state = tgt.querySelector(".hover-info").cloneNode(true);
      state.style.display = "block";
      content.appendChild(state);
      /* Render docstrings - TODO server-side */
      if ('undefined' !== typeof marked) {
          for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
              const str = d.innerText;
              const html = marked.parse(str);
              const rendered = document.createElement("div");
              rendered.classList.add("docstring");
              rendered.innerHTML = html;
              d.parentNode.replaceChild(rendered, d);
          }
      }
      content.style.display = "block";
      content.className = "hl lean popup";
      return content;
    }
  };
  const outerProps = {
    allowHtml: true,
    theme: "lean",
    placement: 'bottom-start',
    maxWidth: "none",
    delay: 100,
    moveTransition: 'transform 0.2s ease-out',
    onTrigger(inst, event) {
      const ref = event.currentTarget;
      const block = ref.closest('.hl.lean');
      block.querySelectorAll('.active').forEach((i) => i.classList.remove('active'));
      ref.classList.add("active");
    },
    onUntrigger(inst, event) {
      const ref = event.currentTarget;
      const block = ref.closest('.hl.lean');
      block.querySelectorAll('.active').forEach((i) => i.classList.remove('active'));
    }
  };
  tippy.createSingleton(tippy('pre.grammar.hl.lean .nonterminal.documented, pre.grammar.hl.lean .from-nonterminal.documented, pre.grammar.hl.lean .local-name.documented', innerProps), outerProps);
});
</script>
    <script>
      
window.addEventListener("load", () => {
  tippy('.keyword-of.hl.lean', {
    allowHtml: true,
    /* DEBUG -- remove the space: * /
    onHide(any) { return false; },
    trigger: "click",
    // */
    maxWidth: "none",

    theme: "lean",
    placement: 'bottom-start',
    content (tgt) {
      const content = document.createElement("span");
      const state = tgt.querySelector(".hover-info").cloneNode(true);
      state.style.display = "block";
      content.appendChild(state);
      /* Render docstrings - TODO server-side */
      if ('undefined' !== typeof marked) {
          for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
              const str = d.innerText;
              const html = marked.parse(str);
              const rendered = document.createElement("div");
              rendered.classList.add("docstring");
              rendered.innerHTML = html;
              d.parentNode.replaceChild(rendered, d);
          }
      }
      content.style.display = "block";
      content.className = "hl lean popup";
      return content;
    }
  });
});
</script>
    <script>
      
window.addEventListener('DOMContentLoaded', () => {
  const tabLists = document.querySelectorAll('.error-example-tab-list')
  tabLists.forEach(tabList => {
    const tabs = tabList.querySelectorAll(':scope > [role="tab"]')

    const setActiveTab = (e) => {
      for (const tab of tabs) {
        const controllee = document.getElementById(tab.getAttribute('aria-controls'))
        if (tab === e.target) {
          tab.setAttribute('aria-selected', true)
          controllee.classList.remove('error-example-tabpanel-hidden')
        } else {
          tab.setAttribute('aria-selected', false)
          controllee.classList.add('error-example-tabpanel-hidden')
        }
      }
    }

    tabs.forEach(tab => {
      tab.addEventListener('click', setActiveTab)
    })

    let focusedIdx = 0
    tabList.addEventListener('keydown', e => {
      if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
        tabs[focusedIdx].setAttribute('tabindex', -1)
        focusedIdx =
          e.key === 'ArrowRight'
          ? (focusedIdx + 1) % tabs.length
          : (focusedIdx - 1 + tabs.length) % tabs.length
        tabs[focusedIdx].setAttribute('tabindex', 0)
        tabs[focusedIdx].focus()
      }
    })
  })
})
  </script>
    <script>
      function openDetailsForHashTarget() {
  // Get the current hash from the URL
  const hash = window.location.hash;

  // Exit early if no hash is present
  if (!hash) return;

  // Remove the # to get the actual ID
  const targetId = hash.substring(1);

  // Find the target element
  const targetElement = document.getElementById(targetId);

  // Exit if target element doesn't exist
  if (!targetElement) return;

  // Find the closest details element that contains the target
  const detailsElement = targetElement.closest('details');

  // If the target is inside a details element, open it
  if (detailsElement) {
    detailsElement.open = true;
  }
}

// Run the function when the page loads
document.addEventListener('DOMContentLoaded', openDetailsForHashTarget);

// Also run when the hash changes (for single-page applications)
window.addEventListener('hashchange', openDetailsForHashTarget);

// Run immediately in case the script loads after DOMContentLoaded
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', openDetailsForHashTarget);
} else {
  openDetailsForHashTarget();
}
</script>
    <script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let docsJson = "-verso-docs.json";
    fetch(docsJson).then((resp) => resp.json()).then((versoDocData) => {

      function hideParentTooltips(element) {
        let parent = element.parentElement;
        while (parent) {
          const tippyInstance = parent._tippy;
          if (tippyInstance) {
            tippyInstance.hide();
          }
          parent = parent.parentElement;
        }
      }



      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        /* theme: "lean", */
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        /* ignoreAttributes: true, */
        followCursor: 'initial',
        onShow(inst) {
          if (inst.reference.className == 'tactic') {

            const toggle = inst.reference.querySelector("input.tactic-toggle");
            if (toggle && toggle.checked) {
              return false;
            }
            hideParentTooltips(inst.reference);
            //if (blockedByTippy(inst.reference)) { return false; }

          } else if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          if (tgt.className == 'tactic') {
            const state = tgt.querySelector(".tactic-state").cloneNode(true);
            state.style.display = "block";
            content.appendChild(state);
            content.style.display = "block";
            content.className = "hl lean popup";
          } else {
            content.className = "hl lean";
            content.style.display = "block";
            content.style.maxHeight = "300px";
            content.style.overflowY = "auto";
            content.style.overflowX = "hidden";
            const hoverId = tgt.dataset.versoHover;
            const hoverInfo = tgt.querySelector(".hover-info");
            if (hoverId) { // Docstrings from the table
              // TODO stop doing an implicit conversion from string to number here
              let data = versoDocData[hoverId];
              if (data) {
                const info = document.createElement("span");
                info.className = "hover-info";
                info.style.display = "block";
                info.innerHTML = data;
                content.appendChild(info);
                /* Render docstrings - TODO server-side */
                if ('undefined' !== typeof marked) {
                    for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                        const str = d.innerText;
                        const html = marked.parse(str);
                        const rendered = document.createElement("div");
                        rendered.classList.add("docstring");
                        rendered.innerHTML = html;
                        d.parentNode.replaceChild(rendered, d);
                    }
                }
              } else {
                content.innerHTML = "Failed to load doc ID: " + hoverId;
              }
            } else if (hoverInfo) { // The inline info, still used for compiler messages
              content.appendChild(hoverInfo.cloneNode(true));
            }
            const extraLinks = tgt.parentElement.dataset['versoLinks'];
            if (extraLinks) {
              try {
                const extras = JSON.parse(extraLinks);
                const links = document.createElement('ul');
                links.className = 'extra-doc-links';
                extras.forEach((l) => {
                  const li = document.createElement('li');
                  li.innerHTML = "<a href=\"" + l['href'] + "\" title=\"" + l.long + "\">" + l.short + "</a>";
                  links.appendChild(li);
                });
                content.appendChild(links);
              } catch (error) {
                console.error(error);
              }
            }
          }
          return content;
        }
      };


      document.querySelectorAll('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .level-var, .hl.lean .level-const, .hl.lean .level-op, .hl.lean .sort').forEach(element => {
        element.setAttribute('data-tippy-theme', 'lean');
      });
      document.querySelectorAll('.hl.lean .has-info.warning').forEach(element => {
        element.setAttribute('data-tippy-theme', 'warning message');
      });
      document.querySelectorAll('.hl.lean .has-info.information').forEach(element => {
        element.setAttribute('data-tippy-theme', 'info message');
      });
      document.querySelectorAll('.hl.lean .has-info.error').forEach(element => {
        element.setAttribute('data-tippy-theme', 'error message');
      });
      document.querySelectorAll('.hl.lean .tactic').forEach(element => {
        element.setAttribute('data-tippy-theme', 'tactic');
      });
      let insts = tippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .has-info, .hl.lean .tactic, .hl.lean .level-var, .hl.lean .level-const, .hl.lean .level-op, .hl.lean .sort', defaultTippyProps);
  });
}
</script>
    <script defer="defer" data-domain="lean-lang.org" src="https://plausible.io/js/script.outbound-links.js"></script>
    <script src="static/print.js"></script>
    <link rel="stylesheet" href="static/colors.css">
    <link rel="stylesheet" href="static/theme.css">
    <link rel="stylesheet" href="static/print.css">
    <link rel="stylesheet" href="static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="static/fonts/source-sans/source-sans-3.css">
    <link rel="stylesheet" href="static/fonts/noto-sans-mono/noto-sans-mono.css">
    <script src="-verso-search/search-highlight.js" defer="defer"></script>
    </head>
  <body>
    <header>
      <div class="header-logo-wrapper">
        <a href="" id="logo"><img src="static/lean_logo.svg"></a></div>
      <div class="header-title-wrapper">
        <a href="" class="header-title"><h1>
            The Lean Language Reference</h1>
          </a></div>
      </header>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc"><div class="first">
          <a href="" class="toc-title"><h1>
              The Lean Language Reference</h1>
            </a><div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class="">Table of Contents</span></div>
              <table><tr class="numbered"><td class="num">1.</td><td><a href="Introduction/#introduction">Introduction</a></td></tr><tr class="numbered"><td class="num">2.</td><td><a href="Elaboration-and-Compilation/#The-Lean-Language-Reference--Elaboration-and-Compilation">Elaboration and Compilation</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="Interacting-with-Lean/#interaction">Interacting with Lean</a></td></tr><tr class="numbered"><td class="num">4.</td><td><a href="The-Type-System/#type-system">The Type System</a></td></tr><tr class="numbered"><td class="num">5.</td><td><a href="Source-Files-and-Modules/#files">Source Files and Modules</a></td></tr><tr class="numbered"><td class="num">6.</td><td><a href="Namespaces-and-Sections/#namespaces-sections">Namespaces and Sections</a></td></tr><tr class="numbered"><td class="num">7.</td><td><a href="Definitions/#definitions">Definitions</a></td></tr><tr class="numbered"><td class="num">8.</td><td><a href="Axioms/#axioms">Axioms</a></td></tr><tr class="numbered"><td class="num">9.</td><td><a href="Attributes/#attributes">Attributes</a></td></tr><tr class="numbered"><td class="num">10.</td><td><a href="Terms/#terms">Terms</a></td></tr><tr class="numbered"><td class="num">11.</td><td><a href="Type-Classes/#type-classes">Type Classes</a></td></tr><tr class="numbered"><td class="num">12.</td><td><a href="Coercions/#coercions">Coercions</a></td></tr><tr class="numbered"><td class="num">13.</td><td><a href="Tactic-Proofs/#tactics">Tactic Proofs</a></td></tr><tr class="numbered"><td class="num">14.</td><td><a href="Functors___-Monads-and--do--Notation/#monads-and-do">Functors, Monads and <code>do</code>-Notation</a></td></tr><tr class="numbered"><td class="num">15.</td><td><a href="IO/#io">IO</a></td></tr><tr class="numbered"><td class="num">16.</td><td><a href="The-Simplifier/#the-simplifier">The Simplifier</a></td></tr><tr class="numbered"><td class="num">17.</td><td><a href="The--grind--tactic/#grind-tactic">The <code>grind</code> tactic</a></td></tr><tr class="numbered"><td class="num">18.</td><td><a href="Basic-Propositions/#basic-props">Basic Propositions</a></td></tr><tr class="numbered"><td class="num">19.</td><td><a href="Basic-Types/#basic-types">Basic Types</a></td></tr><tr class="numbered"><td class="num">20.</td><td><a href="Notations-and-Macros/#language-extension">Notations and Macros</a></td></tr><tr class="numbered"><td class="num">21.</td><td><a href="Run-Time-Code/#runtime">Run-Time Code</a></td></tr><tr class="numbered"><td class="num">22.</td><td><a href="Build-Tools-and-Distribution/#build-tools-and-distribution">Build Tools and Distribution</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Error-Explanations/#The-Lean-Language-Reference--Error-Explanations">Error Explanations</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="The-Module-System/#module-system">The Module System</a></td></tr><tr class="current unnumbered"><td class="num"><td><a href="releases/#release-notes">Release Notes</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="platforms/#platforms">Supported Platforms</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="the-index/#The-Lean-Language-Reference--Index">Index</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-release-notes" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-release-notes" checked="checked"></label><span class="unnumbered"></span><span class=""><a href="releases/#release-notes">Release Notes</a></span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="releases/v4.25.0/#release-v4___25___0">Lean 4.25.0-rc2 (2025-10-22)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.24.0/#release-v4___24___0">Lean 4.24.0 (2025-10-14)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.23.0/#release-v4___23___0">Lean 4.23.0 (2025-09-15)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.22.0/#release-v4___22___0">Lean 4.22.0 (2025-08-14)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#release-v4___21___0">Lean 4.21.0 (2025-06-30)</a></td></tr><tr class="current unnumbered"><td class="num"><td><a href="releases/v4.20.0/#release-v4___20___0">Lean 4.20.0 (2025-06-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.19.0/#release-v4___19___0">Lean 4.19.0 (2025-05-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.18.0/#release-v4___18___0">Lean 4.18.0 (2025-04-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.17.0/#release-v4___17___0">Lean 4.17.0 (2025-03-03)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.16.0/#release-v4___16___0">Lean 4.16.0 (2025-02-03)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.15.0/#release-v4___15___0">Lean 4.15.0 (2025-01-04)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.14.0/#release-v4___14___0">Lean 4.14.0 (2024-12-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.13.0/#release-v4___13___0">Lean 4.13.0 (2024-11-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.12.0/#release-v4___12___0">Lean 4.12.0 (2024-10-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.11.0/#release-v4___11___0">Lean 4.11.0 (2024-09-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.10.0/#release-v4___10___0">Lean 4.10.0 (2024-07-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.9.0/#release-v4___9___0">Lean 4.9.0 (2024-07-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.8.0/#release-v4___8___0">Lean 4.8.0 (2024-06-05)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.7.0/#release-v4___7___0">Lean 4.7.0 (2024-04-03)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.6.0/#release-v4___6___0">Lean 4.6.0 (2024-02-29)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.5.0/#release-v4___5___0">Lean 4.5.0 (2024-02-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.4.0/#release-v4___4___0">Lean 4.4.0 (2023-12-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.3.0/#release-v4___3___0">Lean 4.3.0 (2023-11-30)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.2.0/#release-v4___2___0">Lean 4.2.0 (2023-10-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.1.0/#release-v4___1___0">Lean 4.1.0 (2023-09-26)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0/#release-v4___0___0">Lean 4.0.0 (2023-09-08)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m5/#release-v4___0___0-m5">Lean 4.0.0-m5 (2022-08-22)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m4/#release-v4___0___0-m4">Lean 4.0.0-m4 (2022-03-27)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m3/#release-v4___0___0-m3">Lean 4.0.0-m3 (2022-01-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m2/#release-v4___0___0-m2">Lean 4.0.0-m2 (2021-03-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m1/#release-v4___0___0-m1">Lean 4.0.0-m1 (2021-01-04)</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-release-v4___20___0" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-release-v4___20___0" checked="checked"></label><span class="unnumbered"></span><span class="current"><a href="releases/v4.20.0/#release-v4___20___0">Lean 4.20.0 (2025-06-02)</a></span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Highlights">Highlights</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Language">Language</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Library">Library</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Compiler">Compiler</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Pretty-Printing">Pretty Printing</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Documentation">Documentation</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Server">Server</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Lake">Lake</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Other">Other</a></td></tr></table></div>
            </div>
          </div>
        <div class="last">
          <ul id="meta-links">
            <li>
              <a href="https://github.com/leanprover/reference-manual">Source Code</a></li>
            <li>
              <a href="https://github.com/leanprover/reference-manual/issues">Report Issues</a></li>
            </ul>
          </div>
        </nav>
      <main><div class="content-wrapper">
          <nav class="prev-next-buttons">
            <a class="local-button active" href="releases/v4.21.0/#release-v4___21___0" rel="prev" title="Lean 4.21.0 (2025-06-30)"><span class="arrow">â†</span><span class="where">Lean 4.21.0 (2025-06-30)</span></a><a class="local-button active" href="releases/v4.19.0/#release-v4___19___0" rel="next" title="Lean 4.19.0 (2025-05-01)"><span class="where">Lean 4.19.0 (2025-05-01)</span><span class="arrow">â†’</span></a></nav>
          <section>
            <h1>
              Lean 4.20.0 (2025-06-02)<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&amp;name=release-v4.20.0" title="Permalink">ðŸ”—</a></span></h1>
            <p>
              For this release, 346 changes landed. In addition to the 108 feature additions and 85 fixes listed below there were 6 refactoring changes, 7 documentation improvements, 8 performance improvements, 4 improvements to the test suite and 126 other changes.</p>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Highlights">
                Highlights</h2>
              <p>
                The Lean v4.20.0 release brings multiple new features, bug fixes, improvements to Lake, and groundwork for the module system.</p>
              <section>
                <h3 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Highlights--Language-Features">
                  Language Features</h3>
                <ul>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/6432">#6432</a> implements tactics called <code>extract_lets</code> and <code>lift_lets</code> that
manipulate <code>let</code>/<code>let_fun</code> expressions. The <code>extract_lets</code> tactic
creates new local declarations extracted from any <code>let</code> and <code>let_fun</code>
expressions in the main goal. For top-level lets in the target, it is
like the <code>intros</code> tactic, but in general it can extract lets from deeper
subexpressions as well. The <code>lift_lets</code> tactic moves <code>let</code> and <code>let_fun</code>
expressions as far out of an expression as possible, but it does not
extract any new local declarations. The option <code>extract_lets +lift</code>
combines these behaviors.</p>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7806">#7806</a> modifies the syntaxes of the <code>ext</code>, <code>intro</code> and <code>enter</code> conv
tactics to accept <code>_</code>. The introduced binder is an inaccessible name.</p>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7830">#7830</a> modifies the syntax of <code>induction</code>, <code>cases</code>, and other tactics
that use <code>Lean.Parser.Tactic.inductionAlts</code>. If a case omits <code>=&gt; ...</code>
then it is assumed to be <code>=&gt; ?_</code>. Example:</p>
                    <pre>example (p : Nat Ã— Nat) : p.1 = p.1 := by
  cases p with | _ p1 p2
  /-
  case mk
  p1 p2 : Nat
  âŠ¢ (p1, p2).fst = (p1, p2).fst
  -/
</pre><p>
                      This works with multiple cases as well. Example:</p>
                    <pre>example (n : Nat) : n + 1 = 1 + n := by
  induction n with | zero | succ n ih
  /-
  case zero
  âŠ¢ 0 + 1 = 1 + 0

  case succ
  n : Nat
  ih : n + 1 = 1 + n
  âŠ¢ n + 1 + 1 = 1 + (n + 1)
  -/
</pre><p>
                      The <code>induction n with | zero | succ n ih</code> is short for <code>induction n with | zero | succ n ih =&gt; ?_</code>, which is short for <code>induction n with | zero =&gt; ?_ | succ n ih =&gt; ?_</code>. Note that a consequence of parsing is that
only the last alternative can omit <code>=&gt;</code>. Any <code>=&gt;</code>-free alternatives
before an alternative with <code>=&gt;</code> will be a part of that alternative.</p>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7831">#7831</a> adds extensibility to the <code>evalAndSuggest</code> procedure used to
implement <code>try?</code>. Users can now implement their own handlers for any
tactic.</p>
                    <pre>-- Install a `TryTactic` handler for `assumption`
@[try_tactic assumption]
def evalTryApply : TryTactic := fun tac =&gt; do
  -- We just use the default implementation, but return a different tactic.
  evalAssumption tac
  `(tactic| (trace "worked"; assumption))

/-- info: Try this: Â· trace "worked"; assumption -/
#guard_msgs (info) in
example (h : False) : False := by
  try? (max := 1) -- at most one solution

-- `try?` uses `evalAndSuggest` the attribute `[try_tactic]` is used to extend `evalAndSuggest`.
-- Let's define our own `try?` that uses `evalAndSuggest`
elab stx:"my_try?" : tactic =&gt; do
  -- Things to try
  let toTry â† `(tactic| attempt_all | assumption | apply True | rfl)
  evalAndSuggest stx toTry

/--
info: Try these:
â€¢ Â· trace "worked"; assumption
â€¢ rfl
-/
#guard_msgs (info) in
example (a : Nat) (h : a = a) : a = a := by
  my_try?
</pre></li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/8055">#8055</a> adds an implementation of an async IO multiplexing framework as
well as an implementation of it for the <code>Timer</code> API in order to
demonstrate it.</p>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/8088">#8088</a> adds the â€œunfoldingâ€ variant of the functional induction and
functional cases principles, under the name <code>foo.induct_unfolding</code> resp.
<code>foo.fun_cases_unfolding</code>. These theorems combine induction over the
structure of a recursive function with the unfolding of that function,
and should be more reliable, easier to use and more efficient than just
case-splitting and then rewriting with equational theorems.</p>
                    <p>
                      For example instead of</p>
                    <pre>ackermann.induct
  (motive : Nat â†’ Nat â†’ Prop)
  (case1 : âˆ€ (m : Nat), motive 0 m)
  (case2 : âˆ€ (n : Nat), motive n 1 â†’ motive (Nat.succ n) 0)
  (case3 : âˆ€ (n m : Nat), motive (n + 1) m â†’ motive n (ackermann (n + 1) m) â†’ motive (Nat.succ n) (Nat.succ m))
  (x x : Nat) : motive x x
</pre><p>
                      one gets</p>
                    <pre>ackermann.fun_cases_unfolding
  (motive : Nat â†’ Nat â†’ Nat â†’ Prop)
  (case1 : âˆ€ (m : Nat), motive 0 m (m + 1))
  (case2 : âˆ€ (n : Nat), motive n.succ 0 (ackermann n 1))
  (case3 : âˆ€ (n m : Nat), motive n.succ m.succ (ackermann n (ackermann (n + 1) m)))
  (xâœ xâœÂ¹ : Nat) : motive xâœ xâœÂ¹ (ackermann xâœ xâœÂ¹)
</pre></li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/8097">#8097</a> adds support for inductive and coinductive predicates defined
using lattice theoretic structures on <code>Prop</code>. These are syntactically
defined using <code>greatest_fixpoint</code> or <code>least_fixpoint</code> termination
clauses for recursive <code>Prop</code>-valued functions. The functionality relies
on <code>partial_fixpoint</code> machinery and requires function definitions to be
monotone. For non-mutually recursive predicates, an appropriate
(co)induction proof principle (given by Park induction) is generated.</p>
                    </li>
                  </ul>
                </section>
              <section>
                <h3 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Highlights--Library-Highlights">
                  Library Highlights</h3>
                <p>
                  <a href="https://github.com/leanprover/lean4/pull/8004">#8004</a> adds extensional hash maps and hash sets under the names
<code>Std.ExtDHashMap</code>, <code>Std.ExtHashMap</code> and <code>Std.ExtHashSet</code>. Extensional
hash maps work like regular hash maps, except that they have
extensionality lemmas which make them easier to use in proofs. This
however makes it also impossible to regularly iterate over its entries.</p>
                <p>
                  Other notable library developments in this release include:</p>
                <ul>
                  <li>
                    <p>
                      Updates to the <code>Option</code> API,</p>
                    </li>
                  <li>
                    <p>
                      Async runtime developments: added support for multiplexing via UDP and TCP sockets, as well as channels,</p>
                    </li>
                  <li>
                    <p>
                      New <code>BitVec</code> definitions related to overflow handling,</p>
                    </li>
                  <li>
                    <p>
                      New lemmas for <code>Nat.lcm</code>, and <code>Int</code> variants for <code>Nat.gcd</code> and <code>Nat.lcm</code>,</p>
                    </li>
                  <li>
                    <p>
                      Upstreams from Mathlib related to <code>Nat</code> and <code>Int</code>,</p>
                    </li>
                  <li>
                    <p>
                      Additions to numeric types APIs, such as <code>UIntX.ofInt</code>, <code>Fin.ofNat'_mul</code> and <code>Fin.mul_ofNat'</code>, <code>Int.toNat_sub''</code>,</p>
                    </li>
                  <li>
                    <p>
                      Updates to <code>Perm</code> API in <code>Array</code>, <code>List</code>, and added support for <code>Vector</code>,</p>
                    </li>
                  <li>
                    <p>
                      Additional lemmas for <code>Array</code>/<code>List</code>/<code>Vector</code>.</p>
                    </li>
                  </ul>
                </section>
              <section>
                <h3 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Highlights--Lake">
                  Lake</h3>
                <ul>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7909">#7909</a> adds Lake support for building modules given their source file
path. This is made use of in both the CLI and the server.</p>
                    </li>
                  </ul>
                </section>
              <section>
                <h3 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Highlights--Breaking-Changes">
                  Breaking Changes</h3>
                <ul>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7474">#7474</a> updates <code>rw?</code>, <code>show_term</code>, and other tactic-suggesting tactics
to suggest <code>expose_names</code> when necessary and validate tactics prior to
suggesting them, as <code>exact?</code> already did, and it also ensures all such
tactics produce hover info in the messages showing tactic suggestions.</p>
                    <p>
                      This introduces a <strong>breaking change</strong> in the <code>TryThis</code> API: the <code>type?</code> parameter
of <code>addRewriteSuggestion</code> is now an <code>LOption</code>, not an <code>Option</code>, to obviate the need
for a hack we previously used to indicate that a rewrite closed the goal.</p>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7789">#7789</a> fixes <code>lean</code> potentially changing or interpreting arguments
after <code>--run</code>.</p>
                    <p>
                      <strong>Breaking change</strong>: The Lean file to run must now be passed directly
after <code>--run</code>, which accidentally was not enforced before.</p>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7813">#7813</a> fixes an issue where <code>let n : Nat := sorry</code> in the Infoview
pretty prints as <code>n : â„• := sorry `Â«Foo:17:17Â»</code>. This was caused by
top-level expressions being pretty printed with the same rules as
Infoview hovers. Closes <a href="https://github.com/leanprover/lean4/issues/6715">#6715</a>. Refactors <code>Lean.Widget.ppExprTagged</code>; now
it takes a delaborator, and downstream users should configure their own
pretty printer option overrides if necessary if they used the <code>explicit</code>
argument (see <code>Lean.Widget.makePopup.ppExprForPopup</code> for an example).
<strong>Breaking change:</strong> <code>ppExprTagged</code> does not set <code>pp.proofs</code> on the root
expression.</p>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7855">#7855</a> moves <code>ReflBEq</code> to <code>Init.Core</code> and changes <code>LawfulBEq</code> to extend
<code>ReflBEq</code>.</p>
                    <p>
                      <strong>Breaking changes:</strong></p>
                    <ul>
                      <li>
                        <p>
                          The <code>refl</code> field of <code>ReflBEq</code> has been renamed to <code>rfl</code> to match
<code>LawfulBEq</code></p>
                        </li>
                      <li>
                        <p>
                          <code>LawfulBEq</code> extends <code>ReflBEq</code>, so in particular <code>LawfulBEq.rfl</code> is no
longer valid</p>
                        </li>
                      </ul>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7873">#7873</a> fixes a number of bugs related to the handling of the source
search path in the language server, where deleting files could cause
several features to stop functioning and both untitled files and files
that don't exist on disc could have conflicting module names.</p>
                    <p>
                      See the PR description for the details on changes in URI &lt;-&gt; module name conversion.</p>
                    <p>
                      <strong>Breaking changes:</strong></p>
                    <ul>
                      <li>
                        <p>
                          <code>Server.documentUriFromModule</code> has been renamed to
<code>Server.documentUriFromModule?</code> and doesn't take a <code>SearchPath</code> argument
anymore, as the <code>SearchPath</code> is now computed from the <code>LEAN_SRC_PATH</code>
environment variable. It has also been moved from <code>Lean.Server.GoTo</code> to
<code>Lean.Server.Utils</code>.</p>
                        </li>
                      <li>
                        <p>
                          <code>Server.moduleFromDocumentUri</code> does not take a <code>SearchPath</code> argument
anymore and won't return an <code>Option</code> anymore. It has also been moved
from <code>Lean.Server.GoTo</code> to <code>Lean.Server.Utils</code>.</p>
                        </li>
                      <li>
                        <p>
                          The <code>System.SearchPath.searchModuleNameOfUri</code> function has been
removed. It is recommended to use <code>Server.moduleFromDocumentUri</code>
instead.</p>
                        </li>
                      <li>
                        <p>
                          The <code>initSrcSearchPath</code> function has been renamed to
<code>getSrcSearchPath</code> and has been moved from <code>Lean.Util.Paths</code> to
<code>Lean.Util.Path</code>. It also doesn't need to take a <code>pkgSearchPath</code>
argument anymore.</p>
                        </li>
                      </ul>
                    </li>
                  <li>
                    <p>
                      <a href="https://github.com/leanprover/lean4/pull/7967">#7967</a> adds a <code>bootstrap</code> option to Lake which is used to identify the
core Lean package. This enables Lake to use the current stage's include
directory rather than the Lean toolchains when compiling Lean with Lean
in core.</p>
                    <p>
                      <strong>Breaking change:</strong> The Lean library directory is no longer part of
<code>getLeanLinkSharedFlags</code>. FFI users should provide this option
separately when linking to Lean (e.g.. via <code>s!"-L{(â†getLeanLibDir).toString}"</code>).
See the FFI example for a demonstration.</p>
                    </li>
                  </ul>
                </section>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Language">
                Language</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/6325">#6325</a> ensures that environments can be loaded, repeatedly, without
executing arbitrary code</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/6432">#6432</a> implements tactics called <code>extract_lets</code> and <code>lift_lets</code> that
manipulate <code>let</code>/<code>let_fun</code> expressions. The <code>extract_lets</code> tactic
creates new local declarations extracted from any <code>let</code> and <code>let_fun</code>
expressions in the main goal. For top-level lets in the target, it is
like the <code>intros</code> tactic, but in general it can extract lets from deeper
subexpressions as well. The <code>lift_lets</code> tactic moves <code>let</code> and <code>let_fun</code>
expressions as far out of an expression as possible, but it does not
extract any new local declarations. The option <code>extract_lets +lift</code>
combines these behaviors.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7474">#7474</a> updates <code>rw?</code>, <code>show_term</code>, and other tactic-suggesting tactics
to suggest <code>expose_names</code> when necessary and validate tactics prior to
suggesting them, as <code>exact?</code> already did, and it also ensures all such
tactics produce hover info in the messages showing tactic suggestions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7797">#7797</a> adds a monolithic <code>CommRing</code> class, for internal use by <code>grind</code>,
and includes instances for <code>Int</code>/<code>BitVec</code>/<code>IntX</code>/<code>UIntX</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7803">#7803</a> adds normalization rules for function composition to <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7806">#7806</a> modifies the syntaxes of the <code>ext</code>, <code>intro</code> and <code>enter</code> conv
tactics to accept <code>_</code>. The introduced binder is an inaccessible name.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7808">#7808</a> adds missing forall normalization rules to <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7816">#7816</a> fixes an issue where <code>x.f.g</code> wouldn't work but <code>(x.f).g</code> would
when <code>x.f</code> is generalized field notation. The problem was that <code>x.f.g</code>
would assume <code>x : T</code> should be the first explicit argument to <code>T.f</code>. Now
it uses consistent argument insertion rules. Closes #6400.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7825">#7825</a> improves support for <code>Nat</code> in the <code>cutsat</code> procedure used in
<code>grind</code>:</p>
                  <ul>
                    <li>
                      <p>
                        <code>cutsat</code> no longer <em>pollutes</em> the local context with facts of the form
<code>-1 * NatCast.natCast x &lt;= 0</code> for each <code>x : Nat</code>. These facts are now
stored internally in the <code>cutsat</code> state.</p>
                      </li>
                    <li>
                      <p>
                        A single context is now used for all <code>Nat</code> terms.</p>
                      </li>
                    </ul>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7829">#7829</a> fixes an issue in the cutsat counterexamples. It removes the
optimization (<code>Cutsat.State.terms</code>) that was used to avoid the new
theorem <code>eq_def</code>. In the two new tests, prior to this PR, <code>cutsat</code>
produced a bogus counterexample with <code>b := 2</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7830">#7830</a> modifies the syntax of <code>induction</code>, <code>cases</code>, and other tactics
that use <code>Lean.Parser.Tactic.inductionAlts</code>. If a case omits <code>=&gt; ...</code>
then it is assumed to be <code>=&gt; ?_</code>. Example:</p>
                  <pre>example (p : Nat Ã— Nat) : p.1 = p.1 := by
  cases p with | _ p1 p2
  /-
  case mk
  p1 p2 : Nat
  âŠ¢ (p1, p2).fst = (p1, p2).fst
  -/
</pre><p>
                    This works with multiple cases as well. Example:</p>
                  <pre>example (n : Nat) : n + 1 = 1 + n := by
  induction n with | zero | succ n ih
  /-
  case zero
  âŠ¢ 0 + 1 = 1 + 0

  case succ
  n : Nat
  ih : n + 1 = 1 + n
  âŠ¢ n + 1 + 1 = 1 + (n + 1)
  -/
</pre><p>
                    The <code>induction n with | zero | succ n ih</code> is short for <code>induction n with | zero | succ n ih =&gt; ?_</code>, which is short for <code>induction n with | zero =&gt; ?_ | succ n ih =&gt; ?_</code>. Note that a consequence of parsing is that
only the last alternative can omit <code>=&gt;</code>. Any <code>=&gt;</code>-free alternatives
before an alternative with <code>=&gt;</code> will be a part of that alternative.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7831">#7831</a> adds extensibility to the <code>evalAndSuggest</code> procedure used to
implement <code>try?</code>. Users can now implement their own handlers for any
tactic. The new test demonstrates how this feature works.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7859">#7859</a> allows the LRAT parser to accept any proof that derives the
empty clause at somepoint, not necessarily in the last line. Some tools
like lrat-trim occasionally include deletions after the derivation of
the empty clause but the proof is sound as long as it soundly derives
the empty clause somewhere.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7861">#7861</a> fixes an issue that prevented theorems from being activated in
<code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7862">#7862</a> improves the normalization of <code>Bool</code> terms in <code>grind</code>. Recall
that <code>grind</code> currently does not case split on Boolean terms to reduce
the size of the search space.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7864">#7864</a> adds support to <code>grind</code> for case splitting on implications of
the form <code>p -&gt; q</code> and <code>(h : p) -&gt; q h</code>. See the new option <code>(splitImp := true)</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7865">#7865</a> adds a missing propagation rule for implication in <code>grind</code>. It
also avoids unnecessary case-splits on implications.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7870">#7870</a> adds a mixin typeclass for <code>Lean.Grind.CommRing</code> recording the
characteristic of the ring, and constructs instances for <code>Int</code>, <code>IntX</code>,
<code>UIntX</code>, and <code>BitVec</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7885">#7885</a> fixes the counterexamples produced by the cutsat procedure in
<code>grind</code> for examples containing <code>Nat</code> terms.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7892">#7892</a> improves the support for <code>funext</code> in <code>grind</code>. We will push
another PR to minimize the number of case-splits later.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7902">#7902</a> introduces a dedicated option for checking whether elaborators
are running in the language server.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7905">#7905</a> fixes an issue introduced bug #6125 where an <code>inductive</code> or
<code>structure</code> with an autoimplicit parameter with a type that has a
metavariable would lead to a panic. Closes #7788.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7907">#7907</a> fixes two bugs in <code>grind</code>.</p>
                  <ol start="1">
                    <li>
                      <p>
                        Model-based theory combination was creating type incorrect terms.</p>
                      </li>
                    <li>
                      <p>
                        <code>Nat.cast</code> vs <code>NatCast.natCast</code> issue during normalization.</p>
                      </li>
                    </ol>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7914">#7914</a> adds a function hook <code>PersistentEnvExtension.saveEntriesFn</code> that
can be used to store server-only metadata such as position information
and docstrings that should not affect (re)builds.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7920">#7920</a> introduces a fast path based on comparing the (cached) hash
value to the <code>DecidableEq</code> instance of the core expression data type in
<code>bv_decide</code>'s bitblaster.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7926">#7926</a> fixes two issues that were preventing <code>grind</code> to solve
<code>getElem?_eq_some_iff</code>.</p>
                  <ol start="1">
                    <li>
                      <p>
                        Missing propagation rule for <code>Exists p = False</code></p>
                      </li>
                    <li>
                      <p>
                        Missing conditions at <code>isCongrToPrevSplit</code> a filter for discarding
unnecessary case-splits.</p>
                      </li>
                    </ol>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7937">#7937</a> implements a lookahead feature to reduce the size of the search
space in <code>grind</code>. It is currently effective only for arithmetic atoms.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7949">#7949</a> adds the attribute <code>[grind ext]</code>. It is used to select which
<code>[ext]</code> theorems should be used by <code>grind</code>. The option <code>grind +extAll</code>
instructs <code>grind</code> to use all <code>[ext]</code> theorems available in the
environment.
After update stage0, we need to add the builtin <code>[grind ext]</code>
annotations to key theorems such as <code>funext</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7950">#7950</a> modifies <code>all_goals</code> so that in recovery mode it commits changes
to the state only for those goals for which the tactic succeeds (while
preserving the new message log state). Before, we were trusting that
failing tactics left things in a reasonable state, but now we roll back
and admit the goal. The changes also fixes a bug where we were rolling
back only the metacontext state and not the tactic state, leading to an
inconsistent state (a goal list with metavariables not in the
metacontext). Closes #7883</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7952">#7952</a> makes two improvements to the local context when there are
autobound implicits in <code>variable</code>s. First, the local context no longer
has two copies of every variable (the local context is rebuilt if the
types of autobound implicits have metavariables). Second, these
metavariables get names using the same algorithm used by binders that
appear in declarations (with <code>mkForallFVars'</code> instead of
<code>mkForallFVars</code>).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7957">#7957</a> ensures that <code>mkAppM</code> can be used to construct terms that are
only type-correct at at default transparency, even if we are in
<code>withReducible</code> (e.g. in simp), so that simp does not stumble over
simplifying <code>let</code> expression with simplifiable type.reliable.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7961">#7961</a> fixes a bug in bv_decide where if it was presented with a match
on an enum with as many arms as constructors but the last arm being a
default match it would (wrongly) give up on the match.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7975">#7975</a> reduces the priority of the parent projections of
<code>Lean.Grind.CommRing</code>, to avoid these being used in typeclass inference
in Mathlib.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7976">#7976</a> ensure that <code>bv_decide</code> can handle the simp normal form of a
shift.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7978">#7978</a> adds a repro for a non-determinism problem in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7980">#7980</a> adds a simple type for representing monomials in a <code>CommRing</code>.
This is going to be used in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7986">#7986</a> implements reverse lexicographical and graded reverse
lexicographical orders for <code>CommRing</code> monomials.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7989">#7989</a> adds functions and theorems for <code>CommRing</code> multivariate
polynomials.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7992">#7992</a> add a function for converting <code>CommRing</code> expressions into
multivariate polynomials.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7997">#7997</a> removes all type annotations (optional paramters, auto
parameters, out params, semi-out params, not just optional parameters as
before) from the type of functional induction principles.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8011">#8011</a> adds <code>IsCharP</code> support to the multivariateâ€‘polynomial library in
<code>CommRing</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8012">#8012</a> adds the option <code>debug.terminalTacticsAsSorry</code>. When enabled,
terminal tactics such as <code>grind</code> and <code>omega</code> are replaced with <code>sorry</code>.
Useful for debugging and fixing bootstrapping issues.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8014">#8014</a> makes <code>RArray</code> universe polymorphic.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8016">#8016</a> fixes several issues in the <code>CommRing</code> multivariate polynomial
library:</p>
                  <ol start="1">
                    <li>
                      <p>
                        Replaces the previous array type with the universe polymorphic
<code>RArray</code>.</p>
                      </li>
                    <li>
                      <p>
                        Properly eliminates cancelled monomials.</p>
                      </li>
                    <li>
                      <p>
                        Sorts monomials in decreasing order.</p>
                      </li>
                    <li>
                      <p>
                        Marks the parameter <code>p</code> of the <code>IsCharP</code> class as an output
parameter.</p>
                      </li>
                    <li>
                      <p>
                        Adds <code>LawfulBEq</code> instances for the types <code>Power</code>, <code>Mon</code>, and <code>Poly</code>.</p>
                      </li>
                    </ol>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8025">#8025</a> simplifies the <code>CommRing</code> monomials, and adds</p>
                  <ol start="1">
                    <li>
                      <p>
                        Monomial <code>lcm</code></p>
                      </li>
                    <li>
                      <p>
                        Monomial division</p>
                      </li>
                    <li>
                      <p>
                        S-polynomials</p>
                      </li>
                    </ol>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8029">#8029</a> implements basic support for <code>CommRing</code> in <code>grind</code>. Terms are
already being reified and normalized. We still need to process the
equations, but <code>grind</code> can already prove simple examples such as:</p>
                  <pre>open Lean.Grind in
example [CommRing Î±] (x : Î±) : (x + 1)*(x - 1) = x^2 - 1 := by
  grind +ring

</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8032">#8032</a> adds support to <code>grind</code> for detecting unsatisfiable commutative
ring equations when the ring characteristic is known. Examples:</p>
                  <pre>example (x : Int) : (x + 1)*(x - 1) = x^2 â†’ False := by
  grind +ring

</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8033">#8033</a> adds functions for converting <code>CommRing</code> reified terms back into
Lean expressions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8036">#8036</a> fixes a linearity issue in <code>bv_decide</code>'s bitblaster, caused by
the fact that the higher order combinators <code>AIG.RefVec.zip</code> and
<code>AIG.RefVec.fold</code> were not being properly specialised.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8042">#8042</a> makes <code>IntCast</code> a field of <code>Lean.Grind.CommRing</code>, along with
additional axioms relating it to negation of <code>OfNat</code>. This allows use to
use existing instances which are not definitionally equal to the
previously given construction.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8043">#8043</a> adds <code>NullCert</code> type for representing Nullstellensatz
certificates that will be produced by the new commutative ring procedure
in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8050">#8050</a> fixes missing trace messages when produced inside <code>realizeConst</code></p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8055">#8055</a> adds an implementation of an async IO multiplexing framework as
well as an implementation of it for the <code>Timer</code> API in order to
demonstrate it.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8064">#8064</a> adds a failing <code>grind</code> test, showing a bug where grind is trying
to assign a metavariable incorrectly.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8065">#8065</a> adds a (failing) test case for an obstacle I've been running
into setting up <code>grind</code> for <code>HashMap</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8068">#8068</a> ensures that for modules opted into the experimental module
system, we do not import module docstrings or declaration ranges.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8076">#8076</a> fixes <code>simp?!</code>, <code>simp_all?!</code> and <code>dsimp?!</code> to do auto-unfolding.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8077">#8077</a> adds simprocs to simplify appends of non-overlapping Bitvector
adds. We add a simproc instead of just a <code>simp</code> lemma to ensure that we
correctly rewrite bitvector appends. Since bitvector appends lead to
computation at the bitvector width level, it seems to be more stable to
write a simproc.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8083">#8083</a> fixes #8081.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8086">#8086</a> makes sure that the functional induction priciples for mutually
recursive structural functions with extra parameters are split deeply,
as expected.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8088">#8088</a> adds the â€œunfoldingâ€ variant of the functional induction and
functional cases principles, under the name <code>foo.induct_unfolding</code> resp.
<code>foo.fun_cases_unfolding</code>. These theorems combine induction over the
structure of a recursive function with the unfolding of that function,
and should be more reliable, easier to use and more efficient than just
case-splitting and then rewriting with equational theorems.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8090">#8090</a> adjusts the experimental module system to elide theorem bodies
(i.e. proofs) from being imported into other modules.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8094">#8094</a> fixes the generation of functional induction principles for
functions with nested nested well-founded recursion and late fixed
parameters. This is a follow-up for #7166. Fixes #8093.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8096">#8096</a> lets <code>induction</code> accept eliminator where the motive application
in the conclusion has complex arguments; these are abstracted over using
<code>kabstract</code> if possible. This feature will go well with unfolding
induction principles (#8088).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8097">#8097</a> adds support for inductive and coinductive predicates defined
using lattice theoretic structures on <code>Prop</code>. These are syntactically
defined using <code>greatest_fixpoint</code> or <code>least_fixpoint</code> termination
clauses for recursive <code>Prop</code>-valued functions. The functionality relies
on <code>partial_fixpoint</code> machinery and requires function definitions to be
monotone. For non-mutually recursive predicates, an appropriate
(co)induction proof principle (given by Park induction) is generated.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8101">#8101</a> fixes a parallelism regression where linters that e.g. check for
errors in the command would no longer find such messages.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8102">#8102</a> allows ASCII <code>&lt;-</code> in <code>if let</code> clauses, for consistency with
bind, where both are allowed. Fixes #8098.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8111">#8111</a> adds the helper type class <code>NoZeroNatDivisors</code> for the
commutative ring procedure in <code>grind</code>. Core only implements it for
<code>Int</code>. It can be instantiated in Mathlib for any type <code>A</code> that
implements <code>NoZeroSMulDivisors Nat A</code>.
See <code>findSimp?</code> and <code>PolyDerivation</code> for details on how this instance
impacts the commutative ring procedure.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8122">#8122</a> implements the generation of compact proof terms for
Nullstellensatz certificates in the new commutative ring procedure in
<code>grind</code>. Some examples:</p>
                  <pre>example [CommRing Î±] (x y : Î±) : x = 1 â†’ y = 2 â†’ 2*x + y = 4 := by
  grind +ring

</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8126">#8126</a> implements the main loop of the new commutative ring procedure
in <code>grind</code>. In the main loop, for each polynomial <code>p</code> in the todo queue,
the procedure:</p>
                  <ul>
                    <li>
                      <p>
                        Simplifies it using the current basis.</p>
                      </li>
                    <li>
                      <p>
                        Computes critical pairs with polynomials already in the basis and adds
them to the queue.</p>
                      </li>
                    </ul>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8128">#8128</a> implements equality propagation in the new commutative ring
procedure in <code>grind</code>. The idea is to propagate implied equalities back
to the <code>grind</code> core module that does congruence closure. In the
following example, the equalities: <code>x^2*y = 1</code> and <code>x*y^2 - y = 0</code> imply
that <code>y*x</code> is equal to <code>y*x*y</code>, which implies by congruence that <code>f (y*x) = f (y*x*y)</code>.</p>
                  <pre>example [CommRing Î±] (x y : Î±) (f : Î± â†’ Nat) : x^2*y = 1 â†’ x*y^2 - y = 0 â†’ f (y*x) = f (y*x*y) := by
  grind +ring
</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8129">#8129</a> updates the If-Normalization example, to separately give an
implementation and subsequently prove the spec (using fun_induction),
instead of previously building a term in the subtype directly. At the
same time, adds a (failing) <code>grind</code> test case illustrating a problem
with unused match witnesses.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8131">#8131</a> adds a configuration option that controls the maximum number of
steps the commutative-ring procedure in <code>grind</code> performs.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8133">#8133</a> fixes the monomial order used by the commutative ring procedure
in <code>grind</code>. The following new test now terminates quickly.</p>
                  <pre>example [CommRing Î±] (a b c : Î±)
  : a + b + c = 3 â†’
    a^2 + b^2 + c^2 = 5 â†’
    a^3 + b^3 + c^3 = 7 â†’
    a^4 + b^4 + c^4 = 9 := by
  grind +ring
</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8134">#8134</a> ensures that <code>set_option grind.debug true</code> works properly when
using <code>grind +ring</code>. It also adds the helper functions <code>mkPropEq</code> and
<code>mkExpectedPropHint</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8137">#8137</a> improves equality propagation (also known as theory combination)
and polynomial simplification for rings that do not implement the
<code>NoZeroNatDivisors</code> class. With these fixes, <code>grind</code> can now solve:</p>
                  <pre>example [CommRing Î±] (a b c : Î±) (f : Î± â†’ Nat)
  : a + b + c = 3 â†’
    a^2 + b^2 + c^2 = 5 â†’
    a^3 + b^3 + c^3 = 7 â†’
    f (a^4 + b^4) + f (9 - c^4) â‰  1 := by
  grind +ring
</pre><p>
                    This example uses the commutative ring procedure, the linear integer
arithmetic solver, and congruence closure.
For rings that implement <code>NoZeroNatDivisors</code>, a polynomial is now also
divided by the greatest common divisor (gcd) of its coefficients when it
is inserted into the basis.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8157">#8157</a> fixes an incompatibility of <code>replayConst</code> as used by e.g.
<code>aesop</code> with <code>native_decide</code>-using tactics such as <code>bv_decide</code></p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8158">#8158</a> fixes the <code>grind +splitImp</code> and the arrow propagator. Given <code>p : Prop</code>, the propagator was incorrectly assuming <code>A</code> was always a
proposition in an arrow <code>A -&gt; p</code>. also adds a missing
normalization rule to <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8159">#8159</a> adds support for the following import variants to the
experimental module system:</p>
                  <ul>
                    <li>
                      <p>
                        <code>private import</code>: Makes the imported constants available only in
non-exported contexts such as proofs. In particular, the import will not
be loaded, or required to exist at all, when the current module is
imported into other modules.</p>
                      </li>
                    <li>
                      <p>
                        <code>import all</code>: Makes non-exported information such as proofs of the
imported module available in non-exported contexts in the current
module. Main purpose is to allow for reasoning about imported
definitions when they would otherwise be opaque. TODO: adjust name
resolution so that imported <code>private</code> decls are accessible through
syntax.</p>
                      </li>
                    </ul>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8161">#8161</a> changes <code>Lean.Grind.CommRing</code> to inline the <code>NatCast</code> instance
(i.e. to be provided by the user) rather than constructing one from the
existing data. Without this change we can't construct instances in
Mathlib that <code>grind</code> can use.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8163">#8163</a> adds some currently failing tests for <code>grind +ring</code>, resulting
in either kernel type mismatches (bugs) or a kernel deep recursion
(perhaps just a too-large problem).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8167">#8167</a> improves the heuristics used to compute the basis and simplify
polynomials in the commutative procedure used in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8168">#8168</a> fixes a bug when constructing the proof term for a
Nullstellensatz certificate produced by the new commutative ring
procedure in <code>grind</code>. The kernel was rejecting the proof term.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8170">#8170</a> adds the infrastructure for creating stepwise proof terms in the
commutative procedure used in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8189">#8189</a> implements <strong>stepwise proof terms</strong> in the commutative ring
procedure used by <code>grind</code>. These terms serve as an alternative
representation to the traditional Nullstellensatz certificates, aiming
to address the <strong>exponential worst-case complexity</strong> often associated
with certificate construction.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8231">#8231</a> changes the behaviour of <code>apply?</code> so that the <code>sorry</code> it uses to
close the goal is non-synthetic. (Recall that correct use of synthetic
sorries requires that the tactic also generates an error message, which
we don't want to do in this situation.) Either this PR or #8230 are
sufficient to defend against the problem reported in #8212.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8254">#8254</a> fixes unintended inlining of <code>ToJson</code>, <code>FromJson</code>, and <code>Repr</code>
instances, which was causing exponential compilation times in <code>deriving</code>
clauses for large structures.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Library">
                Library</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/6081">#6081</a> adds an <code>inheritEnv</code> field to <code>IO.Process.SpawnArgs</code>. If
<code>false</code>, the spawned process does not inherit its parent's environment.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7108">#7108</a> proves <code>List.head_of_mem_head?</code> and the analogous
<code>List.getLast_of_mem_getLast?</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7400">#7400</a> adds lemmas for the <code>filter</code>, <code>map</code> and <code>filterMap</code> functions of
the hash map.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7659">#7659</a> adds SMT-LIB operators to detect overflow
<code>BitVec.(umul_overflow, smul_overflow)</code>, according to the definitions
<a href="https://github.com/SMT-LIB/SMT-LIB-2/blob/2.7/Theories/FixedSizeBitVectors.smt2">here</a>,
and the theorems proving equivalence of such definitions with the
<code>BitVec</code> library functions (<code>umulOverflow_eq</code>, <code>smulOverflow_eq</code>).
Support theorems for these proofs are <code>BitVec.toInt_one_of_lt, BitVec.toInt_mul_toInt_lt, BitVec.le_toInt_mul_toInt, BitVec.toNat_mul_toNat_lt, BitVec.two_pow_le_toInt_mul_toInt_iff, BitVec.toInt_mul_toInt_lt_neg_two_pow_iff</code> and <code>Int.neg_mul_le_mul, Int.bmod_eq_self_of_le_mul_two, Int.mul_le_mul_of_natAbs_le, Int.mul_le_mul_of_le_of_le_of_nonneg_of_nonpos, Int.pow_lt_pow</code>. The PR
also includes a set of tests.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7671">#7671</a> contains the theorem proving that signed division x.toInt /
y.toInt only overflows when <code>x = intMin w</code> and <code>y = allOnes w</code> (for <code>0 &lt; w</code>).
To show that this is the <em>only</em> case in which overflow happens, we refer
to overflow for negation
(<code>BitVec.sdivOverflow_eq_negOverflow_of_neg_one</code>): in fact,
<code>x.toInt/(allOnes w).toInt = - x.toInt</code>, i.e., the overflow conditions
are the same as <code>negOverflow</code> for <code>x</code>, and then reason about the signs
of the operands with the respective theorems.
These BitVec theorems themselves rely on numerous <code>Int.ediv_*</code> theorems,
that carefully set the bounds of signed division for integers.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7761">#7761</a> implements the core theorem for the Bitwuzla rewrites
<a href="https://github.com/bitwuzla/bitwuzla/blob/e09c50818b798f990bd84bf61174553fef46d561/src/rewrite/rewrites_bv.cpp#L1495-L1510">NORM_BV_NOT_OR_SHL</a>
and
<a href="https://github.com/bitwuzla/bitwuzla/blob/e09c50818b798f990bd84bf61174553fef46d561/src/rewrite/rewrites_bv.cpp#L395-L401">BV_ADD_SHL</a>,
which convert the mixed-boolean-arithmetic expression into a purely
arithmetic expression:</p>
                  <pre>theorem add_shiftLeft_eq_or_shiftLeft {x y : BitVec w} :
    x + (y &lt;&lt;&lt; x) =  x ||| (y &lt;&lt;&lt; x)
</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7770">#7770</a> adds a shared mutex (or read-write lock) as <code>Std.SharedMutex</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7774">#7774</a> adds <code>Option.pfilter</code>, a variant of <code>Option.filter</code> and several
lemmas for it and other <code>Option</code> functions. These lemmas are split off
from #7400.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7791">#7791</a> adds lemmas about <code>Nat.lcm</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7802">#7802</a> adds <code>Int.gcd</code> and <code>Int.lcm</code> variants of all <code>Nat.gcd</code> and
<code>Nat.lcm</code> lemmas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7818">#7818</a> deprecates <code>Option.merge</code> and <code>Option.liftOrGet</code> in favor of
<code>Option.zipWith</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7819">#7819</a> extends <code>Std.Channel</code> to provide a full sync and async API, as
well as unbounded, zero sized and bounded channels.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7835">#7835</a> adds <code>BitVec.[toInt_append|toFin_append]</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7847">#7847</a> removes <code>@[simp]</code> from all deprecated theorems. <code>simp</code> will
still use such lemmas, without any warning message.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7851">#7851</a> partially reverts #7818, because the function called
<code>Option.zipWith</code> in that PR does not actually correspond to
<code>List.zipWith</code>. We choose <code>Option.merge</code> as the name instead.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7855">#7855</a> moves <code>ReflBEq</code> to <code>Init.Core</code> and changes <code>LawfulBEq</code> to extend
<code>ReflBEq</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7856">#7856</a> changes definitions and theorems not to use the membership
instance on <code>Option</code> unless the theorem is specifically about the
membership instance.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7869">#7869</a> fixes a regression introduced in #7445 where the new
<code>Array.emptyWithCapacity</code> was accidentally not tagged with the correct
function to actually allocate the capacity.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7871">#7871</a> generalizes the typeclass assumptions on monadic <code>Option</code>
functions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7879">#7879</a> adds <code>Int.toNat_emod</code>, analogous to <code>Int.toNat_add/mul</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7880">#7880</a> adds the functions <code>UIntX.ofInt</code>, and basic lemmas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7886">#7886</a> adds <code>UIntX.pow</code> and <code>Pow UIntX Nat</code> instances, and similarly
for signed fixed-width integers. These are currently only the naive
implementation, and will need to be subsequently replaced via
<code>@[extern]</code> with fast implementations (tracked at #7887).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7888">#7888</a> adds <code>Fin.ofNat'_mul</code> and <code>Fin.mul_ofNat'</code>, parallel to the
existing lemmas about <code>add</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7889">#7889</a> adds <code>Int.toNat_sub''</code> a variant of <code>Int.toNat_sub</code> taking
inequality hypotheses, rather than expecting the arguments to be casts
of natural numbers. This is parallel to the existing <code>toNat_add</code> and
<code>toNat_mul</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7890">#7890</a> adds missing lemmas about <code>Int.bmod</code>, parallel to lemmas about
the other <code>mod</code> variants.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7891">#7891</a> adds the rfl simp lemma <code>Int.cast x = x</code> for <code>x : Int</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7893">#7893</a> adds <code>BitVec.pow</code> and <code>Pow (BitVec w) Nat</code>. The implementation
is the naive one, and should later be replaced by an <code>@[extern]</code>. This
is tracked at https://github.com/leanprover/lean4/issues/7887.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7897">#7897</a> cleans up the <code>Option</code> development, upstreaming some results
from mathlib in the process.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7899">#7899</a> shuffles some results about integers around to make sure that
all material that currently exists about <code>Int.bmod</code> is located in
<code>DivMod/Lemmas.lean</code> and not downstream of that.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7901">#7901</a> adds <code>instance [Pure f] : Inhabited (OptionT f Î±)</code>, so that
<code>Inhabited (OptionT Id Empty)</code> synthesizes.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7912">#7912</a> adds <code>List.Perm.take/drop</code>, and <code>Array.Perm.extract</code>,
restricting permutations to sublist / subarrays when they are constant
elsewhere.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7913">#7913</a> adds some missing <code>List/Array/Vector lemmas</code> about
<code>isSome_idxOf?</code>, <code>isSome_finIdxOf?</code>, <code>isSome_findFinIdx?, </code>isSome_findIdx?<code>and the corresponding</code>isNone` versions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7933">#7933</a> adds lemmas about <code>Int.bmod</code> to achieve parity between
<code>Int.bmod</code> and <code>Int.emod</code>/<code>Int.fmod</code>/<code>Int.tmod</code>. Furthermore, it adds
missing lemmas for <code>emod</code>/<code>fmod</code>/<code>tmod</code> and performs cleanup on names
and statements for all four operations, also with a view towards
increasing consistency with the corresponding <code>Nat.mod</code> lemmas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7938">#7938</a> adds lemmas about <code>List/Array/Vector.countP/count</code> interacting
with <code>replace</code>. (Specializing to <code>_self</code> and <code>_ne</code> lemmas doesn't seem
useful, as there will still be an <code>if</code> on the RHS.)</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7939">#7939</a> adds <code>Array.count_erase</code> and specializations.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7953">#7953</a> generalizes some typeclass hypotheses in the <code>List.Perm</code> API
(away from <code>DecidableEq</code>), and reproduces <code>List.Perm.mem_iff</code> for
<code>Array</code>, and fixes a mistake in the statement of <code>Array.Perm.extract</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7971">#7971</a> upstreams much of the material from <code>Mathlib/Data/Nat/Init.lean</code>
and <code>Mathlib/Data/Nat/Basic.lean</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7983">#7983</a> upstreams many of the results from <code>Mathlib/Data/Int/Init.lean</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7994">#7994</a> reproduces the <code>Array.Perm</code> API for <code>Vector</code>. Both are still
significantly less developed than the API for <code>List.Perm</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7999">#7999</a> replaces <code>Array.Perm</code> and <code>Vector.Perm</code> with one-field
structures. This avoids dot notation for <code>List</code> to work like e.g.
<code>h.cons 3</code> where <code>h</code> is an <code>Array.Perm</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8000">#8000</a> deprecates some <code>Int.ofNat_*</code> lemmas in favor of
<code>Int.natCast_*</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8004">#8004</a> adds extensional hash maps and hash sets under the names
<code>Std.ExtDHashMap</code>, <code>Std.ExtHashMap</code> and <code>Std.ExtHashSet</code>. Extensional
hash maps work like regular hash maps, except that they have
extensionality lemmas which make them easier to use in proofs. This
however makes it also impossible to regularly iterate over its entries.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8030">#8030</a> adds some missing lemmas about
<code>List/Array/Vector.findIdx?/findFinIdx?/findSome?/idxOf?</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8044">#8044</a> introduces the modules <code>Std.Data.DTreeMap.Raw</code>,
<code>Std.Data.TreeMap.Raw</code> and <code>Std.Data.TreeSet.Raw</code> and imports them into
<code>Std.Data</code>. All modules related to the raw tree maps are imported into
these new modules so that they are now a transitive dependency of <code>Std</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8067">#8067</a> fixes the behavior of <code>Substring.isNat</code> to disallow empty
strings.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8078">#8078</a> is a follow up to #8055 and implements a <code>Selector</code> for async
TCP in order to allow IO multiplexing using TCP sockets.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8080">#8080</a> fixes <code>Json.parse</code> to handle surrogate pairs correctly.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8085">#8085</a> moves the coercion <code>Î± â†’ Option Î±</code> to the new file
<code>Init.Data.Option.Coe</code>. This file may not be imported anywhere in <code>Init</code>
or <code>Std</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8089">#8089</a> adds optimized division functions for <code>Int</code> and <code>Nat</code> when the
arguments are known to be divisible (such as when normalizing
rationals). These are backed by the gmp functions <code>mpz_divexact</code> and
<code>mpz_divexact_ui</code>. See also leanprover-community/batteries#1202.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8136">#8136</a> adds an initial set of <code>@[grind]</code> annotations for
<code>List</code>/<code>Array</code>/<code>Vector</code>, enough to set up some regression tests using
<code>grind</code> in proofs about <code>List</code>. More annotations to follow.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8139">#8139</a> is a follow up to #8055 and implements a <code>Selector</code> for async
UDP in order to allow IO multiplexing using UDP sockets.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8144">#8144</a> changes the predicate for <code>Option.guard</code> to be <code>p : Î± â†’ Bool</code>
instead of <code>p : Î± â†’ Prop</code>. This brings it in line with other comparable
functions like <code>Option.filter</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8147">#8147</a> adds <code>List.findRev?</code> and <code>List.findSomeRev?</code>, for parity with
the existing Array API, and simp lemmas converting these into existing
operations.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8148">#8148</a> generalises <code>List.eraseDups</code> to allow for an arbitrary
comparison relation. Further, it proves <code>eraseDups_append : (as ++ bs).eraseDups = as.eraseDups ++ (bs.removeAll as).eraseDups</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8150">#8150</a> is a follow up to #8055 and implements a Selector for
<code>Std.Channel</code> in order to allow
multiplexing using channels.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8154">#8154</a> adds unconditional lemmas for
<code>HashMap.getElem?_insertMany_list</code>, alongside the existing ones that
have quite strong preconditions. Also for TreeMap (and
dependent/extensional variants).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8175">#8175</a> adds simp/grind lemmas about <code>List</code>/<code>Array</code>/<code>Vector.contains</code>.
In the presence of <code>LawfulBEq</code> these effectively already held, via
simplifying <code>contains</code> to <code>mem</code>, but now these also fire without
<code>LawfulBEq</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8184">#8184</a> adds the <code>insertMany_append</code> lemma for all map variants.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Compiler">
                Compiler</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/6063">#6063</a> updates the version of LLVM and clang used by and shipped with
Lean to 19.1.2</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7824">#7824</a> fixes an issue where uses of 'noncomputable' definitions can get
incorrectly compiled, while also removing the use of 'noncomputable'
definitions altogether. Some uses of 'noncomputable' definitions (e.g.
Classical.propDecidable) do not get compiled correctly by type erasure.
Running the optimizer on the result can lead to them being optimized
away, eluding the later IR-level check for uses of noncomputable
definitions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7838">#7838</a> adds support for mpz objects (i.e., big nums) to the
<code>shareCommon</code> functions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7854">#7854</a> introduces fundamental API to distribute module data across
multiple files in preparation for the module system.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7945">#7945</a> fixes a potential race between <code>IO.getTaskState</code> and the task in
question finishing, resulting in undefined behavior.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7958">#7958</a> ensures that after <code>main</code> is finished we still wait on dedicated
tasks instead of exiting forcefully. If users wish to violently kill
their dedicated tasks at the end of main instead they can run
<code>IO.Process.exit</code> at the end of <code>main</code> instead.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7990">#7990</a> adopts lcAny in more cases of type erasure in the new code
generator.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7996">#7996</a> disables CSE of local function declarations in the base phase of
the new compiler. This was introducing sharing between lambdas to bind
calls w/ <code>do</code> notation, which caused them to later no longer be inlined.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8006">#8006</a> changes the inlining heuristics of the new code generator to
match the old one, which ensures that monadic folds get sufficiently
inlined for their tail recursion to be exposed to the code generator.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8007">#8007</a> changes eager lambda lifting heuristics in the new compiler to
match the old compiler, which ensures that inlining/specializing monadic
code does not accidentally create mutual tail recursion that the code
generator can't handle.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8008">#8008</a> changes specialization in the new code generator to consider
callee params to be ground variables, which improves the specialization
of polymorphic functions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8009">#8009</a> restricts lifting outside of cases expressions on values of a
Decidable type, since we can't correctly represent the dependency on the
erased proposition in the later stages of the compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8010">#8010</a> fixes caseOn expressions with an implemented_by to work
correctly with hash consing, even when the elaborator produces terms
that reconstruct the discriminant rather than just reusing a variable.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8015">#8015</a> fixes the IR elim_dead_branches pass to correctly handle join
points with no params, which currently get considered unreachable. I was
not able to find an easy repro of this with the old compiler, but it
occurs when bootstrapping Lean with the new compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8017">#8017</a> makes the IR elim_dead_branches pass correctly handle extern
functions by considering them as having a top return value. This fix is
required to bootstrap the Init/ directory with the new compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8023">#8023</a> fixes the IR expand_reset_reuse pass to correctly handle
duplicate projections from the same base/index. This does not occur (at
least easily) with the old compiler, but it occurs when bootstrapping
Lean with the new compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8124">#8124</a> correctly handles escaping functions in the LCNF
elimDeadBranches pass, by setting all params to top instead of
potentially leaving them at their default bottom value.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8125">#8125</a> adds support for the <code>init</code> attribute to the new compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8127">#8127</a> adds support for borrowed params in the new compiler, which
requires adding support for .mdata expressions to LCNF type handling.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8132">#8132</a> adds support for lowering <code>casesOn</code> for builtin types in the new
compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8156">#8156</a> fixes a bug where the old compiler's lcnf conversion expr cache
was not including all of the relevant information in the key, leading to
terms inadvertently being erased. The <code>root</code> variable is used to
determine whether lambda arguments to applications should get let
bindings or not, which in turn affects later decisions about type
erasure (erase_irrelevant assumes that any non-atomic argument is
irrelevant).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8236">#8236</a> fixes an issue where the combination of <code>extern_lib</code> and
<code>precompileModules</code> would lead to "symbol not found" errors.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Pretty-Printing">
                Pretty Printing</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7805">#7805</a> modifies the pretty printing of raw natural number literals; now
both <code>pp.explicit</code> and <code>pp.natLit</code> enable the <code>nat_lit</code> prefix. An
effect of this is that the hover on such a literal in the Infoview has
the <code>nat_lit</code> prefix.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7812">#7812</a> modifies the pretty printing of pi types. Now <code>âˆ€</code> will be
preferred over <code>â†’</code> for propositions if the domain is not a proposition.
For example, <code>âˆ€ (n : Nat), True</code> pretty prints as <code>âˆ€ (n : Nat), True</code>
rather than as <code>Nat â†’ True</code>. There is also now an option <code>pp.foralls</code>
(default true) that when false disables using <code>âˆ€</code> at all, for
pedagogical purposes. also adjusts instance implicit binder
pretty printing â€” nondependent pi types won't show the instance binder
name. Closes #1834.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7813">#7813</a> fixes an issue where <code>let n : Nat := sorry</code> in the Infoview
pretty prints as <code>n : â„• := sorry `Â«Foo:17:17Â»</code>. This was caused by
top-level expressions being pretty printed with the same rules as
Infoview hovers. Closes #6715. Refactors <code>Lean.Widget.ppExprTagged</code>; now
it takes a delaborator, and downstream users should configure their own
pretty printer option overrides if necessary if they used the <code>explicit</code>
argument (see <code>Lean.Widget.makePopup.ppExprForPopup</code> for an example).
Breaking change: <code>ppExprTagged</code> does not set <code>pp.proofs</code> on the root
expression.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7840">#7840</a> causes structure instance notation to be tagged with the
constructor when <code>pp.tagAppFns</code> is true. This will make docgen will have
<code>{</code> and <code>}</code> be links to the structure constructor.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8022">#8022</a> fixes a bug where pretty printing is done in a context with
cleared local instances. These were cleared since the local context is
updated during a name sanitization step, but preserving local instances
is valid since the modification to the local context only affects user
names.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Documentation">
                Documentation</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7947">#7947</a> adds some docstrings to clarify the functions of
<code>Lean.mkFreshId</code>, <code>Lean.Core.mkFreshUserName</code>,
<code>Lean.Elab.Term.mkFreshBinderName</code>, and
<code>Lean.Meta.mkFreshBinderNameForTactic</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8018">#8018</a> adjusts the RArray docstring to the new reality from #8014.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Server">
                Server</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7610">#7610</a> adjusts the <code>TryThis</code> widget to also work in widget messages
rather than only as a panel widget. It also adds additional
documentation explaining why this change was needed.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7873">#7873</a> fixes a number of bugs related to the handling of the source
search path in the language server, where deleting files could cause
several features to stop functioning and both untitled files and files
that don't exist on disc could have conflicting module names.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7882">#7882</a> fixes a regression where elaboration of a previous document
version is not cancelled on changes to the document.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8242">#8242</a> fixes the 'goals accomplished' diagnostics. They were
accidentally broken in #7902.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Lake">
                Lake</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7796">#7796</a> moves Lean's shared library path before the workspace's in
Lake's augmented environment (e.g., <code>lake env</code>).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7809">#7809</a> fixes the order of libraries when loading them via
<code>--load-dynlib</code> or <code>--plugin</code> in <code>lean</code> and when linking them into a
shared library or executable. A <code>Dynlib</code> now tracks its dependencies and
they are topologically sorted before being passed to either linking or
loading.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7822">#7822</a> changes Lake to use normalized absolute paths for its various
files and directories.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7860">#7860</a> restores the use of builtins (e.g., initializer, elaborators,
and macros) for DSL features and the use of the Lake plugin in the
server.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7906">#7906</a> changes Lake build traces to track their mixed inputs. The
tracked inputs are saved as part of the <code>.trace</code> file, which can
significantly assist in debugging trace issues. In addition, this PR
tweaks some existing Lake traces. Most significant, module olean traces
no longer incorporate their module's source trace.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7909">#7909</a> adds Lake support for building modules given their source file
path. This is made use of in both the CLI and the sever.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7963">#7963</a> adds helper functions to convert between <code>Lake.EStateT</code> and
<code>EStateM</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7967">#7967</a> adds a <code>bootstrap</code> option to Lake which is used to identify the
core Lean package. This enables Lake to use the current stage's include
directory rather than the Lean toolchains when compiling Lean with Lean
in core.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7987">#7987</a> fixes a bug in #7967 that broke external library linking.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8026">#8026</a> fixes bugs in #7809 and #7909 that were not caught partially
because the <code>badImport</code> test had been disabled.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8048">#8048</a> moves the Lake DSL syntax into a dedicated module with minimal
imports.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8152">#8152</a> fixes a regression where non-precompiled module builds would
<code>--load-dynlib</code> package <code>extern_lib</code> targets.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8183">#8183</a> makes Lake tests much more verbose in output. It also fixes some
bugs that had been missed due to disabled tests. Most significantly, the
target specifier <code>@pkg</code> (e.g., in <code>lake build</code>) is now always
interpreted as a package. It was previously ambiguously interpreted due
to changes in #7909.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8190">#8190</a> adds documentation for native library options (e.g., <code>dynlibs</code>,
<code>plugins</code>, <code>moreLinkObjs</code>, <code>moreLinkLibs</code>) and <code>needs</code> to the Lake
README. It is also includes information about specifying targets on the
Lake CLI and in Lean and TOML configuration files.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___20___0-_LPAR_2025-06-02_RPAR_--Other">
                Other</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7785">#7785</a> adds further automation to the release process, taking care of
tagging, and creating new <code>bump/v4.X.0</code> branches automatically, and
fixing some bugs.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7789">#7789</a> fixes <code>lean</code> potentially changing or interpreting arguments
after <code>--run</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8060">#8060</a> fixes a bug in the Lean kernel. During reduction of <code>Nat.pow</code>,
the kernel did not validate that the WHNF of the first argument is a
<code>Nat</code> literal before interpreting it as an <code>mpz</code> number. adds
the missing check.</p>
                  </li>
                </ul>
              </section>
            </section>
          <nav class="prev-next-buttons">
            <a class="local-button active" href="releases/v4.21.0/#release-v4___21___0" rel="prev" title="Lean 4.21.0 (2025-06-30)"><span class="arrow">â†</span><span class="where">Lean 4.21.0 (2025-06-30)</span></a><a class="local-button active" href="releases/v4.19.0/#release-v4___19___0" rel="next" title="Lean 4.19.0 (2025-05-01)"><span class="where">Lean 4.19.0 (2025-05-01)</span><span class="arrow">â†’</span></a></nav>
          </div>
        </main></div>
    </body>
  </html>

