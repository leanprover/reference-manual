<!DOCTYPE html>
<html>
  <head>
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <base href="./../../"><meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>Lean 4.21.0 (2025-06-30)</title><link rel="stylesheet" href="book.css">
    <link rel="stylesheet" href="verso-vars.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="-verso-search/elasticlunr.min.js"></script>
    <script src="-verso-search/fuzzysort.js"></script>
    <script src="-verso-search/searchIndex.js"></script>
    <script type="module" src="-verso-search/search-init.js"></script>
    <link rel="stylesheet" href="-verso-search/search-box.css">
    <link rel="stylesheet" href="-verso-search/search-highlight.css">
    <link rel="stylesheet" href="-verso-search/domain-display.css">
    <script src="-verso-data/katex/katex.js"></script>
    <script src="-verso-data/katex/math.js"></script>
    <script src="-verso-data/popper.min.js"></script>
    <script src="-verso-data/tippy-bundle.umd.min.js"></script>
    <link rel="stylesheet" href="-verso-data/katex/katex.css">
    <link rel="stylesheet" href="-verso-data/tippy-border.css">
    <style>
a.elan-command {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.elan-command:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>
a.lake-command {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.lake-command:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>
span.TODO {
  border: 3px solid red;
  display: inline;
  position: relative;
  float: right;
  clear: right;
  margin-top: 1rem;
  width: 15vw;
  margin-right: -17vw;
  color: red;
  font-size: large;
  font-weight: bold;
}
</style><style>
.hl.lean.tactic-view {
  white-space: collapse;
}
.hl.lean.tactic-view .tactic-state {
  display: block;
  left: 0;
  padding: 0;
  border: none;
}
.hl.lean.tactic-view .tactic-state .goal {
  margin-top: 1em;
  margin-bottom: 1em;
  display: block;
}
.hl.lean.tactic-view .tactic-state .goal:first-child {
  margin-top: 0.25em;
}
.hl.lean.tactic-view .tactic-state .goal:last-child {
  margin-bottom: 0.25em;
}


</style><style>
.namedocs .title {
  font-family: var(--verso-structure-font-family);
  font-size: 1.1rem;
  margin-top: 0;
  margin-left: 1rem;
  margin-right: 1.5rem;
  margin-bottom: 0.75rem;
  display: inline-block;
}
</style><style>
.marginalia .note {
  position: relative;
  padding: 0.5rem;
}

/* Wide viewport */
@media screen and (min-width: 1400px) {
  .marginalia .note {
    float: right;
    clear: right;
    margin-right: -16rem;
    width: 13rem;
    margin-top: 1rem;
  }
}

/* Very wide viewport */
@media screen and (min-width: 1600px) {
  .marginalia .note {
    margin-right: -19vw;
    width: 15vw;
  }
}

.marginalia:hover, .marginalia:hover .note, .marginalia:has(.note:hover) {
  background-color: var(--lean-accent-light-blue);
}

/* Medium viewport */
@media screen and (700px < width <= 1400px) {
  .marginalia .note {
    float: right;
    clear: right;
    width: 40%;
    margin: 1rem 0;
    margin-left: 10%;
  }
}

/* Narrow viewport (e.g. phone) */
@media screen and (width <= 700px) {
  .marginalia .note {
    float: left;
    clear: left;
    width: 90%;
    margin: 1rem 5%;
  }
}

body {
  counter-reset: margin-note-counter;
}
.marginalia .note {
  counter-increment: margin-note-counter;
}
.marginalia .note::before {
  content: counter(margin-note-counter) ".";
  position: absolute;
  vertical-align: baseline;
  font-size: 0.9em;
  font-weight: bold;
  left: -3rem;
  width: 3rem;
  text-align: right;
}
.marginalia::after {
  content: counter(margin-note-counter);
  vertical-align: super;
  font-size: 0.7em;
  font-weight: bold;
  margin-right: 0.5em;
}
</style><style>
.namedocs {
  position: relative;
  border: solid 1px #98B2C0;
  border-radius: .5rem;
  padding-top: var(--verso--box-padding);
  margin-top: var(--verso--box-vertical-margin);
  margin-bottom: var(--verso--box-vertical-margin);
}

.namedocs .text {
  /* Causes margins on child elements to collapse inside the element, such
     that the margins don't extend into parent with the background color.
     The effect is that weird borders in the definition box don't happen anymore. */
  display: flow-root;
  /* Add a padding. this is the same as the margin applied to the first and last child.
     The effect is that the padding looks the same size on all sides. */
  padding: 0 var(--verso--box-padding);
  border-top: 1px solid #98B2C0;
}

.namedocs .text > pre {
  overflow-x: auto;
}

.namedocs .signature {
  font-family: var(--verso-code-font-family);
  margin-top: 0 !important;
  margin-left: var(--verso--box-padding) !important;
  margin-bottom: .75rem !important;
}

.namedocs .label {
  display: block;
  font-size: small;
  font-family: var(--verso-structure-font-family);
  position: absolute;
  top: -0.65rem;
  left: 1rem;
  background: #fff;
  padding: 0 .5rem .125rem;
  border: 1px solid #98B2C0;
  border-radius: 1rem;
  color: #555;
}

.namedocs h1 {
  font-size: inherit;
  font-weight: bold
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.namedocs > .text .constructor {
  padding-top: 0;
  padding-right: 0;
  padding-bottom: 0;
  margin-top: 0.5rem;
  margin-bottom: 1.5rem;
}

.namedocs > .text .constructor::before {
  content: '| ';
  display: block;
  font-family: var(--verso-code-font-family);
  font-weight: bold;
  float: left;
  width: 0.5rem;
  white-space: pre;
}

.namedocs > .text .constructor .name-and-type {
  padding-left: 0.5rem;
  float: left;
  margin-top: 0;
  max-width: calc(100% - 1rem);
}
.namedocs > .text .constructor .docs {
  clear: both;
  padding-left: 1rem;
}

/* These margins work together with the padding on .text */
.namedocs .text > :first-child {
  margin-top: var(--verso--box-padding);
}
.namedocs .text > :last-child {
  margin-bottom: var(--verso--box-padding);
}

.namedocs .methods td, .namedocs .fields td {
  vertical-align: top;
}
.namedocs .inheritance {
  vertical-align: top;
  font-size: smaller;
  font-family: var(--verso-structure-font-family);
}
.namedocs .inheritance ol {
  display: inline-block;
  margin: 0;
  padding: 0;
}
.namedocs .inheritance ol li {
  list-style-type: none;
  display: inline-block;
}
.namedocs .inheritance ol li::after {
  content: " > "
}
.namedocs .inheritance ol li:last-child::after {
  content: "";
}

.namedocs .extends {
  display: inline;
  margin: 0;
  padding: 0;
}

.namedocs .extends li {
  list-style-type: none;
  display: inline-block;
}

.namedocs .extends li label {
  padding-right: 1rem;
}

.namedocs .subdocs .name-and-type {
  font-size: 1rem;
  margin-left: 0;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs .subdocs .docs {
  margin-left: 1.5rem;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs:has(input[data-parent-idx]) [data-inherited-from] {
  transition-property: opacity, display;
  transition-duration: 0.4s;
  transition-behavior: allow-discrete;
  @starting-style { opacity: 0 !important; }
}

#this-page-items .tactic-name { font-weight: bold; }
.namedocs:has(input[data-parent-idx="0"]) [data-inherited-from="0"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="0"]:checked) [data-inherited-from="0"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="0"]:checked):has(.inheritance[data-inherited-from="0"]:hover) [data-inherited-from]:not([data-inherited-from="0"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="1"]) [data-inherited-from="1"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="1"]:checked) [data-inherited-from="1"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="1"]:checked):has(.inheritance[data-inherited-from="1"]:hover) [data-inherited-from]:not([data-inherited-from="1"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="2"]) [data-inherited-from="2"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="2"]:checked) [data-inherited-from="2"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="2"]:checked):has(.inheritance[data-inherited-from="2"]:hover) [data-inherited-from]:not([data-inherited-from="2"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="3"]) [data-inherited-from="3"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="3"]:checked) [data-inherited-from="3"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="3"]:checked):has(.inheritance[data-inherited-from="3"]:hover) [data-inherited-from]:not([data-inherited-from="3"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="4"]) [data-inherited-from="4"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="4"]:checked) [data-inherited-from="4"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="4"]:checked):has(.inheritance[data-inherited-from="4"]:hover) [data-inherited-from]:not([data-inherited-from="4"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="5"]) [data-inherited-from="5"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="5"]:checked) [data-inherited-from="5"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="5"]:checked):has(.inheritance[data-inherited-from="5"]:hover) [data-inherited-from]:not([data-inherited-from="5"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="6"]) [data-inherited-from="6"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="6"]:checked) [data-inherited-from="6"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="6"]:checked):has(.inheritance[data-inherited-from="6"]:hover) [data-inherited-from]:not([data-inherited-from="6"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="7"]) [data-inherited-from="7"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="7"]:checked) [data-inherited-from="7"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="7"]:checked):has(.inheritance[data-inherited-from="7"]:hover) [data-inherited-from]:not([data-inherited-from="7"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="8"]) [data-inherited-from="8"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="8"]:checked) [data-inherited-from="8"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="8"]:checked):has(.inheritance[data-inherited-from="8"]:hover) [data-inherited-from]:not([data-inherited-from="8"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="9"]) [data-inherited-from="9"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="9"]:checked) [data-inherited-from="9"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="9"]:checked):has(.inheritance[data-inherited-from="9"]:hover) [data-inherited-from]:not([data-inherited-from="9"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="10"]) [data-inherited-from="10"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="10"]:checked) [data-inherited-from="10"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="10"]:checked):has(.inheritance[data-inherited-from="10"]:hover) [data-inherited-from]:not([data-inherited-from="10"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="11"]) [data-inherited-from="11"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="11"]:checked) [data-inherited-from="11"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="11"]:checked):has(.inheritance[data-inherited-from="11"]:hover) [data-inherited-from]:not([data-inherited-from="11"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="12"]) [data-inherited-from="12"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="12"]:checked) [data-inherited-from="12"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="12"]:checked):has(.inheritance[data-inherited-from="12"]:hover) [data-inherited-from]:not([data-inherited-from="12"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="13"]) [data-inherited-from="13"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="13"]:checked) [data-inherited-from="13"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="13"]:checked):has(.inheritance[data-inherited-from="13"]:hover) [data-inherited-from]:not([data-inherited-from="13"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="14"]) [data-inherited-from="14"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="14"]:checked) [data-inherited-from="14"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="14"]:checked):has(.inheritance[data-inherited-from="14"]:hover) [data-inherited-from]:not([data-inherited-from="14"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="15"]) [data-inherited-from="15"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="15"]:checked) [data-inherited-from="15"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="15"]:checked):has(.inheritance[data-inherited-from="15"]:hover) [data-inherited-from]:not([data-inherited-from="15"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="16"]) [data-inherited-from="16"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="16"]:checked) [data-inherited-from="16"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="16"]:checked):has(.inheritance[data-inherited-from="16"]:hover) [data-inherited-from]:not([data-inherited-from="16"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="17"]) [data-inherited-from="17"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="17"]:checked) [data-inherited-from="17"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="17"]:checked):has(.inheritance[data-inherited-from="17"]:hover) [data-inherited-from]:not([data-inherited-from="17"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="18"]) [data-inherited-from="18"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="18"]:checked) [data-inherited-from="18"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="18"]:checked):has(.inheritance[data-inherited-from="18"]:hover) [data-inherited-from]:not([data-inherited-from="18"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="19"]) [data-inherited-from="19"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="19"]:checked) [data-inherited-from="19"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="19"]:checked):has(.inheritance[data-inherited-from="19"]:hover) [data-inherited-from]:not([data-inherited-from="19"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="20"]) [data-inherited-from="20"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="20"]:checked) [data-inherited-from="20"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="20"]:checked):has(.inheritance[data-inherited-from="20"]:hover) [data-inherited-from]:not([data-inherited-from="20"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="21"]) [data-inherited-from="21"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="21"]:checked) [data-inherited-from="21"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="21"]:checked):has(.inheritance[data-inherited-from="21"]:hover) [data-inherited-from]:not([data-inherited-from="21"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="22"]) [data-inherited-from="22"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="22"]:checked) [data-inherited-from="22"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="22"]:checked):has(.inheritance[data-inherited-from="22"]:hover) [data-inherited-from]:not([data-inherited-from="22"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="23"]) [data-inherited-from="23"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="23"]:checked) [data-inherited-from="23"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="23"]:checked):has(.inheritance[data-inherited-from="23"]:hover) [data-inherited-from]:not([data-inherited-from="23"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="24"]) [data-inherited-from="24"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="24"]:checked) [data-inherited-from="24"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="24"]:checked):has(.inheritance[data-inherited-from="24"]:hover) [data-inherited-from]:not([data-inherited-from="24"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="25"]) [data-inherited-from="25"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="25"]:checked) [data-inherited-from="25"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="25"]:checked):has(.inheritance[data-inherited-from="25"]:hover) [data-inherited-from]:not([data-inherited-from="25"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="26"]) [data-inherited-from="26"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="26"]:checked) [data-inherited-from="26"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="26"]:checked):has(.inheritance[data-inherited-from="26"]:hover) [data-inherited-from]:not([data-inherited-from="26"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="27"]) [data-inherited-from="27"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="27"]:checked) [data-inherited-from="27"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="27"]:checked):has(.inheritance[data-inherited-from="27"]:hover) [data-inherited-from]:not([data-inherited-from="27"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="28"]) [data-inherited-from="28"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="28"]:checked) [data-inherited-from="28"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="28"]:checked):has(.inheritance[data-inherited-from="28"]:hover) [data-inherited-from]:not([data-inherited-from="28"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="29"]) [data-inherited-from="29"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="29"]:checked) [data-inherited-from="29"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="29"]:checked):has(.inheritance[data-inherited-from="29"]:hover) [data-inherited-from]:not([data-inherited-from="29"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="30"]) [data-inherited-from="30"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="30"]:checked) [data-inherited-from="30"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="30"]:checked):has(.inheritance[data-inherited-from="30"]:hover) [data-inherited-from]:not([data-inherited-from="30"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="31"]) [data-inherited-from="31"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="31"]:checked) [data-inherited-from="31"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="31"]:checked):has(.inheritance[data-inherited-from="31"]:hover) [data-inherited-from]:not([data-inherited-from="31"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="32"]) [data-inherited-from="32"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="32"]:checked) [data-inherited-from="32"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="32"]:checked):has(.inheritance[data-inherited-from="32"]:hover) [data-inherited-from]:not([data-inherited-from="32"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="33"]) [data-inherited-from="33"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="33"]:checked) [data-inherited-from="33"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="33"]:checked):has(.inheritance[data-inherited-from="33"]:hover) [data-inherited-from]:not([data-inherited-from="33"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="34"]) [data-inherited-from="34"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="34"]:checked) [data-inherited-from="34"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="34"]:checked):has(.inheritance[data-inherited-from="34"]:hover) [data-inherited-from]:not([data-inherited-from="34"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="35"]) [data-inherited-from="35"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="35"]:checked) [data-inherited-from="35"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="35"]:checked):has(.inheritance[data-inherited-from="35"]:hover) [data-inherited-from]:not([data-inherited-from="35"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="36"]) [data-inherited-from="36"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="36"]:checked) [data-inherited-from="36"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="36"]:checked):has(.inheritance[data-inherited-from="36"]:hover) [data-inherited-from]:not([data-inherited-from="36"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="37"]) [data-inherited-from="37"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="37"]:checked) [data-inherited-from="37"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="37"]:checked):has(.inheritance[data-inherited-from="37"]:hover) [data-inherited-from]:not([data-inherited-from="37"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="38"]) [data-inherited-from="38"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="38"]:checked) [data-inherited-from="38"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="38"]:checked):has(.inheritance[data-inherited-from="38"]:hover) [data-inherited-from]:not([data-inherited-from="38"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="39"]) [data-inherited-from="39"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="39"]:checked) [data-inherited-from="39"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="39"]:checked):has(.inheritance[data-inherited-from="39"]:hover) [data-inherited-from]:not([data-inherited-from="39"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="40"]) [data-inherited-from="40"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="40"]:checked) [data-inherited-from="40"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="40"]:checked):has(.inheritance[data-inherited-from="40"]:hover) [data-inherited-from]:not([data-inherited-from="40"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="41"]) [data-inherited-from="41"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="41"]:checked) [data-inherited-from="41"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="41"]:checked):has(.inheritance[data-inherited-from="41"]:hover) [data-inherited-from]:not([data-inherited-from="41"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="42"]) [data-inherited-from="42"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="42"]:checked) [data-inherited-from="42"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="42"]:checked):has(.inheritance[data-inherited-from="42"]:hover) [data-inherited-from]:not([data-inherited-from="42"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="43"]) [data-inherited-from="43"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="43"]:checked) [data-inherited-from="43"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="43"]:checked):has(.inheritance[data-inherited-from="43"]:hover) [data-inherited-from]:not([data-inherited-from="43"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="44"]) [data-inherited-from="44"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="44"]:checked) [data-inherited-from="44"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="44"]:checked):has(.inheritance[data-inherited-from="44"]:hover) [data-inherited-from]:not([data-inherited-from="44"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="45"]) [data-inherited-from="45"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="45"]:checked) [data-inherited-from="45"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="45"]:checked):has(.inheritance[data-inherited-from="45"]:hover) [data-inherited-from]:not([data-inherited-from="45"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="46"]) [data-inherited-from="46"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="46"]:checked) [data-inherited-from="46"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="46"]:checked):has(.inheritance[data-inherited-from="46"]:hover) [data-inherited-from]:not([data-inherited-from="46"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="47"]) [data-inherited-from="47"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="47"]:checked) [data-inherited-from="47"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="47"]:checked):has(.inheritance[data-inherited-from="47"]:hover) [data-inherited-from]:not([data-inherited-from="47"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="48"]) [data-inherited-from="48"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="48"]:checked) [data-inherited-from="48"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="48"]:checked):has(.inheritance[data-inherited-from="48"]:hover) [data-inherited-from]:not([data-inherited-from="48"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="49"]) [data-inherited-from="49"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="49"]:checked) [data-inherited-from="49"] {
  display: block;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="49"]:checked):has(.inheritance[data-inherited-from="49"]:hover) [data-inherited-from]:not([data-inherited-from="49"]) {
  opacity: 0.5;
}
</style><style>
.field-category > :first-child {
}

.field-category > :not(:first-child) {
  margin-left: 1rem;
}
</style><style>
dl.toml-table-field-spec {
}
</style><style>
.example-file {
  white-space: normal;
  font-family: var(--verso-structure-font-family);
  margin: 1rem;
  width: fit-content;
  border: 1px solid #ddd;
  padding: 0.5rem;

  /* These are necessary for the container to behave nicely on mobile */
  overflow-x: auto;
  max-width: 100%;
  box-sizing: border-box;
}
.example-file::before {
  counter-reset: linenumber;
}
.example-file > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.example-file > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
.example-file > .line::after {
  -webkit-user-select: none;
  display: inline-block;
  content: "⏎";
  opacity: 0;
}
.example-file > .line:hover::after {
  opacity: 1;
}
.example-file > .line:hover, .example-file > .line:hover::before {
  background-color: #eee;
}
.example-file > .empty {
  display: block;
  white-space: pre;
  font-family: var(--verso-code-font-family);
  font-style: italic;
}
.example-file > .empty::before {
  -webkit-user-select: none;
  display: inline-block;
  content: "";
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
</style><style>.example {
  border: 1px solid #98B2C0;
  border-radius: 0.5rem;
  margin-bottom: var(--verso--box-vertical-margin);
  margin-top: var(--verso--box-vertical-margin);
}
/* 1400 px is the cutoff for when the margin notes move out of the margin and into floated elements. */
@media screen and (700px < width <= 1400px) {
  .example {
    clear: both; /* Don't overlap margin notes with examples */
  }
}
.example .description::before {
  content: "Example: ";
}
.example .description {
  font-style: italic;
  font-family: var(--verso-structure-font-family);
  padding: var(--verso--box-padding);
}
.example[open] .description {
  margin-bottom: 0;
}
.example-content {
  padding: 0 var(--verso--box-padding) var(--verso--box-padding);
  position: relative;
}
.example-content > :first-child {
  margin-top: 0;
}
.example-content p:last-child {
  margin-bottom:0;
}
.example .hl.lean.block {
  overflow-x: auto;
}
.live-link {
  font-family: var(--verso-structure-font-family);
  position: absolute;
  bottom: 0px;
  right: 0px;
  padding: 0.5rem;
  border-top: 1px solid #98B2C0;
  border-left: 1px solid #98B2C0;
  border-top-left-radius: 0.5rem;
}
.live-link a {
  text-decoration: none;
  color: var(--lean-blue);
}
</style><style>.keyword-of .kw {
  font-weight: 500;
}
.keyword-of .hover-info {
  display: none;
}
.keyword-of .kw:hover {
  background-color: #eee;
  border-radius: 2px;
}
</style><style>.grammar .keyword {
  font-weight: 500 !important;
}

.grammar {
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
}

.grammar .comment {
  font-style: italic;
  font-family: var(--verso-text-font-family);
  /* TODO add background and text colors to Verso theme, then compute a background here */
  background-color: #fafafa;
  border: 1px solid #f0f0f0;
}

.grammar .local-name {
  font-family: var(--verso-code-font-family);
  font-style: italic;
}

.grammar .nonterminal {
  font-style: italic;
}
.grammar .nonterminal > .hover-info, .grammar .from-nonterminal > .hover-info, .grammar .local-name > .hover-info {
  display: none;
}
.grammar .active {
  background-color: #eee;
  border-radius: 2px;
}
.grammar a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
</style><style>
.c .type { font-weight: 600; }
.c .kw { font-weight: 600; }
.c .comment { font-style: italic; }
</style><style>.namedocs .label a { color: inherit; }</style><style>#toc .split-toc > ol .syntax .keyword { font-family: var(--verso-code-font-family); font-weight: 600; }</style><style>
  .error-explanation-metadata {
    margin-bottom: 2rem; /* Double the paragraph margin */
  }

  .error-explanation-metadatum:not(:last-child):after {
    content: '|';
    margin: 0 10px;
  }
  .error-explanation-removed-warning {
    border: 1px solid var(--verso-warning-color);
    border-radius: 0.5rem;
    padding-left: var(--verso--box-padding);
    padding-right: var(--verso--box-padding);
  }
  </style><style>
table.tabular {
  margin: auto;
  border-spacing: 1rem;
}
table.tabular.left-align {
  margin-right: auto;
  margin-left: 0;
}
table.tabular.center-align {
  margin: auto;
}
table.tabular.right-align {
  margin-left auto;
  margin-right: 0;
}
table.tabular td, table.tabular th {
  text-align: left;
  vertical-align: top;
}
table.tabular td > p:first-child, table.tabular th > p:first-child {
  margin-top: 0;
}
table.tabular td > p:last-child, table.tabular th > p:first-child {
  margin-bottom: 0;
}
</style><style>
.lake-opt a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.lake-opt a:hover {
  text-decoration: currentcolor underline solid;
}
</style><style>
div.TODO {
  border: 5px solid red;
  position: relative;
}
div.TODO::before {
  content: "TODO";
  position: absolute;
  top: 0;
  right: 0;
  color: red;
  font-size: large;
  font-weight: bold;
  transform: rotate(-90deg) translate(-2em);
}
</style><style>
.toml {
  font-family: var(--verso-code-font-family);
}

pre.toml {
  margin: 0.5rem .75rem;
  padding: 0.1rem 0;
}

.toml .bool, .toml .table-header {
    font-weight: 600;
}

.toml .table-header .key {
    color: #3030c0;
}

.toml .bool {
    color: #107090;
}

.toml .string {
    color: #0a5020;
}

.toml a, .toml a:link {
    color: inherit;
    text-decoration: none;
    border-bottom: 1px dotted #a2a2a2;
}

.toml a:hover {
    border-bottom-style: solid;
}
</style><style>
    main .theIndex {
      padding-left: 0;
      font-family: var(--verso-text-font-family);
    }

    main .theIndex nav {
      position: sticky;
      top: var(--verso-header-height);
      background: white;
      font-family: var(--verso-structure-font-family);
    }

    main .theIndex [id] {
      /* This needs the combined height of the index header and the page header. We
         know the height of the page header, but the index header height varies, so
         we use the maximum height it gets which also works well for readers with
         wide screens */
      scroll-margin-top: calc(var(--verso-header-height) + 7.5rem);
    }

    @media screen and (max-width: 700px) {
      /* On mobile, the sticky index takes up half the screen. */
      main .theIndex nav {
        position: static;
      }

      main .theIndex [id] {
        /* On mobile, the index header is not sticky, so we just need to
        be below the page header. */
        scroll-margin-top: var(--verso-header-height);
      }
    }

    main .theIndex nav ol {
      padding: 0;
    }

    main .theIndex nav ol li {
      display: inline-block;
    }

    main .theIndex nav ol li a {
      /* Padding instead of margin to have a bigger click target */
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
    /* Increase the size of the touch target on phones */
    @media screen and (max-width: 700px) {
      main .theIndex nav ol li a {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }
    }

    main .theIndex nav ol li:first-child a {
      padding-left: 0;
    }

    main .theIndex nav ol li + li:before {
      content: "|";
    }

    main .theIndex h1,
    main .theIndex h2,
    main .theIndex h3,
    main .theIndex h4,
    main .theIndex h5,
    main .theIndex h6 {
      margin-top: 0;
    }

    main .theIndex ol {
      list-style-type: none;
    }

    main .theIndex .division > ol {
      padding-left: 0;
      display: flex;
      flex-direction: column;
      gap: .5rem;
      overflow-wrap: break-word;
    }

   main .theIndex .division > ol > li {
      margin-bottom: 0.5rem;
    }

    main .theIndex .division ol ol {
      padding-left: 1rem;
    }

    main .theIndex .division {
      break-inside: avoid;
      counter-reset: none;
      max-width: none;
      width: auto;
    }
    </style><style>
.toml-field a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.toml-field a:hover {
  text-decoration: currentcolor underline solid;
}
</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
  font-size: inherit;
}

.hl.lean .keyword {
  color: var(--verso-code-keyword-color,);
  font-weight: var(--verso-code-keyword-weight, bold);
  font-style: var(--verso-code-keyword-style, normal);
  font-family: var(--verso-code-keyword-font-family,);
}

.hl.lean .const {
  color: var(--verso-code-const-color,);
  font-weight: var(--verso-code-const-weight, normal);
  font-style: var(--verso-code-const-style, normal);
  font-family: var(--verso-code-const-font-family,);
}

.hl.lean .var {
  color: var(--verso-code-var-color,);
  font-weight: var(--verso-code-var-weight, normal);
  font-style: var(--verso-code-var-style, italic);
  font-family: var(--verso-code-var-font-family,);

  position: relative;
}

.hl.lean .literal, .hl.lean .unknown {
  color: var(--verso-code-color,);
  font-weight: normal;
  font-style: normal;
  font-family: var(--verso-code-font-family,);
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
  background: none;
  color: black;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

.hl.lean {
}

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean * {
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info .token:not(.tactic-state):not(.tactic-state *), .hl.lean .has-info .inter-text:not(.tactic-state):not(.tactic-state *) {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: from-font;
  text-decoration-skip-ink: none;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error :not(.tactic-state):not(.tactic-state *){
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error .verso-message, .error .verso-message .token, .error .verso-message label {
  color: var(--verso-error-color);
}

.error .verso-message .case-label:has(input[type="checkbox"])::before {
  background-color: var(--verso-error-color) !important;
}

.hl.lean .has-info.warning :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-warning-indicator-color);
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color:var(--verso-warning-color);
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: var(--verso-warning-color);
}

.lean-output {
  border-left: 0.2em solid transparent;
  padding: 0 0 0 0.5em;
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}

.lean-output.error {
  border-color: var(--verso-error-indicator-color);
}

.lean-output.information {
  border-color: var(--verso-info-indicator-color);
}

.lean-output.warning {
  border-color: var(--verso-warning-indicator-color);
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid var(--verso-warning-color);
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.information :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-info-indicator-color, blue);
}

@media (hover: hover) {
  .hl.lean .has-info.information:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.information {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.information {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: var(--verso-text-font-family, sans-serif);
  white-space: normal;
  max-width: calc(min(40rem, 90vw));
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean div.docstring > :first-child {
  margin-top: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: var(--verso-code-font-family);
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
  display: inline;
  vertical-align: top;
  /* Without these, mobile Safari will start making font sizes inconsistent when its text size adjustment feature is triggered.*/
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

.hl.lean .tactic:has(.tactic-toggle:checked) {
  display: inline-grid;
  grid-template-columns: 1fr;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: inline-block;
  vertical-align: top;
  grid-row: 2;
  justify-self: start;
}

.hl.lean .tactic > label {
  position: relative;
  grid-row: 1;
  display: inline;
}

@media (hover: hover) {
  .hl.lean .tactic:has(.tactic-toggle:not(:checked)) > label:hover {
    background-color: #eeeeee;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  /* These need to be em, not rem, to scale with the font */
  border-radius: 1em;
  height: 0.25em;
  vertical-align: middle;
  width: 0.6em;
  margin-left: 0.1em;
  margin-right: 0.1em;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5em;
}

/*
Some CSS frameworks customize details/summary in ways not compatible with Verso's output.
*/

.hl.lean details {
  display: block !important;
  margin: 0;
}

.hl.lean details summary {
  display: list-item !important;
  margin: 0;
}

.hl.lean details summary:focus {
  outline: none;
  outline-offset: none;
  color: inherit;
}

.hl.lean ul > li {
  margin-bottom: 0;
}

.hl.lean details summary::marker {
  display: inline !important;
}

.hl.lean details > summary:first-of-type {
  list-style-type: disclosure-closed;
  list-style-position: inside;
}

.hl.lean details[open] > summary:first-of-type {
  list-style-type: disclosure-open;
}

.hl.lean details summary::before, .hl.lean details summary::after {
  content: "" !important;
  background: none;
  display: none;
}

.hl.lean .tactic-state summary {
  /* These need to be em, not rem, to scale with the font */
  margin-left: -0.5em;
}

.hl.lean .tactic-state details {
  /* These need to be em, not rem, to scale with the font */
  padding-left: 0.5em;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7em;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6em;
  height: 0.6em;
  vertical-align: middle;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  /* These need to be em, not rem, to scale with the font */
  margin-left: 0.5em;
  margin-top: 0.1em;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .goal-name {
  font-style: italic;
  font-family: var(--verso-code-font-family);
  color: inherit;
}

.hl.lean .hypotheses {
  display: table;
}

.hl.lean .hypothesis {
  display: table-row;
}

.hl.lean .hypothesis > * {
  display: table-cell;
}


.hl.lean .hypotheses .colon {
  text-align: center;
  /* This needs to be em, not rem, to scale with the font */
  min-width: 1em;
}

.hl.lean .hypotheses .name {
  text-align: right;
}

.hl.lean .hypotheses .name,
.hl.lean .hypotheses .type,
.hl.lean .conclusion .type {
  font-family: var(--verso-code-font-family);
}

.tippy-box {
  /* Without these, mobile Safari will start making font sizes inconsistent when its text size adjustment feature is triggered.*/
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;

}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid var(--verso-warning-color);
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}

.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

.extra-doc-links {
  list-style-type: none;
  margin-left: 0;
  padding: 0;
}

.extra-doc-links > li {
  display: inline-block;
}

.extra-doc-links > li:not(:last-child)::after {
  content: '|';
  display: inline-block;
  margin: 0 0.25em;
}

.verso-message .trace {
  display: block;
}

.verso-message .trace > summary::marker {
  color: var(--verso-text-color);
}

.verso-message .trace-children {
  margin: 0;
  padding: 0;
}

.verso-message .trace-children > li {
  list-style-type: none;
  margin-left: 1.5em;
}

.verso-message .trace-children > li:not(:has(.trace)) {
  margin-left: 0;
}

.verso-message .trace-class {
  color: color-mix(in srgb, currentColor 70%, transparent);
  font-weight: bold;
  margin: 0;
  padding: 0;
}

.verso-message .text {
  white-space: pre-wrap;
}

</style><style>.error-explanation-short-name { hyphenate-character: ''; }</style><style>
.env-var a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
.env-var a:hover {
  text-decoration: currentcolor underline solid;
}

</style><style>.plain-keyword {
  font-weight: 500;
}
</style><style>
a.technical-term {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}
a.technical-term:hover {
  text-decoration: currentcolor underline solid;
}
/* Highlight the clicked term */
.def-technical-term:target {
  background-color: var(--verso-selected-color);
  outline: auto;
}
</style><style>
.error-example-container:not(:last-child) {
  border-bottom: 1px solid gray;
  padding-bottom: var(--verso--box-padding);
}
.error-example-tab-list [role="tab"] {
  position: relative;
  z-index: 1;
  background: white;
  border: 0;
  padding: 0.2em;
  cursor: pointer;
}
.error-example-tab-list [role="tab"]:not(:last-child) {
  margin-right: 1rem;
}
.error-example-tab-list [role="tab"][aria-selected="true"] {
  border-bottom: 1px solid gray;
}
/* this rule and the following ensure that all tabs are the same height */
.error-example-tab-view {
  display: flex;
}
.error-example-tabpanel {
  margin-right: -100%;
  width: 100%;
  display: block;
}
.error-example-tabpanel.error-example-tabpanel-hidden {
  visibility: hidden;
}
.error-example-tabpanel .hl.lean .token {
  /* unset transition to avoid lag when switching panels */
  transition: visibility 0s;
}
  </style><style>
.syntax-error {
  white-space: normal;
}
.syntax-error::before {
  counter-reset: linenumber;
}
.syntax-error > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.syntax-error > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}

:is(.syntax-error > .line):has(.parse-message)::before {
  color: red;
  font-weight: bold;
}

.syntax-error .parse-message > code.hover-info {
  display:none;
}

.syntax-error .parse-message {
  white-space: pre;
  text-decoration-skip-ink: none;
  color: red;
  font-weight: 600;
}
</style><script>
      
window.addEventListener("load", () => {
  const innerProps = {
    onShow(inst) { console.log(inst); },
    onHide(inst) { console.log(inst); },
    content(tgt) {
      const content = document.createElement("span");
      const state = tgt.querySelector(".hover-info").cloneNode(true);
      state.style.display = "block";
      content.appendChild(state);
      /* Render docstrings - TODO server-side */
      if ('undefined' !== typeof marked) {
          for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
              const str = d.innerText;
              const html = marked.parse(str);
              const rendered = document.createElement("div");
              rendered.classList.add("docstring");
              rendered.innerHTML = html;
              d.parentNode.replaceChild(rendered, d);
          }
      }
      content.style.display = "block";
      content.className = "hl lean popup";
      return content;
    }
  };
  const outerProps = {
    allowHtml: true,
    theme: "lean",
    placement: 'bottom-start',
    maxWidth: "none",
    delay: 100,
    moveTransition: 'transform 0.2s ease-out',
    onTrigger(inst, event) {
      const ref = event.currentTarget;
      const block = ref.closest('.hl.lean');
      block.querySelectorAll('.active').forEach((i) => i.classList.remove('active'));
      ref.classList.add("active");
    },
    onUntrigger(inst, event) {
      const ref = event.currentTarget;
      const block = ref.closest('.hl.lean');
      block.querySelectorAll('.active').forEach((i) => i.classList.remove('active'));
    }
  };
  tippy.createSingleton(tippy('pre.grammar.hl.lean .nonterminal.documented, pre.grammar.hl.lean .from-nonterminal.documented, pre.grammar.hl.lean .local-name.documented', innerProps), outerProps);
});
</script>
    <script>
      
window.addEventListener("load", () => {
  tippy('.keyword-of.hl.lean', {
    allowHtml: true,
    /* DEBUG -- remove the space: * /
    onHide(any) { return false; },
    trigger: "click",
    // */
    maxWidth: "none",

    theme: "lean",
    placement: 'bottom-start',
    content (tgt) {
      const content = document.createElement("span");
      const state = tgt.querySelector(".hover-info").cloneNode(true);
      state.style.display = "block";
      content.appendChild(state);
      /* Render docstrings - TODO server-side */
      if ('undefined' !== typeof marked) {
          for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
              const str = d.innerText;
              const html = marked.parse(str);
              const rendered = document.createElement("div");
              rendered.classList.add("docstring");
              rendered.innerHTML = html;
              d.parentNode.replaceChild(rendered, d);
          }
      }
      content.style.display = "block";
      content.className = "hl lean popup";
      return content;
    }
  });
});
</script>
    <script>
      
window.addEventListener('DOMContentLoaded', () => {
  const tabLists = document.querySelectorAll('.error-example-tab-list')
  tabLists.forEach(tabList => {
    const tabs = tabList.querySelectorAll(':scope > [role="tab"]')

    const setActiveTab = (e) => {
      for (const tab of tabs) {
        const controllee = document.getElementById(tab.getAttribute('aria-controls'))
        if (tab === e.target) {
          tab.setAttribute('aria-selected', true)
          controllee.classList.remove('error-example-tabpanel-hidden')
        } else {
          tab.setAttribute('aria-selected', false)
          controllee.classList.add('error-example-tabpanel-hidden')
        }
      }
    }

    tabs.forEach(tab => {
      tab.addEventListener('click', setActiveTab)
    })

    let focusedIdx = 0
    tabList.addEventListener('keydown', e => {
      if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
        tabs[focusedIdx].setAttribute('tabindex', -1)
        focusedIdx =
          e.key === 'ArrowRight'
          ? (focusedIdx + 1) % tabs.length
          : (focusedIdx - 1 + tabs.length) % tabs.length
        tabs[focusedIdx].setAttribute('tabindex', 0)
        tabs[focusedIdx].focus()
      }
    })
  })
})
  </script>
    <script>
      function openDetailsForHashTarget() {
  // Get the current hash from the URL
  const hash = window.location.hash;

  // Exit early if no hash is present
  if (!hash) return;

  // Remove the # to get the actual ID
  const targetId = hash.substring(1);

  // Find the target element
  const targetElement = document.getElementById(targetId);

  // Exit if target element doesn't exist
  if (!targetElement) return;

  // Find the closest details element that contains the target
  const detailsElement = targetElement.closest('details');

  // If the target is inside a details element, open it
  if (detailsElement) {
    detailsElement.open = true;
  }
}

// Run the function when the page loads
document.addEventListener('DOMContentLoaded', openDetailsForHashTarget);

// Also run when the hash changes (for single-page applications)
window.addEventListener('hashchange', openDetailsForHashTarget);

// Run immediately in case the script loads after DOMContentLoaded
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', openDetailsForHashTarget);
} else {
  openDetailsForHashTarget();
}
</script>
    <script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let docsJson = "-verso-docs.json";
    fetch(docsJson).then((resp) => resp.json()).then((versoDocData) => {

      function hideParentTooltips(element) {
        let parent = element.parentElement;
        while (parent) {
          const tippyInstance = parent._tippy;
          if (tippyInstance) {
            tippyInstance.hide();
          }
          parent = parent.parentElement;
        }
      }



      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        /* theme: "lean", */
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        /* ignoreAttributes: true, */
        followCursor: 'initial',
        onShow(inst) {
          if (inst.reference.className == 'tactic') {

            const toggle = inst.reference.querySelector("input.tactic-toggle");
            if (toggle && toggle.checked) {
              return false;
            }
            hideParentTooltips(inst.reference);
            //if (blockedByTippy(inst.reference)) { return false; }

          } else if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          if (tgt.className == 'tactic') {
            const state = tgt.querySelector(".tactic-state").cloneNode(true);
            state.style.display = "block";
            content.appendChild(state);
            content.style.display = "block";
            content.className = "hl lean popup";
          } else {
            content.className = "hl lean";
            content.style.display = "block";
            content.style.maxHeight = "300px";
            content.style.overflowY = "auto";
            content.style.overflowX = "hidden";
            const hoverId = tgt.dataset.versoHover;
            const hoverInfo = tgt.querySelector(".hover-info");
            if (hoverId) { // Docstrings from the table
              // TODO stop doing an implicit conversion from string to number here
              let data = versoDocData[hoverId];
              if (data) {
                const info = document.createElement("span");
                info.className = "hover-info";
                info.style.display = "block";
                info.innerHTML = data;
                content.appendChild(info);
                /* Render docstrings - TODO server-side */
                if ('undefined' !== typeof marked) {
                    for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                        const str = d.innerText;
                        const html = marked.parse(str);
                        const rendered = document.createElement("div");
                        rendered.classList.add("docstring");
                        rendered.innerHTML = html;
                        d.parentNode.replaceChild(rendered, d);
                    }
                }
              } else {
                content.innerHTML = "Failed to load doc ID: " + hoverId;
              }
            } else if (hoverInfo) { // The inline info, still used for compiler messages
              content.appendChild(hoverInfo.cloneNode(true));
            }
            const extraLinks = tgt.parentElement.dataset['versoLinks'];
            if (extraLinks) {
              try {
                const extras = JSON.parse(extraLinks);
                const links = document.createElement('ul');
                links.className = 'extra-doc-links';
                extras.forEach((l) => {
                  const li = document.createElement('li');
                  li.innerHTML = "<a href=\"" + l['href'] + "\" title=\"" + l.long + "\">" + l.short + "</a>";
                  links.appendChild(li);
                });
                content.appendChild(links);
              } catch (error) {
                console.error(error);
              }
            }
          }
          return content;
        }
      };


      document.querySelectorAll('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .level-var, .hl.lean .level-const, .hl.lean .level-op, .hl.lean .sort').forEach(element => {
        element.setAttribute('data-tippy-theme', 'lean');
      });
      document.querySelectorAll('.hl.lean .has-info.warning').forEach(element => {
        element.setAttribute('data-tippy-theme', 'warning message');
      });
      document.querySelectorAll('.hl.lean .has-info.information').forEach(element => {
        element.setAttribute('data-tippy-theme', 'info message');
      });
      document.querySelectorAll('.hl.lean .has-info.error').forEach(element => {
        element.setAttribute('data-tippy-theme', 'error message');
      });
      document.querySelectorAll('.hl.lean .tactic').forEach(element => {
        element.setAttribute('data-tippy-theme', 'tactic');
      });
      let insts = tippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .has-info, .hl.lean .tactic, .hl.lean .level-var, .hl.lean .level-const, .hl.lean .level-op, .hl.lean .sort', defaultTippyProps);
  });
}
</script>
    <script defer="defer" data-domain="lean-lang.org" src="https://plausible.io/js/script.outbound-links.js"></script>
    <script src="static/print.js"></script>
    <link rel="stylesheet" href="static/colors.css">
    <link rel="stylesheet" href="static/theme.css">
    <link rel="stylesheet" href="static/print.css">
    <link rel="stylesheet" href="static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="static/fonts/source-sans/source-sans-3.css">
    <link rel="stylesheet" href="static/fonts/noto-sans-mono/noto-sans-mono.css">
    <script src="-verso-search/search-highlight.js" defer="defer"></script>
    </head>
  <body>
    <header>
      <div class="header-logo-wrapper">
        <a href="" id="logo"><img src="static/lean_logo.svg"></a></div>
      <div class="header-title-wrapper">
        <a href="" class="header-title"><h1>
            The Lean Language Reference</h1>
          </a></div>
      </header>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc"><div class="first">
          <a href="" class="toc-title"><h1>
              The Lean Language Reference</h1>
            </a><div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class="">Table of Contents</span></div>
              <table><tr class="numbered"><td class="num">1.</td><td><a href="Introduction/#introduction">Introduction</a></td></tr><tr class="numbered"><td class="num">2.</td><td><a href="Elaboration-and-Compilation/#The-Lean-Language-Reference--Elaboration-and-Compilation">Elaboration and Compilation</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="Interacting-with-Lean/#interaction">Interacting with Lean</a></td></tr><tr class="numbered"><td class="num">4.</td><td><a href="The-Type-System/#type-system">The Type System</a></td></tr><tr class="numbered"><td class="num">5.</td><td><a href="Source-Files-and-Modules/#files">Source Files and Modules</a></td></tr><tr class="numbered"><td class="num">6.</td><td><a href="Namespaces-and-Sections/#namespaces-sections">Namespaces and Sections</a></td></tr><tr class="numbered"><td class="num">7.</td><td><a href="Definitions/#definitions">Definitions</a></td></tr><tr class="numbered"><td class="num">8.</td><td><a href="Axioms/#axioms">Axioms</a></td></tr><tr class="numbered"><td class="num">9.</td><td><a href="Attributes/#attributes">Attributes</a></td></tr><tr class="numbered"><td class="num">10.</td><td><a href="Terms/#terms">Terms</a></td></tr><tr class="numbered"><td class="num">11.</td><td><a href="Type-Classes/#type-classes">Type Classes</a></td></tr><tr class="numbered"><td class="num">12.</td><td><a href="Coercions/#coercions">Coercions</a></td></tr><tr class="numbered"><td class="num">13.</td><td><a href="Tactic-Proofs/#tactics">Tactic Proofs</a></td></tr><tr class="numbered"><td class="num">14.</td><td><a href="Functors___-Monads-and--do--Notation/#monads-and-do">Functors, Monads and <code>do</code>-Notation</a></td></tr><tr class="numbered"><td class="num">15.</td><td><a href="IO/#io">IO</a></td></tr><tr class="numbered"><td class="num">16.</td><td><a href="The-Simplifier/#the-simplifier">The Simplifier</a></td></tr><tr class="numbered"><td class="num">17.</td><td><a href="The--grind--tactic/#grind-tactic">The <code>grind</code> tactic</a></td></tr><tr class="numbered"><td class="num">18.</td><td><a href="Basic-Propositions/#basic-props">Basic Propositions</a></td></tr><tr class="numbered"><td class="num">19.</td><td><a href="Basic-Types/#basic-types">Basic Types</a></td></tr><tr class="numbered"><td class="num">20.</td><td><a href="Notations-and-Macros/#language-extension">Notations and Macros</a></td></tr><tr class="numbered"><td class="num">21.</td><td><a href="Run-Time-Code/#runtime">Run-Time Code</a></td></tr><tr class="numbered"><td class="num">22.</td><td><a href="Build-Tools-and-Distribution/#build-tools-and-distribution">Build Tools and Distribution</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Error-Explanations/#The-Lean-Language-Reference--Error-Explanations">Error Explanations</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="The-Module-System/#module-system">The Module System</a></td></tr><tr class="current unnumbered"><td class="num"><td><a href="releases/#release-notes">Release Notes</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="platforms/#platforms">Supported Platforms</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="the-index/#The-Lean-Language-Reference--Index">Index</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-release-notes" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-release-notes" checked="checked"></label><span class="unnumbered"></span><span class=""><a href="releases/#release-notes">Release Notes</a></span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="releases/v4.25.0/#release-v4___25___0">Lean 4.25.0-rc2 (2025-10-22)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.24.0/#release-v4___24___0">Lean 4.24.0 (2025-10-14)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.23.0/#release-v4___23___0">Lean 4.23.0 (2025-09-15)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.22.0/#release-v4___22___0">Lean 4.22.0 (2025-08-14)</a></td></tr><tr class="current unnumbered"><td class="num"><td><a href="releases/v4.21.0/#release-v4___21___0">Lean 4.21.0 (2025-06-30)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.20.0/#release-v4___20___0">Lean 4.20.0 (2025-06-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.19.0/#release-v4___19___0">Lean 4.19.0 (2025-05-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.18.0/#release-v4___18___0">Lean 4.18.0 (2025-04-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.17.0/#release-v4___17___0">Lean 4.17.0 (2025-03-03)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.16.0/#release-v4___16___0">Lean 4.16.0 (2025-02-03)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.15.0/#release-v4___15___0">Lean 4.15.0 (2025-01-04)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.14.0/#release-v4___14___0">Lean 4.14.0 (2024-12-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.13.0/#release-v4___13___0">Lean 4.13.0 (2024-11-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.12.0/#release-v4___12___0">Lean 4.12.0 (2024-10-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.11.0/#release-v4___11___0">Lean 4.11.0 (2024-09-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.10.0/#release-v4___10___0">Lean 4.10.0 (2024-07-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.9.0/#release-v4___9___0">Lean 4.9.0 (2024-07-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.8.0/#release-v4___8___0">Lean 4.8.0 (2024-06-05)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.7.0/#release-v4___7___0">Lean 4.7.0 (2024-04-03)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.6.0/#release-v4___6___0">Lean 4.6.0 (2024-02-29)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.5.0/#release-v4___5___0">Lean 4.5.0 (2024-02-01)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.4.0/#release-v4___4___0">Lean 4.4.0 (2023-12-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.3.0/#release-v4___3___0">Lean 4.3.0 (2023-11-30)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.2.0/#release-v4___2___0">Lean 4.2.0 (2023-10-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.1.0/#release-v4___1___0">Lean 4.1.0 (2023-09-26)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0/#release-v4___0___0">Lean 4.0.0 (2023-09-08)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m5/#release-v4___0___0-m5">Lean 4.0.0-m5 (2022-08-22)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m4/#release-v4___0___0-m4">Lean 4.0.0-m4 (2022-03-27)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m3/#release-v4___0___0-m3">Lean 4.0.0-m3 (2022-01-31)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m2/#release-v4___0___0-m2">Lean 4.0.0-m2 (2021-03-02)</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.0.0-m1/#release-v4___0___0-m1">Lean 4.0.0-m1 (2021-01-04)</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-release-v4___21___0" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-release-v4___21___0" checked="checked"></label><span class="unnumbered"></span><span class="current"><a href="releases/v4.21.0/#release-v4___21___0">Lean 4.21.0 (2025-06-30)</a></span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Highlights">Highlights</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Language">Language</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Library">Library</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Compiler">Compiler</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Pretty-Printing">Pretty Printing</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Documentation">Documentation</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Server">Server</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Lake">Lake</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="releases/v4.21.0/#The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Other">Other</a></td></tr></table></div>
            </div>
          </div>
        <div class="last">
          <ul id="meta-links">
            <li>
              <a href="https://github.com/leanprover/reference-manual">Source Code</a></li>
            <li>
              <a href="https://github.com/leanprover/reference-manual/issues">Report Issues</a></li>
            </ul>
          </div>
        </nav>
      <main><div class="content-wrapper">
          <nav class="prev-next-buttons">
            <a class="local-button active" href="releases/v4.22.0/#release-v4___22___0" rel="prev" title="Lean 4.22.0 (2025-08-14)"><span class="arrow">←</span><span class="where">Lean 4.22.0 (2025-08-14)</span></a><a class="local-button active" href="releases/v4.20.0/#release-v4___20___0" rel="next" title="Lean 4.20.0 (2025-06-02)"><span class="where">Lean 4.20.0 (2025-06-02)</span><span class="arrow">→</span></a></nav>
          <section>
            <h1>
              Lean 4.21.0 (2025-06-30)<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&amp;name=release-v4.21.0" title="Permalink">🔗</a></span></h1>
            <p>
              For this release, 295 changes landed. In addition to the 100 feature additions and 83 fixes listed below there were 2 refactoring changes, 4 documentation improvements, 6 performance improvements, 2 improvements to the test suite and 98 other changes.</p>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Highlights">
                Highlights</h2>
              <p>
                <em>'Unknown identifier' code actions</em></p>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7665">#7665</a> and <a href="https://github.com/leanprover/lean4/pull/8180">#8180</a> add
support for code actions that resolve 'Unknown identifier' errors by either importing the missing declaration or by
changing the identifier to one from the environment.</p>
                  </li>
                </ul>
              <p>
                <em>New Language Features</em></p>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8449">#8449</a> and <a href="https://github.com/leanprover/lean4/pull/8516">#8516</a>
upstream and extend the Mathlib <code>clear_value</code> tactic. Given a
local definition <code>x : T := v</code>, the tactic <code>clear_value x</code> replaces it
with a hypothesis <code>x : T</code>, or throws an error if the goal does not
depend on the value <code>v</code>. The syntax <code>clear_value (h : x = _)</code> creates a
hypothesis <code>h : x = _</code> before clearing the value of <code>x</code>. Any expression definitionally equal to <code>x</code>
can be used in place of the underscore.
Furthermore, <code>clear_value *</code> clears all values that can be cleared, or throws an
error if none can be cleared.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8512">#8512</a> adds a <code>value_of% ident</code> term that elaborates to the value of
the local or global constant <code>ident</code>. This is useful for creating
definition hypotheses:</p>
                  <pre>let x := ... complicated expression ...
have hx : x = value_of% x := rfl
</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8450">#8450</a> adds a feature to the <code>subst</code> tactic so that when <code>x : X := v</code>
is a local definition, <code>subst x</code> substitutes <code>v</code> for <code>x</code> in the goal and
removes <code>x</code>. Previously the tactic would throw an error.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8037">#8037</a> introduces a <code>noConfusionType</code> construction that’s sub-quadratic
in size, and reduces faster. The previous <code>noConfusion</code> construction with
two nested <code>match</code> statements is quadratic in size and reduction behavior.
Using some helper definitions, a linear size construction is possible.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8104">#8104</a> makes <code>fun_induction</code> and <code>fun_cases</code> (try to) unfold the
function application of interest in the goal. The old behavior can be
enabled with <code>set_option tactic.fun_induction.unfolding false</code>. For
<code>fun_cases</code> this does not work yet when the function’s result type
depends on one of the arguments, see issue <a href="https://github.com/leanprover/lean4/issues/8296">#8296</a>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8171">#8171</a> omits cases from functional induction/cases principles that are
implemented <code>by contradiction</code> (or, more generally, <code>False.elim</code>,
<code>absurd</code> or `noConfusion). <strong>Breaking change</strong> in the sense that there are
fewer goals to prove after using functional induction.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8106">#8106</a> adds a <code>register_linter_set</code> command for declaring linter sets.
The <code>getLinterValue</code> function now checks if the present linter is
contained in a set that has been enabled (using the <code>set_option</code> command
or on the command line).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8267">#8267</a> makes <code>#guard_msgs</code> to treat <code>trace</code> messages separate from
<code>info</code>, <code>warning</code> and <code>error</code>. It also introduces the ability to say
<code>#guard_msgs (pass info)</code>, like <code>(drop info)</code> so far, and also adds
<code>(check info)</code> as the explicit form of <code>(info)</code>, for completeness.</p>
                  </li>
                </ul>
              <p>
                <em>Library Highlights</em></p>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8358">#8358</a> introduces a very minimal version of the new iterator library.
It comes with list iterators and various consumers, namely <code>toArray</code>,
<code>toList</code>, <code>toListRev</code>, <code>ForIn</code>, <code>fold</code>, <code>foldM</code> and <code>drain</code>. All
consumers also come in a partial variant that can be used without any
proofs. This limited version of the iterator library generates decent
code, even with the old code generator.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7352">#7352</a> reworks the <code>simp</code> set around the <code>Id</code> monad, to not elide or
unfold <code>pure</code> and <code>Id.run</code></p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8313">#8313</a> changes the definition of <code>Vector</code> so it no longer extends
<code>Array</code>. This prevents <code>Array</code> API from "leaking through".</p>
                  </li>
                </ul>
              <p>
                <em>Other Highlights</em></p>
              <ul>
                <li>
                  <p>
                    Performance optimizations in <code>dsimp</code>:</p>
                  <ul>
                    <li>
                      <p>
                        <a href="https://github.com/leanprover/lean4/pull/6973">#6973</a> stops <code>dsimp</code> from visiting proof terms, which should make
<code>simp</code> and <code>dsimp</code> more efficient.</p>
                      </li>
                    <li>
                      <p>
                        <a href="https://github.com/leanprover/lean4/pull/7428">#7428</a> adds a <code>dsimp</code> cache to <code>simp</code>. Previously each <code>dsimp</code> call from
<code>simp</code> started with a fresh cache. As a result, time spent in <code>simp</code> while
compiling Mathlib is reduced by over 45%, giving an overall 8% speedup to
Mathlib compilation.</p>
                      </li>
                    </ul>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8221">#8221</a> adjusts the experimental module system to not export the bodies
of <code>def</code>s unless opted out by the new attribute <code>@[expose]</code> on the <code>def</code>
or on a surrounding <code>section</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8559">#8559</a> and <a href="https://github.com/leanprover/lean4/pull/8560">#8560</a> fix an adversarial
soundness attack described  in <a href="https://github.com/leanprover/lean4/pull/8554">#8554</a>. The
attack exploits the fact that <code>assert!</code> no longer aborts execution, and
that users can redirect error messages.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Language">
                Language</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/6973">#6973</a> stops <code>dsimp</code> from visiting proof terms, which should make
<code>simp</code> and <code>dsimp</code> more efficient.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7428">#7428</a> adds a <code>dsimp</code> cache to <code>simp</code>. Previously each <code>dsimp</code> call from <code>simp</code> started with a fresh cache. As a result, time spent in <code>simp</code> while compiling Mathlib is reduced by over 45%, giving an overall 8% speedup to Mathlib compilation.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7631">#7631</a> fixes <code>Lean.Level.mkIMaxAux</code> (<code>mk_imax</code> in the kernel) such that
<code>imax 1 u</code> reduces to <code>u</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7977">#7977</a> adds basic support for eta-reduction to <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8002">#8002</a> fixes an issue where "go to definition" for variables
generalized by the <code>induction</code> and <code>cases</code> tactic did not work. Closes
#2873.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8024">#8024</a> adds the <code>--setup</code> option to the <code>lean</code> CLI. It takes a path to
a JSON file containing information about a module's imports and
configuration, superseding that in the module's own file header. This
will be used by Lake to specify paths to module artifacts (e.g., oleans
and ileans) separate from the <code>LEAN_PATH</code> schema.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8037">#8037</a> introduces a <code>noConfusionType</code> construction that’s sub-quadratic
in size, and reduces faster.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8104">#8104</a> makes <code>fun_induction</code> and <code>fun_cases</code> (try to) unfold the
function application of interest in the goal. The old behavior can be
enabled with <code>set_option tactic.fun_induction.unfolding false</code>. For
<code>fun_cases</code> this does not work yet when the function’s result type
depends on one of the arguments, see issue #8296.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8106">#8106</a> adds a <code>register_linter_set</code> command for declaring linter sets.
The <code>getLinterValue</code> function now checks if the present linter is
contained in a set that has been enabled (using the <code>set_option</code> command
or on the command line).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8169">#8169</a> makes the whitespace handling in the syntax of <code>omit</code> and
<code>include</code> consistent with <code>variable</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8171">#8171</a> omits cases from functional induction/cases principles that are
implemented <code>by contradiction</code> (or, more generally, <code>False.elim</code>,
<code>absurd</code> or `noConfusion). Breaking change in the sense that there are
fewer goals to prove after using functional induction.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8196">#8196</a> improves the E-matching pattern inference procedure in <code>grind</code>.
Consider the following theorem:</p>
                  <pre>@[grind →]
theorem eq_empty_of_append_eq_empty {xs ys : Array α} (h : xs ++ ys = #[]) : xs = #[] ∧ ys = #[] :=
  append_eq_empty_iff.mp h
</pre><p>
                    Before this PR, <code>grind</code> inferred the following pattern:</p>
                  <pre>@HAppend.hAppend _ _ _ _ #2 #1
</pre><p>
                    Note that this pattern would match any <code>++</code> application, even if it had
nothing to do with arrays. With this PR, the inferred pattern becomes:</p>
                  <pre>@HAppend.hAppend (Array #3) (Array _) (Array _) _ #2 #1
</pre><p>
                    With the new pattern, the theorem will not be considered by <code>grind</code> for
goals that do not involve <code>Array</code>s.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8198">#8198</a> fixes an issue in the theory propagation used in <code>grind</code>. When
two equivalence classes are merged, the core may need to push additional
equalities or disequalities down to the satellite theory solvers (e.g.,
<code>cutsat</code>, <code>comm ring</code>, etc). Some solvers (e.g. <code>cutsat</code>) assume that
all of the core’s invariants hold before they receive those facts.
Propagating immediately therefore risks violating a solver’s
pre-conditions midway through the merge. To decouple the merge operation
from propagation and to keep the core solver-agnostic, this PR adds the
helper type <code>PendingTheoryPropagation</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8208">#8208</a> reduces the need for defeq in frequently used bv_decide rewrite
by turning them into simprocs that work on structural equality instead.
As the intended meaning of these rewrites is to simply work with
structural equality anyways this should not change the proving power of
<code>bv_decide</code>'s rewriter but just make it faster on certain very large
problems.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8209">#8209</a> fixes a nondeterminism issue in the <code>grind</code> tactic. It was a bug
in the model-based theory combination module.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8221">#8221</a> adjusts the experimental module system to not export the bodies
of <code>def</code>s unless opted out by the new attribute <code>@[expose]</code> on the <code>def</code>
or on a surrounding <code>section</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8224">#8224</a> adds diagnostic information for the commutative ring procedure
in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8226">#8226</a> fixes the <code>simplifyBasis</code> procedure in the commutative ring
procedure in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8231">#8231</a> changes the behaviour of <code>apply?</code> so that the <code>sorry</code> it uses to
close the goal is non-synthetic. (Recall that correct use of synthetic
sorries requires that the tactic also generates an error message, which
we don't want to do in this situation.) This change defends against the problem reported in <a href="https://github.com/leanprover/lean4/issues/8212">#8212</a>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8232">#8232</a> fixes elaboration of constants in the <code>rewrite</code> tactic.
previously, <code>rw [eq_self]</code> would elaborate <code>eq_self</code> twice, and add it
to the infotree twice. This would lead to the "Expected type" being
delaborated with an unknown universe metavariable.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8241">#8241</a> changes the behavior of the <code>rename</code> tactic to skip over
implementation detail hypotheses when finding a hypothesis to rename.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8254">#8254</a> fixes unintended inlining of <code>ToJson</code>, <code>FromJson</code>, and <code>Repr</code>
instances, which was causing exponential compilation times in <code>deriving</code>
clauses for large structures.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8259">#8259</a> clarifies the invalid field notation error when projected value
type is a metavariable.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8260">#8260</a> clarifies the invalid dotted identifier notation error when the
type is a sort.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8261">#8261</a> adjusts the error message when <code>apply</code> fails to unify. It is
clearer about distinguishing the term being applied and the goal, as
well as distinguishing the "conclusion" of the given term and the term
itself.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8262">#8262</a> improves the type-as-hole error message. Type-as-hole error for
theorem declarations should not admit the possibility of omitting the
type entirely.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8264">#8264</a> rewords the <code>application type mismatch</code> error message by more
specifically mentioning that the problem is with the final argument.
This is useful when the same argument is passed to the function multiple
times.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8267">#8267</a> makes <code>#guard_msgs</code> to treat <code>trace</code> messages separate from
<code>info</code>, <code>warning</code> and <code>error</code>. It also introduce the ability to say
<code>#guard_msgs (pass info</code>, like <code>(drop info)</code> so far, and also adds
<code>(check info)</code> as the explicit form of <code>(info)</code>, for completeness.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8270">#8270</a> makes the enum pass of <code>bv_decide</code> handle enum types that are
universe polymorphic.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8271">#8271</a> changes <code>addPPExplicitToExposeDiff</code> to show universe differences
and to visit into projections, e.g.:</p>
                  <pre>error: tactic 'rfl' failed, the left-hand side
  (Test.mk (∀ (x : PUnit.{1}), True)).1
is not definitionally equal to the right-hand side
  (Test.mk (∀ (x : PUnit.{2}), True)).1
</pre><p>
                    for</p>
                  <pre>inductive Test where
  | mk (x : Prop)

</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8275">#8275</a> ensures the congruence closure in <code>grind</code> and find non-dependent
arrow congruences. That is, it can apply the <code>implies_congr</code> theorem.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8276">#8276</a> adds the instances <code>Grind.CommRing (Fin n)</code> and <code>Grind.IsCharP (Fin n) n</code>. New tests:</p>
                  <pre>example (x y z : Fin 13) :
    (x + y + z) ^ 2 = x ^ 2 + y ^ 2 + z ^ 2 + 2 * (x * y + y * z + z * x) := by
  grind +ring

</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8277">#8277</a> improves the generation of <code>.induct_unfolding</code> by rewriting
<code>match</code> statements more reliably, using the new “congruence equations”
introduced in #8284. Fixes #8195.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8280">#8280</a> the support for arrows in the congruence closure procedure used
in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8281">#8281</a> improves the module used to prove auxiliary type cast equalities
in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8284">#8284</a> adds a new variant of equations for matchers, namely “congruence
equations” that generalize the normal matcher equations. They have
unrestricted left-hand-sides, extra equality assumptions relating the
discriminiants with the patterns and thus prove heterogenous equalities.
In that sense they combine congruence with rewriting. They can be used
to rewrite matcher applications where, due to dependencies, <code>simp</code> would
fail to rewrite the discriminants, and will be used when producing the
unfolding induction theorems.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8285">#8285</a> fixes “declaration has free variables” errors when generating a
splitter for a match statement with named patterns. Fixes #8274.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8299">#8299</a> implements a missing preprocessing step in <code>grind</code>: abstract
metavariables in the goal</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8301">#8301</a> unfolds functions in the unfolding induction principle properly
when they use <code>bif</code> (a.k.a. <code>Bool.cond</code>).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8302">#8302</a> lets <code>cases</code> fail gracefully when the motive has an complex
argument whose type is dependent type on the targets. While the
<code>induction</code> tactic can handle this well, <code>cases</code> does not. This change
at least gracefully degrades to not instantiating that motive parameter.
See issue <a href="https://github.com/leanprover/lean4/issues/8296">#8296</a> for more details on this issue.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8303">#8303</a> fixes missing occurrences of <code>foldProjs</code> in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8306">#8306</a> makes it possible for <code>bv_decide</code> to tackle situations for its
enum type preprocessing where the enums themselves are use in a
dependently type context (for example inside of a <code>GetElem</code> body) and
thus not trivially accessible to <code>simp</code> for rewriting. To do this we
drop<code>GetElem</code> on <code>BitVec</code> as well as <code>dite</code> as early as possible in the
pipeline.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8321">#8321</a> lets the termination argument inference consider negations of
Nat comparisons. Fixes <a href="https://github.com/leanprover/lean4/issues/8257">#8257</a>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8323">#8323</a> adds support for bv_decide to understand <code>BitVec.reverse</code> in
bitblasting.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8330">#8330</a> improves support for structure extensionality in <code>grind</code>. It now
uses eta expansion for structures instead of the extensionality theorems
generated by <code>[ext]</code>. Examples:</p>
                  <pre>opaque f (a : Nat) : Nat × Bool

</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8338">#8338</a> improves the error messages displayed in <code>inductive</code>
declarations when type parameters are invalid or absent.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8341">#8341</a> fixes the <code>propagateCtor</code> constraint propagator used in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8343">#8343</a> splits <code>Lean.Grind.CommRing</code> into 4 typeclasses, for semirings
and noncommutative rings. This does not yet change the behaviour of
<code>grind</code>, which expects to find all 4 typeclasses. Later we will make
some generalizations.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8344">#8344</a> fixes term normalization issues in <code>grind</code>, and the new option
<code>grind +etaStruct</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8347">#8347</a> adds draft typeclasses for <code>grind</code> to process facts about
ordered modules. These interfaces will evolve as the implementation
develops.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8354">#8354</a> makes sure that when generating the unfolding functional
induction theorem, <code>mdata</code> does not get in the way.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8356">#8356</a> tries harder to clean internals of the argument packing of n-ary
functions from the functional induction theorem, in particular the
unfolding variant</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8359">#8359</a> improves the functional cases principles, by making a more
educated guess which function parameters should be targets and which
should remain parameters (or be dropped). This simplifies the
principles, and increases the chance that <code>fun_cases</code> can unfold the
function call.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8361">#8361</a> fixes a bug in the <code>cases</code> tacic introduced in #3188 that arises
when cases (not induction) is used with a non-atomic expression in using
and the argument indexing gets confused.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8363">#8363</a> unifies various ways of naming auxiliary declarations in a
conflict-free way and ensures the method is compatible with diverging
branches of elaboration such as parallelism or Aesop-like
backtracking+replaying search.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8365">#8365</a> fixes the transparency mode for ground patterns. This is
important for implicit instances. Here is a mwe for an issue detected
while testing <code>grind</code> in Mathlib.</p>
                  <pre>example (a : Nat) : max a a = a := by
  grind

</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8368">#8368</a> improves the error messages produced by invalid pattern-match
alternatives and improves parity in error placement between
pattern-matching tactics and elaborators.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8369">#8369</a> fixes a type error at <code>instantiateTheorem</code> function used in
<code>grind</code>. It was failing to instantiate theorems such as</p>
                  <pre>theorem getElem_reverse {xs : Array α} {i : Nat} (hi : i &lt; xs.reverse.size)
    : (xs.reverse)[i] = xs[xs.size - 1 - i]'(by simp at hi; omega)
</pre><p>
                    in examples such as</p>
                  <pre>example (xs : Array Nat) (w : xs.reverse = xs) (j : Nat) (hj : 0 ≤ j) (hj' : j &lt; xs.size / 2)
    : xs[j] = xs[xs.size - 1 - j]
</pre><p>
                    generating the issue</p>
                  <pre>  [issue] type error constructing proof for Array.getElem_reverse
      when assigning metavariable ?hi with
        ‹j &lt; xs.toList.length›
      has type
        j &lt; xs.toList.length : Prop
      but is expected to have type
        j &lt; xs.reverse.size : Prop
</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8375">#8375</a> ensures that using <code>mapError</code> to expand an error message uses
<code>addMessageContext</code> to include the current context, so that expressions
are rendered correctly. Also adds a <code>preprendError</code> variant with a more
convenient argument order for the common cases of
prepending-and-indenting.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8403">#8403</a> adds missing monotonicity lemmas for universal quantifiers, that
are used in defining (co)inductive predicates.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8410">#8410</a> fixes a case-splitting heuristic in <code>grind</code> and simplifies the
proof for test <code>grind_palindrome2.lean</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8412">#8412</a> fixes the <code>markNestedProofs</code> preprocessor used in <code>grind</code>. There
was a missing case (e.g., <code>Expr.mdata</code>)</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8413">#8413</a> implements normalization rules that pull universal quantifiers
across disjunctions. This is a common normalization step performed by
first-order theorem provers.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8417">#8417</a> introduces <code>Lean.Grind.Field</code>, proves that a <code>IsCharP 0</code> field
satisfies <code>NoNatZeroDivisors</code>, and sets up some basic (currently
failing) tests for <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8426">#8426</a> adds the attribute <code>[grind?]</code>. It is like <code>[grind]</code> but displays
inferred E-matching patterns. It is a more convinient than writing.
Thanks @kim-em for suggesting this feature.</p>
                  <pre>set_option trace.grind.ematch.pattern true
</pre><p>
                    also improves some tests, and adds helper function
<code>ENode.isRoot</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8429">#8429</a> adds <code>Lean.Grind.Ring.IsOrdered</code>, and cleans up the ring/module
grind API. These typeclasses are at present unused, but will support
future algorithmic improvements in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8437">#8437</a> fixes <code>split</code> in the presence of metavariables in the target.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8438">#8438</a> ensures that <code>grind</code> diagnostics are obtained even when
<code>maxHeartbeats</code> is reached.
also removes some dead code.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8440">#8440</a> implements non-chronological backtracking for the <code>grind</code>
tactic. This feature ensures that <code>grind</code> does not need to process
irrelevant branches after performing a case-split that is not relevant.
It is not just about performance, but also the size of the final proof
term. The new test demonstrates this feature in practice.</p>
                  <pre>-- In the following test, the first 8 case-splits are irrelevant,
-- and non-choronological backtracking is used to avoid searching
-- (2^8 - 1) irrelevant branches
/--
trace:
[grind.split] p8 ∨ q8, generation: 0
[grind.split] p7 ∨ q7, generation: 0
[grind.split] p6 ∨ q6, generation: 0
[grind.split] p5 ∨ q5, generation: 0
[grind.split] p4 ∨ q4, generation: 0
[grind.split] p3 ∨ q3, generation: 0
[grind.split] p2 ∨ q2, generation: 0
[grind.split] p1 ∨ q1, generation: 0
[grind.split] ¬p ∨ ¬q, generation: 0
-/
#guard_msgs (trace) in
set_option trace.grind.split true in
theorem ex
    : p ∨ q →
      ¬ p ∨ q →
      p ∨ ¬ q →
      ¬ p ∨ ¬ q →
      p1 ∨ q1 →
      p2 ∨ q2 →
      p3 ∨ q3 →
      p4 ∨ q4 →
      p5 ∨ q5 →
      p6 ∨ q6 →
      p7 ∨ q7 →
      p8 ∨ q8 →
      False := by
  grind (splits := 10)
</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8443">#8443</a> adds the lemmas about ordered rings and ordered fields which
will be needed by the new algebraic normalization components of <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8449">#8449</a> upstreams and extends the Mathlib <code>clear_value</code> tactic. Given a
local definition <code>x : T := v</code>, the tactic <code>clear_value x</code> replaces it
with a hypothesis <code>x : T</code>, or throws an error if the goal does not
depend on the value <code>v</code>. The syntax <code>clear_value x with h</code> creates a
hypothesis <code>h : x = v</code> before clearing the value of <code>x</code>. Furthermore,
<code>clear_value *</code> clears all values that can be cleared, or throws an
error if none can be cleared.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8450">#8450</a> adds a feature to the <code>subst</code> tactic so that when <code>x : X := v</code>
is a local definition, <code>subst x</code> substitutes <code>v</code> for <code>x</code> in the goal and
removes <code>x</code>. Previously the tactic would throw an error.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8466">#8466</a> fixes another instance of the <code>grind</code> issue "unexpected kernel
projection term during internalization".</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8472">#8472</a> avoids name resolution blocking on the elaboration of a
theorem's proof when looking up the theorem name.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8479">#8479</a> implements hash-consing for <code>grind</code> that takes alpha equivalence
into account.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8483">#8483</a> ensures <code>grind</code> reuses the <code>simp</code> cache between different calls.
Recall that <code>grind</code> uses <code>simp</code> to normalize terms during
internalization.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8491">#8491</a> fixes the behavior of <code>simp_all?</code> and <code>simp_all?!</code>, aligning
them with <code>simp_all</code> and <code>simp_all!</code> respectively.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8506">#8506</a> implements <code>match</code>-expressions in <code>grind</code> using <code>match</code>
congruence equations. The goal is to minimize the number of <code>cast</code>
operations that need to be inserted, and avoid <code>cast</code> over functions.
The new approach support <code>match</code>-expressions of the form <code>match h : ... with ...</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8512">#8512</a> adds a <code>value_of% ident</code> term that elaborates to the value of
the local or global constant <code>ident</code>. This is useful for creating
definition hypotheses:</p>
                  <pre>let x := ... complicated expression ...
have hx : x = value_of% x := rfl
</pre></li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8516">#8516</a> is a followup to #8449 to refine the syntax of <code>clear_value</code>.
The syntax for adding equality hypotheses before clearing values is now
<code>clear_value (h : x = _)</code>. Any expression definitionally equal to <code>x</code>
can be used in place of the underscore.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8536">#8536</a> fixes the support for <code>LawfulBEq</code> and <code>BEq</code> in <code>grind</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8541">#8541</a> ensures that for any nested proof <code>h : p</code> in a goal, we
propagate that <code>p</code> is true in the <code>grind</code> tactic.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8542">#8542</a> fixes two inappropriate uses of <code>whnfD</code> in <code>grind</code>. They were
potential performance foot guns, and were producing unexpected errors
since <code>whnfD</code> is not consistently used (and it should not be) in all
modules.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8544">#8544</a> implements support for over-applied <code>ite</code> and <code>dite</code>
applications in the <code>grind</code> tactic. It adds support for propagation and
case-split.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8549">#8549</a> fixes the hash function used to implement congruence closure in
<code>grind</code>. The hash of an <code>Expr</code> must not depend on whether the expression
has been internalized or not.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8564">#8564</a> simplifies the interface between the <code>grind</code> core and the cutsat
procedure. Before this PR, core would try to minimize the number of
numeric literals that have to be internalized in cutsat. This
optimization was buggy (see <code>grind_cutsat_zero.lean</code> test), and produced
counterintuitive counterexamples.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8569">#8569</a> adds support for generalized E-match patterns to arbitrary
theorems.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8570">#8570</a> fixes some issues in the E-matching generalized pattern support
after the update stage0.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8572">#8572</a> adds some generalized <code>Option</code> theorems for <code>grind</code> . The avoid
<code>casts</code> operations during E-matching.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8576">#8576</a> sets <code>ring := true</code> by default in <code>grind</code>. It also fixes a bug
in the reification procedure, and improves the term internalization in
the ring and cutsat modules.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Library">
                Library</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7352">#7352</a> reworks the <code>simp</code> set around the <code>Id</code> monad, to not elide or
unfold <code>pure</code> and <code>Id.run</code></p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7995">#7995</a> adds a verification of <code>Array.qsort</code> properties, trying to use
<code>grind</code> and <code>fun_induction</code> where possible.
Currently this is in the <code>tests/</code> folder, but once <code>grind</code> is ready for
production use we will move it out into the library.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8182">#8182</a> adds <code>ofList_eq_insertMany_empty</code> lemmas for all the hash/tree
map types, with the exception of
<code>Std.HashSet.Raw.ofList_eq_insertMany_empty</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8188">#8188</a> takes the existing <code>getElem_map</code> statements for <code>HashMap</code>
variants (also <code>getElem?</code>, <code>getElem!</code>, and <code>getD</code> statements), adds a
prime to their name and an explanatory comment, and replaces the
unprimed statement with a simpler statement that is only true with
<code>LawfulBEq</code> present. The original statements which were simp lemmas are
now low priority simp lemmas, so the nicer statements should fire when
<code>LawfulBEq</code> is available.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8202">#8202</a> adds an inference that was repeatedly needed when proving
<code>BitVec.msb_sdiv</code>, and is the symmetric version of
<code>BitVec.one_eq_zero_iff</code></p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8206">#8206</a> shows that negating a bitvector created from a natural number
equals creating a bitvector from the the negative of that number (as an
integer).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8216">#8216</a> completes adding <code>@[grind]</code> annotations for <code>Option</code> lemmas, and
incidentally fills in some <code>Option</code> API gaps/defects.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8218">#8218</a> continues adding <code>@[grind]</code> attributes for List/Array/Vector,
particularly to the lemmas involving the <code>toList</code>/<code>toArray</code> functions.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8246">#8246</a> add <code>@[grind]</code> annotations for HashMap and variants.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8272">#8272</a> adds lemmas about the length and use of <code>[]?</code> on results of
<code>List.intersperse</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8291">#8291</a> changes the statements of <code>Fin</code> lemmas to use <code>[NeZero n] (i : Fin n)</code> rather than <code>(i : Fin (n+1))</code> where possible.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8298">#8298</a> adds various <code>Option</code> lemmas and defines <code>Option.filterM</code> for
applicative functors.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8313">#8313</a> changes the definition of <code>Vector</code> so it no longer extends
<code>Array</code>. This prevents <code>Array</code> API from "leaking through".</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8315">#8315</a> splits <code>Std.Classes.Ord</code> into <code>Std.Classes.Ord.Basic</code> (with few
imports) and <code>Std.Classes.Ord.SInt</code> and <code>Std.Classes.Ord.Vector</code>. These
changes avoid importing <code>Init.Data.BitVec.Lemmas</code> unnecessarily into
various basic files.
As the new import-only file <code>Std.Classes.Ord</code> imports all three of
these, end-users are not affected.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8318">#8318</a> is follow-up to #8272, combining the conditional lemmas for
<code>getElem_intersperse</code> into a single lemma with an <code>if</code> on the RHS.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8327">#8327</a> adds <code>@[grind]</code> annotations to the generic
<code>getElem?_eq_none_iff</code>, <code>isSome_getElem?</code>, and <code>get_getElem?</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8328">#8328</a> adds the <code>@[grind =]</code> attribute to all <code>contains_iff_mem</code>
lemmas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8331">#8331</a> improves the docstring for <code>PlainDateTime.now</code> and its variants.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8346">#8346</a> adds some missing lemmas about consequences of
positivity/non-negativity of <code>a * b : Int</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8349">#8349</a> fixes the signature of the intended <code>Inhabited</code> instance for
<code>ExtDHashMap</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8357">#8357</a> adds variants of <code>dite_eq_left_iff</code> that will be useful in a
future PR.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8358">#8358</a> introduces a very minimal version of the new iterator library.
It comes with list iterators and various consumers, namely <code>toArray</code>,
<code>toList</code>, <code>toListRev</code>, <code>ForIn</code>, <code>fold</code>, <code>foldM</code> and <code>drain</code>. All
consumers also come in a partial variant that can be used without any
proofs. This limited version of the iterator library generates decent
code, even with the old code generator.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8378">#8378</a> improves and extends the api around <code>Ord</code> and <code>Ordering</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8379">#8379</a> adds missing <code>Option</code> lemmas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8380">#8380</a> provides simple lemmas about <code>toArray</code>, <code>toList</code> and <code>toListRev</code>
for the iterator library.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8384">#8384</a> provides lemmas about the behavior of <code>step</code>, <code>toArray</code>,
<code>toList</code> and <code>toListRev</code> on list iterators created with <code>List.iter</code> and
<code>List.iterM</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8389">#8389</a> adds the <code>List/Array/Vector.ofFnM</code>, the monadic analogues of
<code>ofFn</code>, along with basic theory.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8392">#8392</a> corrects some <code>Array</code> lemmas to be about <code>Array</code> not <code>List</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8397">#8397</a> cleans up many duplicate instances (or, in some cases,
needlessly duplicated <code>def X := ...; instance Y := X</code>).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8399">#8399</a> adds variants of <code>HashMap.getElem?_filter</code> that assume
<code>LawfulBEq</code> and have a simpler right-hand-side. <code>simp</code> can already
achieve these, via rewriting with <code>getKey_eq</code> under the lambda. However
<code>grind</code> can not, and these lemmas help <code>grind</code> work with <code>HashMap</code>
goals. There are variants for all variants of <code>HashMap</code>,
<code>getElem?/getElem/getElem!/getD</code>, and for <code>filter</code> and <code>filterMap</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8405">#8405</a> provides lemmas about the loop constructs <code>ForIn</code>, <code>fold</code>,
<code>foldM</code> and <code>drain</code> and their relation to each other in the context of
iterators.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8418">#8418</a> provides the <code>take</code> iterator combinator that transforms any
iterator into an iterator that stops after a given number of steps. The
change contains the implementation and lemmas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8422">#8422</a> adds <code>LT</code> and <code>Decidable</code> <code>LT</code> instances for
<code>Std.Time.Timestamp</code> and <code>Std.Time.Duration</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8434">#8434</a> adds the equivalent of <code>List.take_cons</code> about <code>List.drop</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8435">#8435</a> upstreams the <code>LawfulMonadLift(T)</code> classes, lemmas and instances
from Batteries into Core because the iterator library needs them in
order to prove lemmas about the <code>mapM</code> operator, which relies on
<code>MonadLiftT</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8445">#8445</a> adds a <code>@[simp]</code> lemma, and comments explaining that there is
intentionally no verification API for <code>Vector.take</code>, <code>Vector.drop</code>, or
<code>Vector.tail</code>, which should all be rewritten in terms of
<code>Vector.extract</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8446">#8446</a> adds basic <code>@[grind]</code> annotations for <code>TreeMap</code> and its
variants. Likely more annotations will be added after we've explored
some examples.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8451">#8451</a> provides the iterator combinator <code>filterMap</code> in a pure and
monadic version and specializations <code>map</code> and <code>filter</code>. This new
combinator allows to apply a function to the emitted values of a stream
while filtering out certain elements.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8460">#8460</a> adds further <code>@[grind]</code> annotations for <code>Option</code>, as follow-up
to the recent additions to the <code>Option</code> API in #8379 and #8298.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8465">#8465</a> adds further lemmas about <code>LawfulGetElem</code>, including marking
some with <code>@[grind]</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8470">#8470</a> adds <code>@[simp]</code> to <code>getElem_pos/neg</code> (similarly for <code>getElem!</code>).
These are often already simp lemmas for concrete types.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8482">#8482</a> adds preliminary <code>@[grind]</code> annotations for <code>List.Pairwise</code> and
<code>List.Nodup</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8484">#8484</a> provides the iterator combinator <code>zip</code> in a pure and monadic
version.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8492">#8492</a> adds <code>simp</code> lemmas for <code>toInt_*</code> and <code>toNat_*</code> with arithmetic
operation given the hypothesis of no-overflow
(<code>toNat_add_of_not_uaddOverflow</code>, <code>toInt_add_of_not_saddOverflow</code>,
<code>toNat_sub_of_not_usubOverflow</code>, <code>toInt_sub_of_not_ssubOverflow</code>,
<code>toInt_neg_of_not_negOverflow</code>, <code>toNat_mul_of_not_umulOverflow</code>,
<code>toInt_mul_of_not_smulOverflow</code>). In particular, these are <code>simp</code> since
(1) the <code>rhs</code> is strictly simpler than the <code>lhs</code> and (2) this version is
also simpler than the standard operation when the hypothesis is
available.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8493">#8493</a> provides the iterator combinators <code>takeWhile</code> (forwarding all
emitted values of another iterator until a predicate becomes false)
<code>dropWhile</code> (dropping values until some predicate on these values
becomes false, then forwarding all the others).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8497">#8497</a> adds preliminary grind annotations for
<code>List.Sublist</code>/<code>IsInfix</code>/<code>IsPrefix</code>/<code>IsSuffix</code>, along with test cases.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8499">#8499</a> changes the definition of <code>Array.ofFn.go</code> to use recursion on
<code>Nat</code> (rather than well-founded recursion). This resolves a problem
reported on <a href="https://leanprover.zulipchat.com/#narrow/channel/270676-lean4/topic/Memory.20issues.20with.20.60Vector.2EofFn.60.2E/near/520622564">zulip</a>).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8513">#8513</a> removes the <code>@[reducible]</code> annotation on <code>Array.size</code>. This is
probably best gone anyway in order to keep separation between the <code>List</code>
and <code>Array</code> APIs, but it also helps avoid uselessly instantiating
<code>Array</code> theorems when <code>grind</code> is working on <code>List</code> problems.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8515">#8515</a> removes the prime from <code>Fin.ofNat'</code>: the old <code>Fin.ofNat</code> has
completed its 6 month deprecation cycle and is being removed.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8527">#8527</a> adds <code>grind</code> annotations for theorems about <code>List.countP</code> and
<code>List.count</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8552">#8552</a> provides array iterators (<code>Array.iter(M)</code>,
<code>Array.iterFromIdx(M)</code>), infinite iterators produced by a step function
(<code>Iter.repeat</code>), and a <code>ForM</code> instance for finite iterators that is
implemented in terms of <code>ForIn</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8620">#8620</a> removes the <code>NatCast (Fin n)</code> global instance (both the direct
instance, and the indirect one via <code>Lean.Grind.Semiring</code>), as that
instance causes causes <code>x &lt; n</code> (for <code>x : Fin k</code>, <code>n : Nat</code>) to be
elaborated as <code>x &lt; ↑n</code> rather than <code>↑x &lt; n</code>, which is undesirable. Note
however that in Mathlib this happens anyway!</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Compiler">
                Compiler</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8211">#8211</a> adds support for generating IR from the LCNF representation of
the new compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8236">#8236</a> fixes an issue where the combination of <code>extern_lib</code> and
<code>precompileModules</code> would lead to "symbol not found" errors.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8268">#8268</a> optimizes lean_nat_shiftr for scalar operands. The new compiler
converts Nat divisions into right shifts, so this now shows up as hot in
some profiles.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8308">#8308</a> makes the new compiler's specialization pass compute closures
the same way as the old compiler, in particular when it comes to
variables captured by lambdas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8367">#8367</a> adds a new <code>structProjCases</code> pass to the new compiler, analogous
to the <code>struct_cases_on</code> pass in the old compiler, which converts all
projections from structs into <code>cases</code> expressions. When lowered to IR,
this causes all of the projections from a single structure to be grouped
together, which is an invariant relied upon by the IR RC passes (at
least for linearity, if not general correctness).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8409">#8409</a> adds support to LCNF for native UInt8/UInt16/UInt32/UInt64
literals.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8456">#8456</a> adds support for primitive USize literals in LCNF.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8458">#8458</a> adds closed term extraction to the new compiler, closely
following the approach in the old compiler. In the future, we will
explore some ideas to improve upon this approach.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8462">#8462</a> enables the LCNF extractClosed pass by default.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8468">#8468</a> switches the LCNF baseExt/monoExt environment extensions to use
a custom environment extension that uses a PersistentHashMap. The
optimizer relies upon the ability to update a decl multiple times, which
does not work with SimplePersistentEnvExtension.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8502">#8502</a> changes the new compiler to use the kernel environment to find
definitions, which causes compilation to be skipped when the decl had a
kernel error (e.g. due to an unresolved metavariable). This matches the
behavior of the old compiler.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8521">#8521</a> makes LCNF.toMono recursively process jmp args.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8523">#8523</a> moves the new compiler's noncomputable check into toMono,
matching the recent change in the old compiler. This is mildly more
complicated because we can't throw an error at the mere use of a
constant, we need to check for a later relevant use. This is still a bit
more conservative than it could theoretically be around join points and
local functions, but it's hard to imagine that mattering in practice
(and we can easily enable it if it does).</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8535">#8535</a> extracts more Nats (and their downstream users) in extractClosed
by fixing a silly oversight in the logic.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8540">#8540</a> changes the LCNF specialize pass to allow ground variables to
depend on local fun decls (with no non-ground free variables). This
enables specialization of Monad instances that depend on local lambdas.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8559">#8559</a> fixes an adversarial soundness attack described in #8554. The
attack exploits the fact that <code>assert!</code> no longer aborts execution, and
that users can redirect error messages.
Another PR will implement the same fix for <code>Expr.Data</code>.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8560">#8560</a> is similar to #8559 but for <code>Expr.mkData</code>. This vulnerability
has not been exploited yet, but adversarial users may find a way.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8561">#8561</a> increases maxHeartbeats in the isDefEqProjIssue test, because
when running under the new compiler the <code>run_meta</code> call includes the
allocations of the compiler itself. With the old compiler, many of the
corresponding allocations were internal to C++ code and would not
increase the heartbeat count.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8565">#8565</a> makes the LCNF specialization pass only treat type/instance
params as ground vars. The current policy was too liberal and would
result on computations being floated into specialized loops.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8566">#8566</a> changes the LCNF constant folding pass to not convert Nat
multiplication to a left shift by a power of 2. The fast path test for
this is sufficiently complex that it's simpler to just use the fast path
for multiplication.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8575">#8575</a> makes LCNF's simpAppApp? bail out on trivial aliases as
intended. It seems that there was a typo in the original logic, and this
PR also extends it to include aliases of global constants rather than
just local vars.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8582">#8582</a> fixes an accidental dropping of state in Param.toMono. When this
code was originally written, there was no other state besides
<code>typeParams</code>.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Pretty-Printing">
                Pretty Printing</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8041">#8041</a> changes the behavior of <code>pp.showLetValues</code> to use a hoverable
<code>⋯</code> to hide let values. This is now false by default, and there is a new
option <code>pp.showLetValues.threshold</code> for allowing small expressions to be
shown anyway. For tactic metavariables, there is an additional option
<code>pp.showLetValues.tactic.threshold</code>, which by default is set to the
maximal value, since in tactic states local values are usually
significant.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8372">#8372</a> modifies the pretty printer to use <code>have</code> syntax instead of
<code>let_fun</code> syntax.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8457">#8457</a> fixes an issue when including a hard line break in a <code>Format</code>
that caused subsequent (ordinary) line breaks to be erroneously
flattened to spaces.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8504">#8504</a> modifies the pretty printer so that dot notation is used for
class parent projections. Previously, dot notation was never used for
classes.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Documentation">
                Documentation</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8199">#8199</a> adds a style guide for documentation, including both general
principles and docstring-specific concerns.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Server">
                Server</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/7665">#7665</a> and <a href="https://github.com/leanprover/lean4/pull/8180">#8180</a> add
support for code actions that resolve 'Unknown identifier' errors by either importing the missing declaration or by
changing the identifier to one from the environment.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8091">#8091</a> improves the performance of the workspace symbol request.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8242">#8242</a> fixes the 'goals accomplished' diagnostics. They were
accidentally broken in #7902.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8350">#8350</a> changes namespace completion to use the same algorithm as
declaration identifier completion, which makes it use the short name
(last name component) for completions instead of the full name, avoiding
namespace duplications.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8362">#8362</a> fixes a bug where the Unknown identifier code actions wouldn't
work correctly for some Unknown identifier error spans and adjusts
several Unknown identifier spans to actually end on the identifier in
question.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Lake">
                Lake</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8383">#8383</a> fixes the use of <code>import Lake</code> with precompiled modules, which
was previously broken on MacOS.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8411">#8411</a> fixes a doc bug in the Resolve.lean; in reverse order, B comes
before A</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8528">#8528</a> fixes the heuristic Lake uses to determine whether a <code>lean_lib</code>
can be loaded via <code>lean --plugin</code> rather than <code>lean --load-dynlib</code>.
Previously, a mismatch between the single root's name and the library's
name would not be caught and cause loading to fail.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8529">#8529</a> changes <code>lake lean</code> and <code>lake setup-file</code> to precompile the
imports of non-workspace files using the the import's whole library.
This ensures that additional link objects are linked and available
during elaboration.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8539">#8539</a> changes Lake to use relative path for the Lean messages produced
by a module build. This makes the message portable across different
machines, which is useful for Mathlib's cache.</p>
                  </li>
                </ul>
              </section>
            <section>
              <h2 id="The-Lean-Language-Reference--Release-Notes--Lean-4___21___0-_LPAR_2025-06-30_RPAR_--Other">
                Other</h2>
              <ul>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8192">#8192</a> includes upgrades to the <code>release_checklist.py</code> script prepared
while releasing v4.20.0-rc1.</p>
                  </li>
                <li>
                  <p>
                    <a href="https://github.com/leanprover/lean4/pull/8366">#8366</a> adds the <code>expose</code> attribute to <code>Ordering.then</code>. This is required
for building with the new compiler, but works fine with the old compiler
because it silently ignores the missing definition.</p>
                  </li>
                </ul>
              </section>
            </section>
          <nav class="prev-next-buttons">
            <a class="local-button active" href="releases/v4.22.0/#release-v4___22___0" rel="prev" title="Lean 4.22.0 (2025-08-14)"><span class="arrow">←</span><span class="where">Lean 4.22.0 (2025-08-14)</span></a><a class="local-button active" href="releases/v4.20.0/#release-v4___20___0" rel="next" title="Lean 4.20.0 (2025-06-02)"><span class="where">Lean 4.20.0 (2025-06-02)</span><span class="arrow">→</span></a></nav>
          </div>
        </main></div>
    </body>
  </html>

